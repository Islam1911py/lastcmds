# ุงูุฅุฏุงุฑุฉ ุนูู ูุงุชุณุงุจ - ุฏููู ุงูุนูููุงุช ุงููุงูู

> **ุงูุบุฑุถ:** ุชูุซูู ุดุงูู ูุฌููุน ุงูุนูููุงุช ุงูุชู ูููู ููุฅุฏุงุฑุฉ ุชูููุฐูุง ุนุจุฑ ูุงุชุณุงุจ (ุชุดูู ุฌููุน ุนูููุงุช ุงููุญุงุณุจ + ุนูููุงุช ุฅุฏุงุฑูุฉ ุฅุถุงููุฉ)

---

## ๐ ุฌุฏูู ุงููุญุชููุงุช

1. [ุนูููุงุช ุงููุฑุงุกุฉ (ูุดุชุฑูุฉ ูุน ุงููุญุงุณุจ)](#ุนูููุงุช-ุงููุฑุงุกุฉ-ูุดุชุฑูุฉ-ูุน-ุงููุญุงุณุจ)
2. [ุฅุฏุงุฑุฉ ุงูุณููุงุช](#ุฅุฏุงุฑุฉ-ุงูุณููุงุช)
3. [ุฅุฏุงุฑุฉ ุงูููุงุชูุฑ](#ุฅุฏุงุฑุฉ-ุงูููุงุชูุฑ)
4. [ุฅุฏุงุฑุฉ ุงูุฑูุงุชุจ](#ุฅุฏุงุฑุฉ-ุงูุฑูุงุชุจ)
5. [ุงูุนูููุงุช ุงูุฅุฏุงุฑูุฉ ุงููุชูุฏูุฉ](#ุงูุนูููุงุช-ุงูุฅุฏุงุฑูุฉ-ุงููุชูุฏูุฉ)
6. [ุงุณุชุฎุฏุงู DSL Filter](#ุงุณุชุฎุฏุงู-dsl-filter)
7. [Prompt ููู Agent](#prompt-ููู-agent)

---

## ุนูููุงุช ุงููุฑุงุกุฉ (ูุดุชุฑูุฉ ูุน ุงููุญุงุณุจ)

### SEARCH_STAFF - ุงูุจุญุซ ุนู ููุธู

**ุงููุตู:** ุงูุจุญุซ ุนู ููุธู ุจุงุณู ุฃู ุฌุฒุก ูู ุงูุงุณู (ุงูุจุญุซ ูุดูู ุฌููุน ุงููุดุงุฑูุน)

**ุงููุชุทูุจุงุช:**
- `query` - ุงุณู ุฃู ุฌุฒุก ูู ุงุณู ุงูููุธู

**ุงูุงุฎุชูุงุฑูุฉ:**
- `projectId` - ุชุตููุฉ ุญุณุจ ุงููุดุฑูุน (ุงุฎุชูุงุฑู ููุฅุฏุงุฑุฉ)
- `onlyWithPendingAdvances` - ุฅุธูุงุฑ ููุท ุงูููุธููู ุจูู ุณููุงุช ูุนููุฉ
- `limit` - ุนุฏุฏ ุงููุชุงุฆุฌ (ุงูุชุฑุงุถู: 10)

**Request Payload:**
```json
{
  "action": "SEARCH_STAFF",
  "senderPhone": "+201001234567",
  "payload": {
    "query": "ูุญูุฏ ุนูู",
    "onlyWithPendingAdvances": true,
    "limit": 20
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "matches": [
      {
        "id": "staff-001",
        "name": "ูุญูุฏ ุนูู ุฃุญูุฏ",
        "projectName": "ุงููุดุฑูุน ุงูุฃุฎุถุฑ",
        "unitCode": "A1",
        "score": 98,
        "pendingAdvanceCount": 2,
        "pendingAdvanceAmount": 7500,
        "pendingAdvanceIds": ["adv-001", "adv-002"]
      }
    ]
  },
  "humanReadable": {
    "ar": "ุชู ุงูุนุซูุฑ ุนูู 1 ููุธู ูุทุงุจู ููุจุญุซ"
  }
}
```

---

### LIST_UNIT_EXPENSES - ูุงุฆูุฉ ูุตุฑููุงุช ุงููุญุฏุฉ

**ุงููุตู:** ุงูุญุตูู ุนูู ูุงุฆูุฉ ุงููุตุฑููุงุช ููุฐูุฑุงุช ุงููุญุงุณุจุฉ (ุงูุฅุฏุงุฑุฉ ุชุฑู ุฌููุน ุงููุดุงุฑูุน)

**ุงูุงุฎุชูุงุฑูุฉ:**
- `projectId` ุฃู `projectName` - ุชุตููุฉ ุญุณุจ ุงููุดุฑูุน
- `unitCode` - ููุฏ ุงููุญุฏุฉ
- `sourceTypes` - ุฃููุงุน ุงููุตุฑููุงุช
- `search` - ุจุญุซ ูุตู
- `fromDate` - ุชุงุฑูุฎ ุงูุจุฏุงูุฉ
- `toDate` - ุชุงุฑูุฎ ุงูููุงูุฉ
- `filterDsl` - ููุชุฑ ูุชูุฏู
- `limit` - ุนุฏุฏ ุงููุชุงุฆุฌ

**Request Payload:**
```json
{
  "action": "LIST_UNIT_EXPENSES",
  "payload": {
    "projectId": "green-project-id",
    "unitCode": "A1",
    "fromDate": "2026-01-01",
    "toDate": "2026-02-19",
    "limit": 30
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "expenses": [
      {
        "id": "exp-001",
        "date": "2026-02-15",
        "description": "ุตูุงูุฉ ุงูุฃูุงุจูุจ",
        "amount": 1500,
        "sourceType": "TECHNICIAN_WORK"
      }
    ]
  },
  "meta": {
    "total": 1,
    "totalAmount": 1500
  }
}
```

---

### LIST_INVOICES - ูุงุฆูุฉ ุงูููุงุชูุฑ

**ุงููุตู:** ุงูุญุตูู ุนูู ูุงุฆูุฉ ุฌููุน ุงูููุงุชูุฑ (ุงูุฅุฏุงุฑุฉ ุชุฑู ุฌููุน ุงููุดุงุฑูุน ูุงููุญุฏุงุช)

**ุงูุงุฎุชูุงุฑูุฉ:**
- `projectId` ุฃู `projectName` - ุงููุดุฑูุน
- `unitCode` - ุงููุญุฏุฉ
- `isPaid` - ุญุงูุฉ ุงูุณุฏุงุฏ
- `invoiceType` - ููุน ุงููุงุชูุฑุฉ
- `fromDate` - ูู ุชุงุฑูุฎ
- `toDate` - ุฅูู ุชุงุฑูุฎ
- `filterDsl` - ููุชุฑ ูุชูุฏู
- `limit` - ุนุฏุฏ ุงููุชุงุฆุฌ

**Request Payload:**
```json
{
  "action": "LIST_INVOICES",
  "payload": {
    "isPaid": false,
    "limit": 100
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "invoices": [
      {
        "id": "inv-001",
        "unitCode": "A1",
        "projectName": "ุงููุดุฑูุน ุงูุฃุฎุถุฑ",
        "type": "CLAIM",
        "totalAmount": 3500,
        "amountPaid": 0,
        "remainingBalance": 3500,
        "isPaid": false,
        "issuedAt": "2026-02-10"
      }
    ]
  },
  "meta": {
    "total": 1,
    "totalAmount": 3500,
    "totalRemaining": 3500
  }
}
```

---

### LIST_STAFF_ADVANCES - ูุงุฆูุฉ ุงูุณููุงุช

**ุงููุตู:** ุงูุญุตูู ุนูู ูุงุฆูุฉ ููุตูุฉ ุจุณููุงุช ุงูููุธููู ูุงููููุฏุณูู

**ุงูุงุฎุชูุงุฑูุฉ:**
- `query` - ุงูุจุญุซ ุจุฑุฌุงุก/ุงุณู ุงูููุธู
- `status` - ุงูุญุงูุฉ: PENDING ุฃู DEDUCTED ุฃู ALL
- `projectId` - ุชุตููุฉ ุญุณุจ ุงููุดุฑูุน
- `limit` - ุนุฏุฏ ุงููุชุงุฆุฌ

**Request Payload:**
```json
{
  "action": "LIST_STAFF_ADVANCES",
  "payload": {
    "status": "PENDING",
    "limit": 50
  }
}
```

---

### SEARCH_ACCOUNTING_NOTES - ุงูุจุญุซ ุนู ูุฐูุฑุงุช ุงููุญุงุณุจุฉ

**ุงููุตู:** ุงูุจุญุซ ุนู ูุฐูุฑุงุช ุงููุญุงุณุจุฉ ุญุณุจ ุงููุตู ุฃู ุงูุญุงูุฉ

**ุงูุงุฎุชูุงุฑูุฉ:**
- `query` - ูุต ุงูุจุญุซ
- `status` - ุงูุญุงูุฉ: PENDING, CONVERTED, REJECTED, ALL
- `projectId` - ุงููุดุฑูุน
- `unitCode` - ุงููุญุฏุฉ
- `includeConverted` - ุชุถููู ุงููุฐูุฑุงุช ุงููุญููุฉ
- `limit` - ุนุฏุฏ ุงููุชุงุฆุฌ

**Request Payload:**
```json
{
  "action": "SEARCH_ACCOUNTING_NOTES",
  "payload": {
    "status": "PENDING",
    "limit": 50
  }
}
```

---

## ุฅุฏุงุฑุฉ ุงูุณููุงุช

### CREATE_PM_ADVANCE - ุฅูุดุงุก ุณููุฉ ูููุฏุณ

**ุงููุตู:** ุฅุนุทุงุก ุณููุฉ ููุฏูุฉ ููููุฏุณ ูู ุฃุฌู ูุดุฑูุน ูุนูู

**ุงููุชุทูุจุงุช:**
- `amount` - ุงููุจูุบ ุงููุฑุงุฏ ุฅุนุทุงุคู
- `staffQuery` ุฃู `staffId` - ุงุณู ุฃู ID ุงููููุฏุณ

**ุงูุงุฎุชูุงุฑูุฉ:**
- `projectId` - ูุนุฑู ุงููุดุฑูุน
- `notes` - ููุงุญุธุงุช ุฅุถุงููุฉ

**Request Payload:**
```json
{
  "action": "CREATE_PM_ADVANCE",
  "senderPhone": "+201001234567",
  "payload": {
    "staffQuery": "ูุญูุฏ ุนูู",
    "amount": 5000,
    "projectId": "green-project-id",
    "notes": "ุณููุฉ ูุดุฑุงุก ููุงุฏ ุงูุจูุงุก"
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "advanceId": "adv-12345",
    "staffName": "ูุญูุฏ ุนูู",
    "amount": 5000,
    "projectName": "ุงููุดุฑูุน ุงูุฃุฎุถุฑ",
    "status": "PENDING",
    "createdAt": "2026-02-19T10:30:00Z"
  },
  "humanReadable": {
    "ar": "ุชู ุฅุนุทุงุก ุณููุฉ ุจูููุฉ 5000 ุฑูุงู ููุญูุฏ ุนูู"
  }
}
```

---

### CREATE_STAFF_ADVANCE - ุฅูุดุงุก ุณููุฉ ููุธู

**ุงููุตู:** ุฅุนุทุงุก ุณููุฉ ูููุธู ุนุงู ุฃู ุฅุฏุงุฑู

**ุงููุชุทูุจุงุช:**
- `amount` - ุงููุจูุบ
- `staffQuery` ุฃู `staffId` - ุงุณู ุฃู ID ุงูููุธู

**ุงูุงุฎุชูุงุฑูุฉ:**
- `note` - ููุงุญุธุฉ

**Request Payload:**
```json
{
  "action": "CREATE_STAFF_ADVANCE",
  "payload": {
    "staffQuery": "ูุงุทูุฉ ูุญููุฏ",
    "amount": 2000,
    "note": "ุณููุฉ ุงูุฑุงุชุจ ุงูุดูุฑู"
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "advanceId": "adv-67890",
    "staffName": "ูุงุทูุฉ ูุญููุฏ",
    "amount": 2000,
    "status": "PENDING"
  },
  "humanReadable": {
    "ar": "ุชู ุชุณุฌูู ุณููุฉ 2000 ุฑูุงู ููููุธู ูุงุทูุฉ ูุญููุฏ"
  }
}
```

---

### UPDATE_STAFF_ADVANCE - ุชุนุฏูู ุงูุณููุฉ

**ุงููุตู:** ุชุนุฏูู ูุจูุบ ุฃู ุชูุงุตูู ุณููุฉ ููุฌูุฏุฉ

**ุงููุชุทูุจุงุช:**
- `advanceId` - ูุนุฑู ุงูุณููุฉ

**ุงูุงุฎุชูุงุฑูุฉ:**
- `amount` - ุงููุจูุบ ุงูุฌุฏูุฏ
- `note` - ููุงุญุธุฉ ุฌุฏูุฏุฉ

**Request Payload:**
```json
{
  "action": "UPDATE_STAFF_ADVANCE",
  "payload": {
    "advanceId": "adv-67890",
    "amount": 2500
  }
}
```

---

### DELETE_STAFF_ADVANCE - ุญุฐู ุงูุณููุฉ

**ุงููุตู:** ุญุฐู ุณููุฉ ูู ูุชู ุงุณุชุฎุฏุงููุง ุจุนุฏ

**ุงููุชุทูุจุงุช:**
- `advanceId` - ูุนุฑู ุงูุณููุฉ

**Request Payload:**
```json
{
  "action": "DELETE_STAFF_ADVANCE",
  "payload": {
    "advanceId": "adv-67890"
  }
}
```

---

## ุฅุฏุงุฑุฉ ุงูููุงุชูุฑ

### RECORD_ACCOUNTING_NOTE - ุชุญููู ูุฐูุฑุฉ ููุงุชูุฑุฉ

**ุงููุตู:** ุชุญููู ูุฐูุฑุฉ ูุญุงุณุจุฉ (ูุตุฑููุงุช ูุณุฌูุฉ) ุฅูู ูุงุชูุฑุฉ ุฑุณููุฉ

**ุงููุชุทูุจุงุช:**
- `noteId` - ูุนุฑู ุงููุฐูุฑุฉ

**ุงูุงุฎุชูุงุฑูุฉ:**
- `sourceType` - ูุตุฏุฑ ุงูุชูููู: OFFICE_FUND ุฃู PM_ADVANCE
- `pmAdvanceId` - ูุนุฑู ุงูุณููุฉ (ุฅุฐุง ูุงู sourceType = PM_ADVANCE)

**Request Payload:**
```json
{
  "action": "RECORD_ACCOUNTING_NOTE",
  "payload": {
    "noteId": "note-abc123",
    "sourceType": "OFFICE_FUND"
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "invoiceId": "inv-12345",
    "noteId": "note-abc123",
    "convertedAmount": 3500,
    "invoiceType": "CLAIM"
  },
  "humanReadable": {
    "ar": "ุชู ุชุญููู ุงููุฐูุฑุฉ ุฅูู ูุงุชูุฑุฉ ุจูููุฉ 3500 ุฑูุงู"
  }
}
```

---

### PAY_INVOICE - ุฏูุน ุงููุงุชูุฑุฉ

**ุงููุตู:** ุฏูุน ูุงุชูุฑุฉ ุฃู ุฌุฒุก ูููุง

**ุงููุชุทูุจุงุช:**
- `invoiceId` - ูุนุฑู ุงููุงุชูุฑุฉ

**ุงูุงุฎุชูุงุฑูุฉ:**
- `amount` - ุงููุจูุบ ุงููุฑุงุฏ ุฏูุนู
- `action` - ููุน ุงูุฏูุน: "pay" (ุฏูุน ุชุฏุฑูุฌู) ุฃู "mark-paid" (ุชุณุฏูุฏ ูุงูู)

**Request Payload:**
```json
{
  "action": "PAY_INVOICE",
  "payload": {
    "invoiceId": "inv-12345",
    "amount": 5000,
    "action": "pay"
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "invoiceId": "inv-12345",
    "amountPaid": 5000,
    "remainingBalance": 0,
    "status": "PAID"
  },
  "humanReadable": {
    "ar": "ุชู ุฏูุน 5000 ุฑูุงู ูููุงุชูุฑุฉ ุฑูู inv-12345"
  }
}
```

---

## ุฅุฏุงุฑุฉ ุงูุฑูุงุชุจ

### CREATE_PAYROLL - ุฅูุดุงุก ูุดู ุฑูุงุชุจ

**ุงููุตู:** ุฅูุดุงุก ูุดู ุฑูุงุชุจ ูุดูุฑ ูุนูู

**ุงููุชุทูุจุงุช:**
- `month` - ุงูุดูุฑ ุจุตูุบุฉ YYYY-MM (ูุซู 2026-02)

**Request Payload:**
```json
{
  "action": "CREATE_PAYROLL",
  "payload": {
    "month": "2026-02"
  }
}
```

---

### PAY_PAYROLL - ุฏูุน ุงูุฑูุงุชุจ

**ุงููุตู:** ุชูููุฐ ุฏูุน ุงูุฑูุงุชุจ ูููุธูู ุงูุดูุฑ

**ุงููุชุทูุจุงุช:**
- `payrollId` - ูุนุฑู ูุดู ุงูุฑูุงุชุจ

**Request Payload:**
```json
{
  "action": "PAY_PAYROLL",
  "payload": {
    "payrollId": "payroll-2026-02"
  }
}
```

---

## ุงูุนูููุงุช ุงูุฅุฏุงุฑูุฉ ุงููุชูุฏูุฉ

### FIX_INVOICE_AMOUNTS - ุฅุตูุงุญ ุฃูุณุงุท ุงูููุงุชูุฑ

**ุงููุตู:** ุชุตุญูุญ ุงูุฃุฎุทุงุก ูู ุญุณุงุจุงุช ุงูููุงุชูุฑ (ูุง ูููู ูููุญุงุณุจ ูุนู ูุฐุง)

**ุงููุชุทูุจุงุช:**
- `invoiceId` - ูุนุฑู ุงููุงุชูุฑุฉ

**ุงูุงุฎุชูุงุฑูุฉ:**
- `correctAmount` - ุงููุจูุบ ุงูุตุญูุญ
- `reason` - ุณุจุจ ุงูุฅุตูุงุญ

**Request Payload:**
```json
{
  "action": "FIX_INVOICE_AMOUNTS",
  "senderPhone": "+201001234567",
  "payload": {
    "invoiceId": "inv-12345",
    "correctAmount": 3500,
    "reason": "ุฅุตูุงุญ ุฎุทุฃ ูู ุงูุญุณุงุจ ุงูุฃููู"
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "invoiceId": "inv-12345",
    "oldAmount": 3000,
    "newAmount": 3500,
    "difference": 500,
    "reason": "ุฅุตูุงุญ ุฎุทุฃ ูู ุงูุญุณุงุจ ุงูุฃููู"
  },
  "humanReadable": {
    "ar": "ุชู ุชุตุญูุญ ุงููุงุชูุฑุฉ ูู 3000 ุฅูู 3500 ุฑูุงู"
  }
}
```

---

### FIX_OVERPAYMENTS - ุฅุตูุงุญ ุงูุฏูุนุงุช ุงูุฒุงุฆุฏุฉ

**ุงููุตู:** ุชุณุฌูู ูุชุชุจุน ุงูุฏูุนุงุช ุงูุฒุงุฆุฏุฉ ูุชุตุญูุญูุง

**ุงููุชุทูุจุงุช:**
- `invoiceId` - ูุนุฑู ุงููุงุชูุฑุฉ
- `overpaidAmount` - ุงููุจูุบ ุงููุฏููุน ุฒุงุฆุฏุงู

**ุงูุงุฎุชูุงุฑูุฉ:**
- `refundMethod` - ุทุฑููุฉ ุงุณุชุฑุฌุงุน ุงููุจูุบ: "deduct_from_next" ุฃู "cash_return"

**Request Payload:**
```json
{
  "action": "FIX_OVERPAYMENTS",
  "payload": {
    "invoiceId": "inv-12345",
    "overpaidAmount": 500,
    "refundMethod": "deduct_from_next"
  }
}
```

---

### BULK_UPDATE_INVOICES - ุชุญุฏูุซ ูุฌููุนุฉ ูู ุงูููุงุชูุฑ

**ุงููุตู:** ุชุญุฏูุซ ุนุฏุฉ ููุงุชูุฑ ูู ุนูููุฉ ูุงุญุฏุฉ

**ุงููุชุทูุจุงุช:**
- `invoiceIds` - ูุงุฆูุฉ ูุนุฑูุงุช ุงูููุงุชูุฑ

**ุงูุงุฎุชูุงุฑูุฉ:**
- `newStatus` - ุงูุญุงูุฉ ุงูุฌุฏูุฏุฉ
- `updateField` - ุงูุญูู ุงููุฑุงุฏ ุชุญุฏูุซู
- `newValue` - ุงููููุฉ ุงูุฌุฏูุฏุฉ

**Request Payload:**
```json
{
  "action": "BULK_UPDATE_INVOICES",
  "payload": {
    "invoiceIds": ["inv-001", "inv-002", "inv-003"],
    "updateField": "projectId",
    "newValue": "red-project-id"
  }
}
```

---

### RESET_INVOICE_STATUS - ุฅุนุงุฏุฉ ุชุนููู ุญุงูุฉ ุงููุงุชูุฑุฉ

**ุงููุตู:** ุฅุฑุฌุงุน ูุงุชูุฑุฉ ูุฏููุนุฉ ุฅูู ุบูุฑ ูุฏููุนุฉ ุฃู ุงูุนูุณ (ููุชุตุญูุญุงุช)

**ุงููุชุทูุจุงุช:**
- `invoiceId` - ูุนุฑู ุงููุงุชูุฑุฉ
- `newStatus` - ุงูุญุงูุฉ ุงูุฌุฏูุฏุฉ: PENDING ุฃู PAID

**Request Payload:**
```json
{
  "action": "RESET_INVOICE_STATUS",
  "payload": {
    "invoiceId": "inv-12345",
    "newStatus": "PENDING",
    "reason": "ุฎุทุฃ ูู ุงูุชุณุฌูู"
  }
}
```

---

### BULK_DELETE_PAYMENTS - ุญุฐู ุนุฏุฉ ุนูููุงุช ุฏูุน

**ุงููุตู:** ุญุฐู ุนูููุงุช ุฏูุน ุฎุงุทุฆุฉ ุฃู ููุฑุฑุฉ

**ุงููุชุทูุจุงุช:**
- `paymentIds` - ูุงุฆูุฉ ูุนุฑูุงุช ุงูุฏูุนุงุช

**ุงูุงุฎุชูุงุฑูุฉ:**
- `reason` - ุณุจุจ ุงูุญุฐู
- `restoreInvoiceStatus` - ูู ูุชู ุงุณุชุฑุฌุงุน ุงููุงุชูุฑุฉ ุฅูู ุบูุฑ ูุฏููุนุฉ

**Request Payload:**
```json
{
  "action": "BULK_DELETE_PAYMENTS",
  "payload": {
    "paymentIds": ["pay-001", "pay-002"],
    "reason": "ุฏูุนุงุช ููุฑุฑุฉ",
    "restoreInvoiceStatus": true
  }
}
```

---

## ุงุณุชุฎุฏุงู DSL Filter

### ูุง ูู DSL Filterุ

ูุณููุฉ ูุชูุฏูุฉ ููุจุญุซ ูุงูุชุตููุฉ ุจุงุณุชุฎุฏุงู ุชุนุงุจูุฑ ููุทููุฉ ุจุณูุทุฉ.

### ุงูููุงุชุฑ ุงููุฏุนููุฉ

#### ูููุตุฑููุงุช (LIST_UNIT_EXPENSES):
- `amount` - ุงููุจูุบ (ุนุฏุฏู)
- `date` - ุงูุชุงุฑูุฎ
- `sourceType` - ููุน ุงููุตุฑูู
- `projectId` / `projectName` - ุงููุดุฑูุน
- `unitCode` - ุงููุญุฏุฉ

#### ููููุงุชูุฑ (LIST_INVOICES):
- `isPaid` - ุญุงูุฉ ุงูุณุฏุงุฏ (true/false)
- `type` / `invoiceType` - ููุน ุงููุงุชูุฑุฉ
- `projectId` / `projectName` - ุงููุดุฑูุน
- `unitCode` - ุงููุญุฏุฉ
- `unitId` - ูุนุฑู ุงููุญุฏุฉ

### ุงูุนูุงูู ุงููุฏุนููุฉ

```
=      โ ูุณุงูู
!=     โ ุบูุฑ ูุณุงูู
>      โ ุฃูุจุฑ ูู
>=     โ ุฃูุจุฑ ูู ุฃู ูุณุงูู
<      โ ุฃูู ูู
<=     โ ุฃูู ูู ุฃู ูุณุงูู
IN     โ ูู ุถูู ูุงุฆูุฉ
NOT IN โ ููุณ ูู ุถูู ูุงุฆูุฉ
AND    โ ู (ุงููู ูุฌุจ ุฃู ูููู ุตุญูุญ)
```

### ุฃูุซูุฉ

#### ูุซุงู 1: ุฌููุน ุงูููุงุชูุฑ ุบูุฑ ุงููุฏููุนุฉ
```json
{
  "action": "LIST_INVOICES",
  "payload": {
    "filterDsl": "isPaid=false"
  }
}
```

#### ูุซุงู 2: ุงูููุงุชูุฑ ูู ูุดุฑูุน ูุญุฏุฏ ูุบูุฑ ูุฏููุนุฉ
```json
{
  "action": "LIST_INVOICES",
  "payload": {
    "filterDsl": "projectId=green-project-id AND isPaid=false"
  }
}
```

#### ูุซุงู 3: ุงููุตุฑููุงุช ููู 1000 ุฑูุงู
```json
{
  "action": "LIST_UNIT_EXPENSES",
  "payload": {
    "filterDsl": "amount > 1000"
  }
}
```

#### ูุซุงู 4: ุฃุนูุงู ูููุฉ ุฃู ููุฑุจุงุก
```json
{
  "action": "LIST_UNIT_EXPENSES",
  "payload": {
    "filterDsl": "sourceType IN [TECHNICIAN_WORK, ELECTRICITY]"
  }
}
```

#### ูุซุงู 5: ุจุญุซ ูุชูุฏู - ููุงุชูุฑ ูุญุฏุฉ ูุญุฏุฏุฉ ุบูุฑ ูุฏููุนุฉ
```json
{
  "action": "LIST_INVOICES",
  "payload": {
    "filterDsl": "unitCode=A1 AND isPaid=false"
  }
}
```

---

## Prompt ููู Agent

### ุงุณุชุฎุฏุงู ุงูุนูููุงุช ูู ุงูู Agent

```text
ุฃูุช ูุณุงุนุฏ ุฐูู ูุฅุฏุงุฑุฉ ุงููุธุงู ุนุจุฑ ูุงุชุณุงุจ ุจุฑุตูุงุญูุงุช ุฅุฏุงุฑูุฉ ูุงููุฉ (ุชุฑู ุฌููุน ุงููุดุงุฑูุน).
ุงุชุจุน ููุณ ุงูู workflow ูุซู ุงููุญุงุณุจ + ุนูููุงุช ุฅุฏุงุฑุฉ ูุชูุฏูุฉ.

## โ๏ธ WORKFLOW ุงููุดุชุฑู (ูุซู ุงููุญุงุณุจ):

### 1๏ธโฃ ุนูุฏ ุฅุนุทุงุก ุณููุฉ:
ุงูุฅุฏุงุฑุฉ ุชุฑู ุฌููุน ุงูููุธููู ูู ุฌููุน ุงููุดุงุฑูุน
```
User: ุณููุฉ ุนูู ูุญูุฏ
Agent: [ุจุญุซ ูู ุฌููุน ุงููุดุงุฑูุน]
ูุฌุฏุช 5 ููุธููู ุงุณููู ูุญูุฏ:
1๏ธโฃ ูุญูุฏ ุนูู - ุงููุดุฑูุน ุงูุฃุฎุถุฑ
2๏ธโฃ ูุญูุฏ ุญุณู - ุงููุดุฑูุน ุงูุฃุญูุฑ
3๏ธโฃ ูุญูุฏ ุณูุงู - ุงููุดุฑูุน ุงูุฃุฒุฑู
4๏ธโฃ ูุญูุฏ ุฃุญูุฏ - ุงููุดุฑูุน ุงูุฃุณูุฏ
5๏ธโฃ ูุญูุฏ ุฎุงูุฏ - ุงูุดุฑูุฉ (ููุธู ุนุงู)
ุฃูุช ุชูุตุฏ ูููุ
```

### 2๏ธโฃ ุนูุฏ ุงูุจุญุซ ุนู ูุตุฑููุงุช:
```
User: ุงุนุฑุถ ุงููุตุฑููุงุช ูู ูู ุงููุดุงุฑูุน
Agent: [ูุนุฑุถ ูู ุฌููุน ุงููุดุงุฑูุน ูุน ููุฎุต]
ุงููุตุฑููุงุช ุงูุฅุฌูุงููุฉ: 25000 ุฌููู
ุงููุดุฑูุน ุงูุฃุฎุถุฑ: 8000 ุฌููู
ุงููุดุฑูุน ุงูุฃุญูุฑ: 12000 ุฌููู
ุงููุดุฑูุน ุงูุฃุฒุฑู: 5000 ุฌููู
```

## ๐ง WORKFLOW ุงูุฅุฏุงุฑุฉ ุงููุชูุฏูุฉ:

### 1๏ธโฃ ุชุตุญูุญ ูุจูุบ ุงููุงุชูุฑุฉ (FIX_INVOICE_AMOUNTS):
```
User: ูู ุฎุทุฃ ูู ุงููุงุชูุฑุฉ inv-123 ุงููุจูุบ 3000 ุงูุตุญูุญ 3500
Agent: ุชูุงูุ ุฏุนูู ุฃุตุญุญ ุงููุจูุบ
Agent: ุญุงุถุฑุ ููุตุญุญ ุงููุงุชูุฑุฉ ูู 3000 ุฅูู 3500 ุฑูุงู. ููุงููุ
User: ููุงูู
Agent: [ูููู ุจู FIX_INVOICE_AMOUNTS]
โ ุชู ุงูุชุตุญูุญ ุจูุฌุงุญ:
ุงููุงุชูุฑุฉ: inv-123
ุงููุจูุบ ุงููุฏูู: 3000
ุงููุจูุบ ุงูุฌุฏูุฏ: 3500
ุงููุฑู: +500 ุฑูุงู
```

### 2๏ธโฃ ูุนุงูุฌุฉ ุงูุฏูุนุงุช ุงูุฒุงุฆุฏุฉ (FIX_OVERPAYMENTS):
```
User: ููุงู ุฏูุนุฉ ุฒุงุฆุฏุฉ 500 ุฑูุงู ุนูู ุงููุงุชูุฑุฉ inv-456
Agent: ุชูุงู. ููููุฉ ุงูุชุนุงูู ูุนูุงุ
1๏ธโฃ ุฎุตู ูู ุงููุงุชูุฑุฉ ุงูุชุงููุฉ
2๏ธโฃ ุงุณุชุฑุฌุงุน ููุฏู
User: ุฎุตู ูู ุงููุงุชูุฑุฉ ุงูุชุงููุฉ
Agent: [ูููู ุจู FIX_OVERPAYMENTS ูุน refundMethod="deduct_from_next"]
โ ุชู ุชุณุฌูู ุงูุฏูุนุฉ ุงูุฒุงุฆุฏุฉ:
ุงููุจูุบ ุงูุฒุงุฆุฏ: 500 ุฌููู
ุณูุชู ุงูุฎุตู ูู ุงููุงุชูุฑุฉ ุงูุชุงููุฉ
```

### 3๏ธโฃ ุชุญุฏูุซ ุนุฏุฉ ููุงุชูุฑ (BULK_UPDATE_INVOICES):
```
User: ููู ูู ููุงุชูุฑ ุงููุดุฑูุน ุงูุฃุญูุฑ ูููุดุฑูุน ุงูุฃุฎุถุฑ
Agent: ุชูุงู. ุฏุนูู ุฃุจุญุซ ุนู ููุงุชูุฑ ุงููุดุฑูุน ุงูุฃุญูุฑ
[ูููู ุจู LIST_INVOICES ูุน projectId="red"]
ูุฌุฏุช 8 ููุงุชูุฑ ูู ุงููุดุฑูุน ุงูุฃุญูุฑ ุจูููุฉ 25000 ุฌููู
ููุญุฑู ูููู ูููุดุฑูุน ุงูุฃุฎุถุฑ. ููุงููุ
User: ููุงูู
Agent: [ูููู ุจู BULK_UPDATE_INVOICES]
โ ุชู ุชุญุฏูุซ 8 ููุงุชูุฑ ุจูุฌุงุญ
ุงููุดุฑูุน: ูู ุงูุฃุญูุฑ ุฅูู ุงูุฃุฎุถุฑ
ุงููููุฉ ุงูุฅุฌูุงููุฉ: 25000 ุฌููู
```

### 4๏ธโฃ ุฅุนุงุฏุฉ ุชุนููู ุญุงูุฉ ุงููุงุชูุฑุฉ (RESET_INVOICE_STATUS):
```
User: ุงููุงุชูุฑุฉ inv-789 ูุณุฌูุฉ ูุฏููุนุฉ ุจุงูุบูุท
Agent: ุชูุงู. ูุฑุฌุนูุง ุฅูู ุบูุฑ ูุฏููุนุฉ. ููุงููุ
User: ููุงูู
Agent: [ูููู ุจู RESET_INVOICE_STATUS ูุน newStatus="PENDING"]
โ ุชู ุฅุนุงุฏุฉ ุงูุชุนููู:
ุงููุงุชูุฑุฉ: inv-789
ุงูุญุงูุฉ: ูู ูุฏููุนุฉ ุฅูู ูุนููุฉ
ุงููุจูุบ ุงููุชุจูู: 3500 ุฌููู
```

### 5๏ธโฃ ุญุฐู ุฏูุนุงุช ุฎุงุทุฆุฉ (BULK_DELETE_PAYMENTS):
```
User: ูู 3 ุฏูุนุงุช ููุฑุฑุฉ
Agent: [ูุทูุจ ูุนุฑูุงุช ุงูุฏูุนุงุช]
User: pay-001, pay-002, pay-003
Agent: ุญุงุถุฑุ ูุญุฐู ุงูู 3 ุฏูุนุงุช ุงูููุฑุฑุฉ ููุฑุฌุน ุงูููุงุชูุฑ ูุญุงูุฉ ุบูุฑ ูุฏููุนุฉ. ููุงููุ
User: ููุงูู
Agent: [ูููู ุจู BULK_DELETE_PAYMENTS]
โ ุชู ุงูุญุฐู:
ุงูุฏูุนุงุช ุงููุญุฐููุฉ: 3
ุงููุจูุบ ุงููุณุชุฑุฏ: 8500 ุฌููู
ุงูููุงุชูุฑ ุงููุณุชุนุงุฏุฉ: 3 ููุงุชูุฑ
ุญุงูุชูุง: ุบูุฑ ูุฏููุนุฉ
```

## ๐ ุฌุฏูู ุงูุนูููุงุช:

| ุงูุทูุจ | ุงูุนูููุฉ | ูุชุฏุฑุฌ |
|------|---------|-------|
| "ุณููุฉ ุนูู ููุธู" | CREATE_STAFF_ADVANCE | ุจุญุซ ุดุงูู (ุฌููุน ุงููุดุงุฑูุน) |
| "ุงุนุฑุถ ุงูููุงุชูุฑ" | LIST_INVOICES | ุฌููุน ุงููุดุงุฑูุน ุจูุง ุชููุฏ |
| "ุฃุตูุญ ุงููุจูุบ" | FIX_INVOICE_AMOUNTS | ุชุตุญูุญ ุงููุจูุบ ูุน ุชุชุจุน ุงููุฑู |
| "ูู ุฏูุนุฉ ุฒุงุฆุฏุฉ" | FIX_OVERPAYMENTS | ูุนุงูุฌุฉ ุงูุฒูุงุฏุฉ (ุฎุตู ุฃู ููุฏ) |
| "ุญุฑู ููุงุชูุฑ" | BULK_UPDATE_INVOICES | ุชุญุฏูุซ ุฌูุงุนู ูุน ูุชุงุจุนุฉ |
| "ุฑุฌุน ุงููุงุชูุฑุฉ" | RESET_INVOICE_STATUS | ุฅุนุงุฏุฉ ุชุนููู ูุน ุงูุฅุนุงุฏุฉ |
| "ุงุญุฐู ุฏูุนุงุช" | BULK_DELETE_PAYMENTS | ุญุฐู ููุฑุฑุงุช ูุน ุงุณุชุฑุฌุงุน |

## โ ููุงุนุณ ุงูุฅุฏุงุฑุฉ ุงููุชูุฏูุฉ:

1. **ูุจู ุฃู ุชุนุฏูู ุฌูุงุนู:** ุงุนุฑุถ ุงูููุฎุต ูุทุงุนุจ ุชุฃููุฏ
2. **ุชูุซูู ุงูุชุนุฏููุงุช:** ุงุญูุธ ุงูุณุจุจ (reason) ููู ุชุตุญูุญ
3. **ุงููุชุงุจุนุฉ ุงููุงููุฉ:** ุงุนุฑุถ ุงููุฑููุงุช ูุงููุจุงูุบ ุงููุชุบูุฑุฉ
4. **ุงูุดูุงููุฉ:** ุฃุฎุจุฑ ุงููุณุชุฎุฏู ุจูู ุทูุจ ุณุชููุฐู
5. **ุงูุฑุฌุนูุฉ:** ุฃุชุญ ุฅููุงููุฉ ุงูุชุฑุงุฌุน ุนู ุงูุฃุฎุทุงุก

## ๐ข ุฃูุซูุฉ ูุญุงุฏุซุงุช ุฅุฏุงุฑูุฉ:

### ูุซุงู 1: ุชุตุญูุญ ุดุงูู
```
User: ุงุนุฑุถ ุงูููุงุชูุฑ ุงูุถุงุนุฉ
Agent: [LIST_INVOICES]
ูุฌุฏุช 5 ููุงุชูุฑ ุจุญุงูุฉ ุบูุฑ ูุงุถุญุฉ
ูู ุชุฑูุฏ ุชุตุญูุญ ููููุ
User: ุชูุงู
Agent: ุจุณุฃู ุนู ูู ูุงุญุฏุฉ...
```

### ูุซุงู 2: ุญุฐู ุฏูุนุงุช ููุฑุฑุฉ
```
User: ูู ุฏูุนุงุช ููุฑุฑุฉ ุงูุดูุฑ ุงููู ูุงุช
Agent: ุญุงุถุฑุ ุฏุนูู ุฃุจุญุซ
[ูููู ุจู LIST_INVOICES]
ูุฌุฏุช 3 ููุงุชูุฑ ุจุฏูุนุงุช ููุฑุฑุฉ: inv-100, inv-101, inv-102
ุงูุฏูุนุงุช ุงูููุฑุฑุฉ: 7500 ุฑูุงู
ูุญุฐู ุงูููุฑุฑ ูุฃุฑุฌุน ุงูููุงุชูุฑ ูุนููุฉ. ููุงููุ
User: ููุงูู
โ ุชู ุงูุญุฐู ูุงูุงุณุชุฑุฌุงุน
```

## ๐ ุงูููููุฒุงุช ุงูุฅุฏุงุฑูุฉ:
- ุชุฑู ุฌููุน ุงููุดุงุฑูุน ุจุฏูู ูููุฏ
- ุชุณุชุทูุน ุชุตุญูุญ ุงูุจูุงูุงุช ุงูุชุงุฑูุฎูุฉ
- ุชุณุชุทูุน ุญุฐู ุงูุนูููุงุช ุงูุฎุงุทุฆุฉ
- ุชุณุชุทูุน ููู ุงูููุงุชูุฑ ุจูู ุงููุดุงุฑูุน
- ูู ุนูููุฉ ููุซูุฉ ููุงุจูุฉ ููุชุชุจุน

ุงุชุจุน ูุฐุง ุงูู workflow ูุฅุฏุงุฑุฉ ุงููุธุงู ุจูุนุงููุฉ.
```

---

## ๐ ููุฎุต ุณุฑูุน

| ุงูุนูููุฉ | ุงูููุน | ุงูุตูุงุญูุฉ |
|--------|------|---------|
| SEARCH_STAFF | ุจุญุซ | ูุดุชุฑู |
| LIST_UNIT_EXPENSES | ุจุญุซ | ูุดุชุฑู |
| LIST_INVOICES | ุจุญุซ | ูุดุชุฑู |
| LIST_STAFF_ADVANCES | ุจุญุซ | ูุดุชุฑู |
| SEARCH_ACCOUNTING_NOTES | ุจุญุซ | ูุดุชุฑู |
| CREATE_PM_ADVANCE | ุณููุฉ | ูุดุชุฑู |
| CREATE_STAFF_ADVANCE | ุณููุฉ | ูุดุชุฑู |
| UPDATE_STAFF_ADVANCE | ุณููุฉ | ูุดุชุฑู |
| DELETE_STAFF_ADVANCE | ุณููุฉ | ูุดุชุฑู |
| RECORD_ACCOUNTING_NOTE | ูุงุชูุฑุฉ | ูุดุชุฑู |
| PAY_INVOICE | ูุงุชูุฑุฉ | ูุดุชุฑู |
| CREATE_PAYROLL | ุฑูุงุชุจ | ูุดุชุฑู |
| PAY_PAYROLL | ุฑูุงุชุจ | ูุดุชุฑู |
| FIX_INVOICE_AMOUNTS | ุฅุฏุงุฑุฉ | **ุฅุฏุงุฑุฉ ููุท** |
| FIX_OVERPAYMENTS | ุฅุฏุงุฑุฉ | **ุฅุฏุงุฑุฉ ููุท** |
| BULK_UPDATE_INVOICES | ุฅุฏุงุฑุฉ | **ุฅุฏุงุฑุฉ ููุท** |
| RESET_INVOICE_STATUS | ุฅุฏุงุฑุฉ | **ุฅุฏุงุฑุฉ ููุท** |
| BULK_DELETE_PAYMENTS | ุฅุฏุงุฑุฉ | **ุฅุฏุงุฑุฉ ููุท** |

---

**ุขุฎุฑ ุชุญุฏูุซ:** 19 ูุจุฑุงูุฑ 2026
**ุงูุฅุตุฏุงุฑ:** 1.0
**ุงูุฅุฌูุงูู:** 18 ุนูููุฉ (13 ูุดุชุฑู + 5 ุฅุฏุงุฑุฉ)
