{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 16, "column": 0}, "map": {"version":3,"sources":["turbopack:///[project]/Desktop/cmd-main/src/middleware.ts"],"sourcesContent":["import { withAuth } from \"next-auth/middleware\"\nimport { NextResponse } from \"next/server\"\n\n// Define which routes are protected and which roles can access them\nconst protectedRoutes = {\n  \"/dashboard\": [\"ADMIN\", \"ACCOUNTANT\", \"PROJECT_MANAGER\"],\n  \"/dashboard/admin\": [\"ADMIN\"],\n  \"/dashboard/projects\": [\"ADMIN\", \"PROJECT_MANAGER\"],\n  \"/dashboard/operational-units\": [\"ADMIN\"],\n  \"/dashboard/residents\": [\"ADMIN\", \"PROJECT_MANAGER\"],\n  \"/dashboard/tickets\": [\"ADMIN\", \"PROJECT_MANAGER\"],\n  \"/dashboard/delivery-orders\": [\"ADMIN\", \"PROJECT_MANAGER\"],\n  \"/dashboard/invoices\": [\"ADMIN\", \"ACCOUNTANT\"],\n  \"/dashboard/payments\": [\"ADMIN\", \"ACCOUNTANT\"],\n  \"/dashboard/accounting-notes\": [\"ADMIN\", \"ACCOUNTANT\", \"PROJECT_MANAGER\"],\n  \"/dashboard/staff\": [\"ADMIN\", \"ACCOUNTANT\"],\n  \"/dashboard/reports\": [\"ADMIN\"],\n  \"/dashboard/settings\": [\"ADMIN\"]\n}\n\nexport default withAuth(\n  function middleware(req) {\n    const token = req.nextauth.token\n    const path = req.nextUrl.pathname\n\n    // Check if the path starts with /dashboard\n    if (path.startsWith(\"/dashboard\")) {\n      // Find the most specific matching route\n      let matchedRoute: string | null = null\n      const pathSegments = path.split(\"/\")\n      \n      // Check from most specific to least specific\n      for (let i = pathSegments.length; i >= 2; i--) {\n        const routePath = pathSegments.slice(0, i).join(\"/\")\n        if (protectedRoutes[routePath]) {\n          matchedRoute = routePath\n          break\n        }\n      }\n\n      // Default to /dashboard if no specific route matched\n      if (!matchedRoute) {\n        matchedRoute = \"/dashboard\"\n      }\n\n      const allowedRoles = matchedRoute ? protectedRoutes[matchedRoute] : undefined\n\n      // Check if user has required role\n      if (!token || !allowedRoles || !allowedRoles.includes(token.role as string)) {\n        return NextResponse.redirect(new URL(\"/unauthorized\", req.url))\n      }\n\n      // Redirect based on role if accessing root dashboard\n      if (path === \"/dashboard\") {\n        if (token.role === \"ACCOUNTANT\") {\n          return NextResponse.redirect(new URL(\"/dashboard/accountant\", req.url))\n        } else if (token.role === \"PROJECT_MANAGER\") {\n          return NextResponse.redirect(new URL(\"/dashboard/manager\", req.url))\n        }\n        // Admin stays on /dashboard or can go to /dashboard/admin\n      }\n    }\n\n    return NextResponse.next()\n  },\n  {\n    callbacks: {\n      authorized: ({ token }) => !!token\n    }\n  }\n)\n\nexport const config = {\n  matcher: [\n    \"/dashboard/:path*\"\n  ]\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AAAA;;;AAEA,oEAAoE;AACpE,MAAM,kBAAkB;IACtB,cAAc;QAAC;QAAS;QAAc;KAAkB;IACxD,oBAAoB;QAAC;KAAQ;IAC7B,uBAAuB;QAAC;QAAS;KAAkB;IACnD,gCAAgC;QAAC;KAAQ;IACzC,wBAAwB;QAAC;QAAS;KAAkB;IACpD,sBAAsB;QAAC;QAAS;KAAkB;IAClD,8BAA8B;QAAC;QAAS;KAAkB;IAC1D,uBAAuB;QAAC;QAAS;KAAa;IAC9C,uBAAuB;QAAC;QAAS;KAAa;IAC9C,+BAA+B;QAAC;QAAS;QAAc;KAAkB;IACzE,oBAAoB;QAAC;QAAS;KAAa;IAC3C,sBAAsB;QAAC;KAAQ;IAC/B,uBAAuB;QAAC;KAAQ;AAClC;uCAEe,IAAA,wLAAQ,EACrB,SAAS,WAAW,GAAG;IACrB,MAAM,QAAQ,IAAI,QAAQ,CAAC,KAAK;IAChC,MAAM,OAAO,IAAI,OAAO,CAAC,QAAQ;IAEjC,2CAA2C;IAC3C,IAAI,KAAK,UAAU,CAAC,eAAe;QACjC,wCAAwC;QACxC,IAAI,eAA8B;QAClC,MAAM,eAAe,KAAK,KAAK,CAAC;QAEhC,6CAA6C;QAC7C,IAAK,IAAI,IAAI,aAAa,MAAM,EAAE,KAAK,GAAG,IAAK;YAC7C,MAAM,YAAY,aAAa,KAAK,CAAC,GAAG,GAAG,IAAI,CAAC;YAChD,IAAI,eAAe,CAAC,UAAU,EAAE;gBAC9B,eAAe;gBACf;YACF;QACF;QAEA,qDAAqD;QACrD,IAAI,CAAC,cAAc;YACjB,eAAe;QACjB;QAEA,MAAM,eAAe,eAAe,eAAe,CAAC,aAAa,GAAG;QAEpE,kCAAkC;QAClC,IAAI,CAAC,SAAS,CAAC,gBAAgB,CAAC,aAAa,QAAQ,CAAC,MAAM,IAAI,GAAa;YAC3E,OAAO,0NAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,iBAAiB,IAAI,GAAG;QAC/D;QAEA,qDAAqD;QACrD,IAAI,SAAS,cAAc;YACzB,IAAI,MAAM,IAAI,KAAK,cAAc;gBAC/B,OAAO,0NAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,yBAAyB,IAAI,GAAG;YACvE,OAAO,IAAI,MAAM,IAAI,KAAK,mBAAmB;gBAC3C,OAAO,0NAAY,CAAC,QAAQ,CAAC,IAAI,IAAI,sBAAsB,IAAI,GAAG;YACpE;QACA,0DAA0D;QAC5D;IACF;IAEA,OAAO,0NAAY,CAAC,IAAI;AAC1B,GACA;IACE,WAAW;QACT,YAAY,CAAC,EAAE,KAAK,EAAE,GAAK,CAAC,CAAC;IAC/B;AACF;AAGK,MAAM,SAAS;IACpB,SAAS;QACP;KACD;AACH"}}]
}