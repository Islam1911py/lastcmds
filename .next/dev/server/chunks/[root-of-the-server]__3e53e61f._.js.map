{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 48, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/USER/Desktop/cmd-main/src/app/api/invoices/%5Bid%5D/pdf/route.ts"],"sourcesContent":["import { NextRequest, NextResponse } from \"next/server\"\nimport { cookies } from \"next/headers\"\nimport { chromium } from \"playwright\"\n\nexport const runtime = \"nodejs\"\n\nexport async function GET(\n  request: NextRequest,\n  { params }: { params: Promise<{ id: string }> }\n) {\n  const { id } = await params\n  if (!id || id === \"undefined\") {\n    return NextResponse.json({ error: \"Missing invoice id\" }, { status: 400 })\n  }\n\n  const baseUrl = request.nextUrl.origin\n  const targetUrl = new URL(`/dashboard/invoices/${id}?print=1`, baseUrl)\n  const cookieStore = await cookies()\n  const cookieValues = cookieStore.getAll()\n  const baseHost = new URL(baseUrl).hostname\n\n  const browser = await chromium.launch({ headless: true })\n  try {\n    const context = await browser.newContext({\n      locale: \"ar-EG\",\n      timezoneId: \"Africa/Cairo\",\n    })\n\n    if (cookieValues.length > 0) {\n      await context.addCookies(\n        cookieValues.map((cookie) => ({\n          name: cookie.name,\n          value: cookie.value,\n          domain: baseHost,\n          path: \"/\",\n        }))\n      )\n    }\n\n    const page = await context.newPage()\n    await page.goto(targetUrl.toString(), { waitUntil: \"networkidle\" })\n    await page.emulateMedia({ media: \"print\" })\n\n    if (page.url().includes(\"/login\")) {\n      return NextResponse.json({ error: \"Unauthorized\" }, { status: 401 })\n    }\n\n    const pdf = await page.pdf({\n      format: \"A4\",\n      printBackground: true,\n      preferCSSPageSize: true,\n      margin: { top: \"12mm\", right: \"12mm\", bottom: \"12mm\", left: \"12mm\" },\n    })\n\n    return new NextResponse(new Uint8Array(pdf), {\n      headers: {\n        \"Content-Type\": \"application/pdf\",\n        \"Content-Disposition\": `attachment; filename=\"invoice-${id}.pdf\"`,\n      },\n    })\n  } finally {\n    await browser.close()\n  }\n}\n"],"names":[],"mappings":";;;;;;AAAA;AACA;AACA;;;;;;;;AAEO,MAAM,UAAU;AAEhB,eAAe,IACpB,OAAoB,EACpB,EAAE,MAAM,EAAuC;IAE/C,MAAM,EAAE,EAAE,EAAE,GAAG,MAAM;IACrB,IAAI,CAAC,MAAM,OAAO,aAAa;QAC7B,OAAO,0KAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAqB,GAAG;YAAE,QAAQ;QAAI;IAC1E;IAEA,MAAM,UAAU,QAAQ,OAAO,CAAC,MAAM;IACtC,MAAM,YAAY,IAAI,IAAI,CAAC,oBAAoB,EAAE,GAAG,QAAQ,CAAC,EAAE;IAC/D,MAAM,cAAc,MAAM,IAAA,sKAAO;IACjC,MAAM,eAAe,YAAY,MAAM;IACvC,MAAM,WAAW,IAAI,IAAI,SAAS,QAAQ;IAE1C,MAAM,UAAU,MAAM,2MAAQ,CAAC,MAAM,CAAC;QAAE,UAAU;IAAK;IACvD,IAAI;QACF,MAAM,UAAU,MAAM,QAAQ,UAAU,CAAC;YACvC,QAAQ;YACR,YAAY;QACd;QAEA,IAAI,aAAa,MAAM,GAAG,GAAG;YAC3B,MAAM,QAAQ,UAAU,CACtB,aAAa,GAAG,CAAC,CAAC,SAAW,CAAC;oBAC5B,MAAM,OAAO,IAAI;oBACjB,OAAO,OAAO,KAAK;oBACnB,QAAQ;oBACR,MAAM;gBACR,CAAC;QAEL;QAEA,MAAM,OAAO,MAAM,QAAQ,OAAO;QAClC,MAAM,KAAK,IAAI,CAAC,UAAU,QAAQ,IAAI;YAAE,WAAW;QAAc;QACjE,MAAM,KAAK,YAAY,CAAC;YAAE,OAAO;QAAQ;QAEzC,IAAI,KAAK,GAAG,GAAG,QAAQ,CAAC,WAAW;YACjC,OAAO,0KAAY,CAAC,IAAI,CAAC;gBAAE,OAAO;YAAe,GAAG;gBAAE,QAAQ;YAAI;QACpE;QAEA,MAAM,MAAM,MAAM,KAAK,GAAG,CAAC;YACzB,QAAQ;YACR,iBAAiB;YACjB,mBAAmB;YACnB,QAAQ;gBAAE,KAAK;gBAAQ,OAAO;gBAAQ,QAAQ;gBAAQ,MAAM;YAAO;QACrE;QAEA,OAAO,IAAI,0KAAY,CAAC,IAAI,WAAW,MAAM;YAC3C,SAAS;gBACP,gBAAgB;gBAChB,uBAAuB,CAAC,8BAA8B,EAAE,GAAG,KAAK,CAAC;YACnE;QACF;IACF,SAAU;QACR,MAAM,QAAQ,KAAK;IACrB;AACF"}}]
}