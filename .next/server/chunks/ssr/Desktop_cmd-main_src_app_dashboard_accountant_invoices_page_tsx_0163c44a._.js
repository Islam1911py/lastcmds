module.exports=[73804,a=>{"use strict";var b=a.i(43713),c=a.i(68599),d=a.i(84642),e=a.i(22654),f=a.i(49015),g=a.i(88497),h=a.i(57684),i=a.i(63395),j=a.i(84177),k=a.i(65189),l=a.i(59627),m=a.i(61977),n=a.i(77726),o=a.i(48421);function p(){let{data:a}=(0,d.useSession)(),[p,q]=(0,c.useState)([]),[r,s]=(0,c.useState)(!0),[t,u]=(0,c.useState)(null),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)(""),[z,A]=(0,c.useState)(!1),[B,C]=(0,c.useState)("open");(0,c.useEffect)(()=>{D()},[]);let D=async()=>{try{s(!0);let a=await fetch("/api/invoices");if(a.ok){let b=await a.json();q(b)}}catch(a){console.error("Error fetching invoices:",a)}finally{s(!1)}},E=async()=>{if(!t)return;let a=parseFloat(x);if(!a||a<=0)return void alert("أدخل مبلغاً صحيحاً");if(a>t.remainingBalance)return void alert("المبلغ أكبر من المستحق");try{A(!0);let b=await fetch(`/api/invoices/${t.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"pay",amount:a})});if(b.ok)w(!1),y(""),D();else{let a=await b.json();alert(a.error||"فشل الدفع")}}catch(a){console.error("Error making payment:",a),alert("حدث خطأ أثناء الدفع")}finally{A(!1)}},F=p.filter(a=>"open"===B?a.remainingBalance>0:"partial"===B?a.remainingBalance>0&&a.totalPaid>0:"paid"!==B||a.isPaid),G=p.filter(a=>a.remainingBalance>0),H=G.filter(a=>a.totalPaid>0),I=G.reduce((a,b)=>a+b.remainingBalance,0);return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"إدارة الفواتير"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"عرض وإدارة جميع الفواتير"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[(0,b.jsxs)(h.Card,{children:[(0,b.jsxs)(h.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,b.jsx)(h.CardTitle,{className:"text-sm font-medium",children:"الفواتير المفتوحة"}),(0,b.jsx)(e.FileText,{className:"h-4 w-4 text-blue-500"})]}),(0,b.jsxs)(h.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:G.length}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"بانتظار الدفع"})]})]}),(0,b.jsxs)(h.Card,{children:[(0,b.jsxs)(h.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,b.jsx)(h.CardTitle,{className:"text-sm font-medium",children:"دفعات جزئية"}),(0,b.jsx)(e.FileText,{className:"h-4 w-4 text-purple-500"})]}),(0,b.jsxs)(h.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:H.length}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"تم سداد جزء من المبلغ"})]})]}),(0,b.jsxs)(h.Card,{children:[(0,b.jsxs)(h.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,b.jsx)(h.CardTitle,{className:"text-sm font-medium",children:"المستحق الكلي"}),(0,b.jsx)(f.DollarSign,{className:"h-4 w-4 text-orange-500"})]}),(0,b.jsxs)(h.CardContent,{children:[(0,b.jsxs)("div",{className:"text-2xl font-bold text-orange-600",children:[I.toLocaleString()," ج.م"]}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"من الفواتير المفتوحة"})]})]}),(0,b.jsxs)(h.Card,{children:[(0,b.jsxs)(h.CardHeader,{className:"flex flex-row items-center justify-between pb-2",children:[(0,b.jsx)(h.CardTitle,{className:"text-sm font-medium",children:"الفواتير المدفوعة"}),(0,b.jsx)(g.Check,{className:"h-4 w-4 text-green-500"})]}),(0,b.jsxs)(h.CardContent,{children:[(0,b.jsx)("div",{className:"text-2xl font-bold",children:p.filter(a=>a.isPaid).length}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:"مكتملة ومغلقة"})]})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsx)(i.Button,{variant:"open"===B?"default":"outline",onClick:()=>C("open"),children:"مفتوح"}),(0,b.jsx)(i.Button,{variant:"partial"===B?"default":"outline",onClick:()=>C("partial"),children:"دفع جزئي"}),(0,b.jsx)(i.Button,{variant:"all"===B?"default":"outline",onClick:()=>C("all"),children:"الكل"}),(0,b.jsx)(i.Button,{variant:"paid"===B?"default":"outline",onClick:()=>C("paid"),children:"مدفوع"})]}),(0,b.jsxs)(h.Card,{children:[(0,b.jsx)(h.CardHeader,{children:(0,b.jsx)(h.CardTitle,{children:"الفواتير"})}),(0,b.jsx)(h.CardContent,{children:r?(0,b.jsx)("div",{className:"space-y-2",children:[void 0,void 0,void 0,void 0,void 0].map((a,c)=>(0,b.jsx)(j.Skeleton,{className:"h-12 w-full"},c))}):0===F.length?(0,b.jsx)("div",{className:"text-center py-8 text-muted-foreground",children:"لا توجد فواتير"}):(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(n.Table,{children:[(0,b.jsx)(n.TableHeader,{children:(0,b.jsxs)(n.TableRow,{children:[(0,b.jsx)(n.TableHead,{children:"رقم الفاتورة"}),(0,b.jsx)(n.TableHead,{children:"المشروع"}),(0,b.jsx)(n.TableHead,{children:"الوحدة"}),(0,b.jsx)(n.TableHead,{children:"النوع"}),(0,b.jsx)(n.TableHead,{className:"text-right",children:"المبلغ"}),(0,b.jsx)(n.TableHead,{className:"text-right",children:"المتبقي"}),(0,b.jsx)(n.TableHead,{children:"الحالة"}),(0,b.jsx)(n.TableHead,{})]})}),(0,b.jsx)(n.TableBody,{children:F.map(a=>(0,b.jsxs)(n.TableRow,{children:[(0,b.jsx)(n.TableCell,{className:"font-medium",children:a.invoiceNumber}),(0,b.jsxs)(n.TableCell,{children:[(0,b.jsx)("div",{className:"text-sm",children:a.unit.project.name}),(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:a.unit.code})]}),(0,b.jsx)(n.TableCell,{children:a.unit.name}),(0,b.jsx)(n.TableCell,{children:(0,b.jsx)(k.Badge,{variant:"outline",children:"MANAGEMENT_SERVICE"===a.type?"خدمات":"مطالبة"})}),(0,b.jsxs)(n.TableCell,{className:"text-right font-medium",children:[a.amount.toLocaleString()," ج.م"]}),(0,b.jsx)(n.TableCell,{className:"text-right font-medium",children:(0,b.jsxs)("span",{className:a.remainingBalance>0?"text-orange-600":"text-green-600",children:[a.remainingBalance.toLocaleString()," ج.م"]})}),(0,b.jsx)(n.TableCell,{children:(0,b.jsx)(k.Badge,{variant:a.isPaid?"default":"secondary",className:a.isPaid?"bg-green-600":"bg-orange-600",children:a.isPaid?"مدفوع":"مفتوح"})}),(0,b.jsx)(n.TableCell,{className:"text-right",children:(0,b.jsx)(i.Button,{variant:"outline",size:"sm",onClick:()=>{u(a),y(""),w(!0)},children:"تفاصيل"})})]},a.id))})]})})})]}),(0,b.jsx)(o.Dialog,{open:v,onOpenChange:w,children:(0,b.jsxs)(o.DialogContent,{className:"max-w-3xl max-h-[90vh] overflow-y-auto",children:[(0,b.jsxs)(o.DialogHeader,{children:[(0,b.jsx)(o.DialogTitle,{children:"تفاصيل الفاتورة"}),(0,b.jsx)(o.DialogDescription,{children:t?.invoiceNumber})]}),t&&(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-4 pb-4 border-b",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"المشروع"}),(0,b.jsx)("p",{className:"font-medium",children:t.unit.project.name})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"الوحدة"}),(0,b.jsx)("p",{className:"font-medium",children:t.unit.name})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"رقم الوحدة"}),(0,b.jsx)("p",{className:"font-medium",children:t.unit.code})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"نوع الفاتورة"}),(0,b.jsx)("p",{className:"font-medium",children:"MANAGEMENT_SERVICE"===t.type?"فاتورة خدمات":"فاتورة مطالبة"})]})]}),t.expenses&&t.expenses.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"font-semibold mb-3",children:"المصاريف المرتبطة"}),(0,b.jsx)("div",{className:"overflow-x-auto border rounded-lg",children:(0,b.jsxs)(n.Table,{children:[(0,b.jsx)(n.TableHeader,{className:"bg-gray-50 dark:bg-gray-900",children:(0,b.jsxs)(n.TableRow,{children:[(0,b.jsx)(n.TableHead,{children:"الوصف"}),(0,b.jsx)(n.TableHead,{className:"text-right",children:"المبلغ"}),(0,b.jsx)(n.TableHead,{className:"text-right",children:"النوع"})]})}),(0,b.jsx)(n.TableBody,{children:t.expenses.map(a=>(0,b.jsxs)(n.TableRow,{children:[(0,b.jsx)(n.TableCell,{className:"font-medium",children:a.description}),(0,b.jsxs)(n.TableCell,{className:"text-right font-medium",children:[a.amount.toLocaleString()," ج.م"]}),(0,b.jsx)(n.TableCell,{className:"text-right text-sm text-muted-foreground",children:a.sourceType})]},a.id))})]})})]}),(0,b.jsxs)("div",{className:"space-y-3 p-4 bg-gray-50 dark:bg-gray-900 rounded-lg",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"إجمالي المبلغ"}),(0,b.jsxs)("p",{className:"font-semibold text-lg",children:[t.amount.toLocaleString()," ج.م"]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"المدفوع"}),(0,b.jsxs)("p",{className:"font-semibold text-lg text-green-600",children:[(t.totalPaid||0).toLocaleString()," ج.م"]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"المتبقي"}),(0,b.jsxs)("p",{className:"font-semibold text-lg text-orange-600",children:[t.remainingBalance.toLocaleString()," ج.م"]})]}),(0,b.jsxs)("div",{className:"flex items-center justify-between pt-2 border-t",children:[(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"الحالة"}),(0,b.jsx)(k.Badge,{className:t.isPaid?"bg-green-600":"bg-orange-600",children:t.isPaid?"مدفوع":"مفتوح"})]})]}),!t.isPaid&&(0,b.jsxs)("div",{className:"space-y-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg border border-blue-200 dark:border-blue-800",children:[(0,b.jsx)("h3",{className:"font-semibold",children:"دفع الفاتورة"}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(m.Label,{htmlFor:"paymentAmount",children:"مبلغ الدفع (ج.م)"}),(0,b.jsx)(l.Input,{id:"paymentAmount",type:"number",step:"0.01",min:"0",max:t.remainingBalance,value:x,onChange:a=>y(a.target.value),placeholder:`أقصى: ${t.remainingBalance.toLocaleString()}`,disabled:z}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground",children:["المتبقي: ",t.remainingBalance.toLocaleString()," ج.م"]})]}),(0,b.jsx)("div",{className:"flex gap-2",children:(0,b.jsx)(i.Button,{variant:"outline",onClick:()=>y(t.remainingBalance.toString()),disabled:z,className:"flex-1",children:"دفع كامل المبلغ"})})]})]}),(0,b.jsxs)(o.DialogFooter,{className:"gap-2",children:[(0,b.jsx)(i.Button,{variant:"outline",onClick:()=>w(!1),disabled:z,children:"إغلاق"}),t&&!t.isPaid&&(0,b.jsx)(i.Button,{onClick:E,disabled:z||!x,className:"bg-green-600 hover:bg-green-700",children:z?"جاري الدفع...":"تأكيد الدفع"})]})]})})]})}a.s(["default",()=>p])}];

//# sourceMappingURL=Desktop_cmd-main_src_app_dashboard_accountant_invoices_page_tsx_0163c44a._.js.map