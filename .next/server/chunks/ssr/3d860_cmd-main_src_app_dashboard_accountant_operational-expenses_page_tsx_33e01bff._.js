module.exports=[20894,a=>{"use strict";var b=a.i(43713),c=a.i(68599),d=a.i(84642),e=a.i(84194),f=a.i(63395),g=a.i(59627),h=a.i(61977),i=a.i(57684),j=a.i(84177),k=a.i(48367),l=a.i(48421),m=a.i(77726),n=a.i(72760),o=a.i(22488),p=a.i(94171);let q=(0,a.i(90306).default)("wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);var r=a.i(22654),s=a.i(66128),t=a.i(65189),u=a.i(71949),v=a.i(14723),w=a.i(78252),x=a.i(30737),y=a.i(45158),z=a.i(58080),A=a.i(32140),B=a.i(12477),C=a.i(40523),D="Collapsible",[E,F]=(0,u.createContextScope)(D),[G,H]=E(D),I=c.forwardRef((a,d)=>{let{__scopeCollapsible:e,open:f,defaultOpen:g,disabled:h,onOpenChange:i,...j}=a,[k,l]=(0,y.useControllableState)({prop:f,defaultProp:g??!1,onChange:i,caller:D});return(0,b.jsx)(G,{scope:e,disabled:h,contentId:(0,C.useId)(),open:k,onOpenToggle:c.useCallback(()=>l(a=>!a),[l]),children:(0,b.jsx)(z.Primitive.div,{"data-state":O(k),"data-disabled":h?"":void 0,...j,ref:d})})});I.displayName=D;var J="CollapsibleTrigger",K=c.forwardRef((a,c)=>{let{__scopeCollapsible:d,...e}=a,f=H(J,d);return(0,b.jsx)(z.Primitive.button,{type:"button","aria-controls":f.contentId,"aria-expanded":f.open||!1,"data-state":O(f.open),"data-disabled":f.disabled?"":void 0,disabled:f.disabled,...e,ref:c,onClick:(0,x.composeEventHandlers)(a.onClick,f.onOpenToggle)})});K.displayName=J;var L="CollapsibleContent",M=c.forwardRef((a,c)=>{let{forceMount:d,...e}=a,f=H(L,a.__scopeCollapsible);return(0,b.jsx)(B.Presence,{present:d||f.open,children:({present:a})=>(0,b.jsx)(N,{...e,ref:c,present:a})})});M.displayName=L;var N=c.forwardRef((a,d)=>{let{__scopeCollapsible:e,present:f,children:g,...h}=a,i=H(L,e),[j,k]=c.useState(f),l=c.useRef(null),m=(0,w.useComposedRefs)(d,l),n=c.useRef(0),o=n.current,p=c.useRef(0),q=p.current,r=i.open||j,s=c.useRef(r),t=c.useRef(void 0);return c.useEffect(()=>{let a=requestAnimationFrame(()=>s.current=!1);return()=>cancelAnimationFrame(a)},[]),(0,A.useLayoutEffect)(()=>{let a=l.current;if(a){t.current=t.current||{transitionDuration:a.style.transitionDuration,animationName:a.style.animationName},a.style.transitionDuration="0s",a.style.animationName="none";let b=a.getBoundingClientRect();n.current=b.height,p.current=b.width,s.current||(a.style.transitionDuration=t.current.transitionDuration,a.style.animationName=t.current.animationName),k(f)}},[i.open,f]),(0,b.jsx)(z.Primitive.div,{"data-state":O(i.open),"data-disabled":i.disabled?"":void 0,id:i.contentId,hidden:!r,...h,ref:m,style:{"--radix-collapsible-content-height":o?`${o}px`:void 0,"--radix-collapsible-content-width":q?`${q}px`:void 0,...a.style},children:r&&g})});function O(a){return a?"open":"closed"}var P=a.i(8579),Q="Accordion",R=["Home","End","ArrowDown","ArrowUp","ArrowLeft","ArrowRight"],[S,T,U]=(0,v.createCollection)(Q),[V,W]=(0,u.createContextScope)(Q,[U,F]),X=F(),Y=c.default.forwardRef((a,c)=>{let{type:d,...e}=a;return(0,b.jsx)(S.Provider,{scope:a.__scopeAccordion,children:"multiple"===d?(0,b.jsx)(ac,{...e,ref:c}):(0,b.jsx)(ab,{...e,ref:c})})});Y.displayName=Q;var[Z,$]=V(Q),[_,aa]=V(Q,{collapsible:!1}),ab=c.default.forwardRef((a,d)=>{let{value:e,defaultValue:f,onValueChange:g=()=>{},collapsible:h=!1,...i}=a,[j,k]=(0,y.useControllableState)({prop:e,defaultProp:f??"",onChange:g,caller:Q});return(0,b.jsx)(Z,{scope:a.__scopeAccordion,value:c.default.useMemo(()=>j?[j]:[],[j]),onItemOpen:k,onItemClose:c.default.useCallback(()=>h&&k(""),[h,k]),children:(0,b.jsx)(_,{scope:a.__scopeAccordion,collapsible:h,children:(0,b.jsx)(af,{...i,ref:d})})})}),ac=c.default.forwardRef((a,d)=>{let{value:e,defaultValue:f,onValueChange:g=()=>{},...h}=a,[i,j]=(0,y.useControllableState)({prop:e,defaultProp:f??[],onChange:g,caller:Q}),k=c.default.useCallback(a=>j((b=[])=>[...b,a]),[j]),l=c.default.useCallback(a=>j((b=[])=>b.filter(b=>b!==a)),[j]);return(0,b.jsx)(Z,{scope:a.__scopeAccordion,value:i,onItemOpen:k,onItemClose:l,children:(0,b.jsx)(_,{scope:a.__scopeAccordion,collapsible:!0,children:(0,b.jsx)(af,{...h,ref:d})})})}),[ad,ae]=V(Q),af=c.default.forwardRef((a,d)=>{let{__scopeAccordion:e,disabled:f,dir:g,orientation:h="vertical",...i}=a,j=c.default.useRef(null),k=(0,w.useComposedRefs)(j,d),l=T(e),m="ltr"===(0,P.useDirection)(g),n=(0,x.composeEventHandlers)(a.onKeyDown,a=>{if(!R.includes(a.key))return;let b=a.target,c=l().filter(a=>!a.ref.current?.disabled),d=c.findIndex(a=>a.ref.current===b),e=c.length;if(-1===d)return;a.preventDefault();let f=d,g=e-1,i=()=>{(f=d+1)>g&&(f=0)},j=()=>{(f=d-1)<0&&(f=g)};switch(a.key){case"Home":f=0;break;case"End":f=g;break;case"ArrowRight":"horizontal"===h&&(m?i():j());break;case"ArrowDown":"vertical"===h&&i();break;case"ArrowLeft":"horizontal"===h&&(m?j():i());break;case"ArrowUp":"vertical"===h&&j()}let k=f%e;c[k].ref.current?.focus()});return(0,b.jsx)(ad,{scope:e,disabled:f,direction:g,orientation:h,children:(0,b.jsx)(S.Slot,{scope:e,children:(0,b.jsx)(z.Primitive.div,{...i,"data-orientation":h,ref:k,onKeyDown:f?void 0:n})})})}),ag="AccordionItem",[ah,ai]=V(ag),aj=c.default.forwardRef((a,c)=>{let{__scopeAccordion:d,value:e,...f}=a,g=ae(ag,d),h=$(ag,d),i=X(d),j=(0,C.useId)(),k=e&&h.value.includes(e)||!1,l=g.disabled||a.disabled;return(0,b.jsx)(ah,{scope:d,open:k,disabled:l,triggerId:j,children:(0,b.jsx)(I,{"data-orientation":g.orientation,"data-state":aq(k),...i,...f,ref:c,disabled:l,open:k,onOpenChange:a=>{a?h.onItemOpen(e):h.onItemClose(e)}})})});aj.displayName=ag;var ak="AccordionHeader",al=c.default.forwardRef((a,c)=>{let{__scopeAccordion:d,...e}=a,f=ae(Q,d),g=ai(ak,d);return(0,b.jsx)(z.Primitive.h3,{"data-orientation":f.orientation,"data-state":aq(g.open),"data-disabled":g.disabled?"":void 0,...e,ref:c})});al.displayName=ak;var am="AccordionTrigger",an=c.default.forwardRef((a,c)=>{let{__scopeAccordion:d,...e}=a,f=ae(Q,d),g=ai(am,d),h=aa(am,d),i=X(d);return(0,b.jsx)(S.ItemSlot,{scope:d,children:(0,b.jsx)(K,{"aria-disabled":g.open&&!h.collapsible||void 0,"data-orientation":f.orientation,id:g.triggerId,...i,...e,ref:c})})});an.displayName=am;var ao="AccordionContent",ap=c.default.forwardRef((a,c)=>{let{__scopeAccordion:d,...e}=a,f=ae(Q,d),g=ai(ao,d),h=X(d);return(0,b.jsx)(M,{role:"region","aria-labelledby":g.triggerId,"data-orientation":f.orientation,...h,...e,ref:c,style:{"--radix-accordion-content-height":"var(--radix-collapsible-content-height)","--radix-accordion-content-width":"var(--radix-collapsible-content-width)",...a.style}})});function aq(a){return a?"open":"closed"}ap.displayName=ao;var ar=a.i(13458),as=a.i(41662);function at({...a}){return(0,b.jsx)(Y,{"data-slot":"accordion",...a})}function au({className:a,...c}){return(0,b.jsx)(aj,{"data-slot":"accordion-item",className:(0,as.cn)("border-b last:border-b-0",a),...c})}function av({className:a,children:c,...d}){return(0,b.jsx)(al,{className:"flex",children:(0,b.jsxs)(an,{"data-slot":"accordion-trigger",className:(0,as.cn)("focus-visible:border-ring focus-visible:ring-ring/50 flex flex-1 items-start justify-between gap-4 rounded-md py-4 text-left text-sm font-medium transition-all outline-none hover:underline focus-visible:ring-[3px] disabled:pointer-events-none disabled:opacity-50 [&[data-state=open]>svg]:rotate-180",a),...d,children:[c,(0,b.jsx)(ar.ChevronDownIcon,{className:"text-muted-foreground pointer-events-none size-4 shrink-0 translate-y-0.5 transition-transform duration-200"})]})})}function aw({className:a,children:c,...d}){return(0,b.jsx)(ap,{"data-slot":"accordion-content",className:"data-[state=closed]:animate-accordion-up data-[state=open]:animate-accordion-down overflow-hidden text-sm",...d,children:(0,b.jsx)("div",{className:(0,as.cn)("pt-0 pb-4",a),children:c})})}function ax(){let{data:a}=(0,d.useSession)(),{toast:u}=(0,e.useToast)(),[v,w]=(0,c.useState)(!1),[x,y]=(0,c.useState)(!1),[z,A]=(0,c.useState)(!0),[B,C]=(0,c.useState)("OFFICE_FUND"),[D,E]=(0,c.useState)([]),[F,G]=(0,c.useState)([]),[H,I]=(0,c.useState)([]),[J,K]=(0,c.useState)([]),[L,M]=(0,c.useState)([]),[N,O]=(0,c.useState)({projectId:"",unitId:"",description:"",amount:"",pmAdvanceId:""}),[P,Q]=(0,c.useState)(""),R=(0,c.useMemo)(()=>L.filter(a=>"PENDING"===a.status),[L]),S=(0,c.useMemo)(()=>R.reduce((a,b)=>a+b.amount,0),[R]),T=(0,c.useMemo)(()=>J.reduce((a,b)=>a+b.amount,0),[J]),U=(0,c.useMemo)(()=>J.filter(a=>"OFFICE_FUND"===a.sourceType).reduce((a,b)=>a+b.amount,0),[J]),V=(0,c.useMemo)(()=>J.filter(a=>"PM_ADVANCE"===a.sourceType).reduce((a,b)=>a+b.amount,0),[J]),W=(0,c.useMemo)(()=>{let a=new Map;return H.forEach(b=>{let c=b.staff?.id??b.id,d=b.staff?.name??"بدون اسم";a.has(c)||a.set(c,{staffId:c,staffName:d,totalAmount:0,totalRemaining:0,advances:[]});let e=a.get(c);e.totalAmount+=b.amount,e.totalRemaining+=b.remainingAmount,e.advances.push(b)}),Array.from(a.values()).map(a=>{let b=[...a.advances].sort((a,b)=>{let c=b.remainingAmount-a.remainingAmount;if(0!==c)return c;let d=a.givenAt?new Date(a.givenAt).getTime():0;return(b.givenAt?new Date(b.givenAt).getTime():0)-d}),c=b.find(a=>a.remainingAmount>0)??null;return{...a,advances:b,primaryAdvanceId:c?c.id:null}}).filter(a=>a.advances.length>0).map(({primaryAdvanceId:a,...b})=>b).sort((a,b)=>a.staffName.localeCompare(b.staffName,"ar",{sensitivity:"base"}))},[H]),X=(0,c.useCallback)((a,b)=>{let c=W.find(b=>b.staffId===a);if(!c)return"";let d=Number(b),e=c.advances;if(0===e.length)return"";if(!Number.isFinite(d)||d<=0){let a=e.find(a=>a.remainingAmount>0);return a?a.id:e[0].id}let f=e.find(a=>a.remainingAmount>=d);if(f)return f.id;let g=e.find(a=>a.remainingAmount>0);return g?g.id:e[0].id},[W]),Y=(0,c.useMemo)(()=>W.find(a=>a.staffId===P)??null,[W,P]),Z=(0,c.useMemo)(()=>Y&&N.pmAdvanceId?Y.advances.find(a=>a.id===N.pmAdvanceId)??null:null,[Y,N.pmAdvanceId]),$=(0,c.useMemo)(()=>{if(!Z)return null;let a=Number(N.amount);return Number.isFinite(a)?Z.remainingAmount-a:Z.remainingAmount},[Z,N.amount]);(0,c.useEffect)(()=>{v||(Q(""),O(a=>a.pmAdvanceId?{...a,pmAdvanceId:""}:a))},[v]),(0,c.useEffect)(()=>{if("PM_ADVANCE"!==B){P&&Q(""),N.pmAdvanceId&&O(a=>a.pmAdvanceId?{...a,pmAdvanceId:""}:a);return}if(!P){N.pmAdvanceId&&O(a=>a.pmAdvanceId?{...a,pmAdvanceId:""}:a);return}let a=X(P,parseFloat(N.amount));a&&a!==N.pmAdvanceId&&O(b=>({...b,pmAdvanceId:a}))},[B,P,N.amount,N.pmAdvanceId,X,Y]);let _=(0,c.useMemo)(()=>{let a=new Map;return H.forEach(b=>{let c=b.staff?.id??b.id,d=b.staff?.name??"بدون اسم";a.has(c)||a.set(c,{staffId:c,staffName:d,totalAmount:0,totalRemaining:0,advances:[],operationalExpenses:[],unitExpenses:[]});let e=a.get(c);e.totalAmount+=b.amount,e.totalRemaining+=b.remainingAmount,e.advances.push(b),b.operationalExpenses&&e.operationalExpenses.push(...b.operationalExpenses),b.expenses&&e.unitExpenses.push(...b.expenses)}),Array.from(a.values()).map(a=>({...a,advances:[...a.advances].sort((a,b)=>{let c=a.givenAt?new Date(a.givenAt).getTime():0;return(b.givenAt?new Date(b.givenAt).getTime():0)-c}),operationalExpenses:[...a.operationalExpenses].sort((a,b)=>{let c=a.recordedAt?new Date(a.recordedAt).getTime():0;return(b.recordedAt?new Date(b.recordedAt).getTime():0)-c}),unitExpenses:[...a.unitExpenses].sort((a,b)=>{let c=a.date?new Date(a.date).getTime():0;return(b.date?new Date(b.date).getTime():0)-c})}))},[H]);(0,c.useEffect)(()=>{(async()=>{try{A(!0);let[a,b,c,d,e]=await Promise.all([fetch("/api/projects"),fetch("/api/operational-units"),fetch("/api/pm-advances"),fetch("/api/accounting-notes"),fetch("/api/operational-expenses")]);if(a.ok){let b=await a.json();E(Array.isArray(b)?b:[])}if(b.ok){let a=await b.json();G(Array.isArray(a)?a:[])}if(c.ok){let a=await c.json();I(Array.isArray(a)?a:[])}if(d.ok){let a=await d.json();M(Array.isArray(a)?a:[])}if(e.ok){let a=await e.json();K(Array.isArray(a)?a:[])}}catch(a){console.error("Error fetching data:",a),u({title:"Error",description:"Failed to load data. Please refresh the page.",variant:"destructive"})}finally{A(!1)}})()},[u]);let aa=async a=>{if(a.preventDefault(),!N.projectId||!N.unitId||!N.description||!N.amount)return void u({title:"Validation Error",description:"Please fill in all required fields.",variant:"destructive"});if(!F.find(a=>a.id===N.unitId))return void u({title:"Error",description:"Invalid unit selection. Please select a valid unit.",variant:"destructive"});if("PM_ADVANCE"===B&&!N.pmAdvanceId)return void u({title:"Validation Error",description:"Please select an advance when using PM_ADVANCE source.",variant:"destructive"});try{y(!0);let a={unitId:N.unitId,description:N.description,amount:parseFloat(N.amount),sourceType:B,..."PM_ADVANCE"===B&&{pmAdvanceId:N.pmAdvanceId}},b=await fetch("/api/operational-expenses",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)});if(!b.ok){let a=await b.json();throw Error(a.error||"Failed to create expense")}let c=await b.json();if(c?.accountingNote)M(a=>[c.accountingNote,...a]);else{let a=await fetch("/api/accounting-notes");if(a.ok){let b=await a.json();M(Array.isArray(b)?b:[])}}let d=await fetch("/api/operational-expenses");if(d.ok){let a=await d.json();K(Array.isArray(a)?a:[])}if("PM_ADVANCE"===B){let a=await fetch("/api/pm-advances");if(a.ok){let b=await a.json();I(Array.isArray(b)?b:[])}}w(!1),O({projectId:"",unitId:"",description:"",amount:"",pmAdvanceId:""}),C("OFFICE_FUND"),u({title:"تم تسجيل النفقة",description:"تم إرسال النفقة للمراجعة المحاسبية"})}catch(a){u({title:"Error",description:a instanceof Error?a.message:"Failed to create expense",variant:"destructive"})}finally{y(!1)}};if(z)return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"نفقات تشغيلية"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-2",children:"إدارة نفقات الوحدات من صندوق المكتب أو العهد"})]}),(0,b.jsx)("div",{className:"grid gap-4 md:grid-cols-3",children:[1,2,3].map(a=>(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{className:"pb-2",children:(0,b.jsx)(j.Skeleton,{className:"h-4 w-20"})}),(0,b.jsx)(i.CardContent,{children:(0,b.jsx)(j.Skeleton,{className:"h-8 w-32"})})]},a))})]});let ab=async a=>{if(a&&!v)try{let[a,b,c]=await Promise.all([fetch("/api/operational-expenses"),fetch("/api/pm-advances"),fetch("/api/accounting-notes")]);if(a.ok){let b=await a.json();K(Array.isArray(b)?b:[])}if(b.ok){let a=await b.json();I(Array.isArray(a)?a:[])}if(c.ok){let a=await c.json();M(Array.isArray(a)?a:[])}}catch(a){console.error("Error refreshing data:",a)}w(a)};return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold tracking-tight",children:"نفقات تشغيلية"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-2",children:"إدارة نفقات الوحدات من صندوق المكتب أو العهد"})]}),(0,b.jsxs)(l.Dialog,{open:v,onOpenChange:ab,children:[(0,b.jsx)(l.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(f.Button,{children:[(0,b.jsx)(o.Plus,{className:"h-4 w-4 ml-2"}),"نفقة جديدة"]})}),(0,b.jsxs)(l.DialogContent,{dir:"rtl",children:[(0,b.jsxs)(l.DialogHeader,{children:[(0,b.jsx)(l.DialogTitle,{children:"نفقة تشغيلية جديدة"}),(0,b.jsx)(l.DialogDescription,{children:"أضف نفقة تشغيلية جديدة من صندوق المكتب أو من عهدة مدير المشروع"})]}),(0,b.jsxs)("form",{onSubmit:aa,className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"project",children:"المشروع *"}),(0,b.jsxs)(k.Select,{value:N.projectId,onValueChange:a=>{O({...N,projectId:a,unitId:""})},children:[(0,b.jsx)(k.SelectTrigger,{id:"project",children:(0,b.jsx)(k.SelectValue,{placeholder:"اختر المشروع"})}),(0,b.jsx)(k.SelectContent,{children:D.map(a=>(0,b.jsx)(k.SelectItem,{value:a.id,children:a.name},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"unit",children:"الوحدة *"}),(0,b.jsxs)(k.Select,{value:N.unitId,onValueChange:a=>O({...N,unitId:a}),disabled:!N.projectId,children:[(0,b.jsx)(k.SelectTrigger,{id:"unit",children:(0,b.jsx)(k.SelectValue,{placeholder:"اختر الوحدة"})}),(0,b.jsx)(k.SelectContent,{children:N.projectId&&F.filter(a=>a.projectId===N.projectId).map(a=>(0,b.jsxs)(k.SelectItem,{value:a.id,children:[a.name," (",a.code,")"]},a.id))})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"description",children:"الوصف *"}),(0,b.jsx)(g.Input,{id:"description",placeholder:"مثال: شراء أدوات، دفع فاتورة، إلخ",value:N.description,onChange:a=>O({...N,description:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"amount",children:"المبلغ *"}),(0,b.jsx)(g.Input,{id:"amount",type:"number",placeholder:"0.00",step:"0.01",value:N.amount,onChange:a=>O({...N,amount:a.target.value})})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"sourceType",children:"مصدر النفقة *"}),(0,b.jsxs)(k.Select,{value:B,onValueChange:a=>C(a),children:[(0,b.jsx)(k.SelectTrigger,{id:"sourceType",children:(0,b.jsx)(k.SelectValue,{})}),(0,b.jsxs)(k.SelectContent,{children:[(0,b.jsx)(k.SelectItem,{value:"OFFICE_FUND",children:"من صندوق المكتب"}),(0,b.jsx)(k.SelectItem,{value:"PM_ADVANCE",children:"من عهدة مدير المشروع"})]})]})]}),"PM_ADVANCE"===B&&(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(h.Label,{htmlFor:"pmAdvance",children:"عهدة مدير المشروع *"}),(0,b.jsxs)(k.Select,{value:P,onValueChange:a=>{Q(a);let b=X(a,parseFloat(N.amount));O(a=>a.pmAdvanceId===b?a:{...a,pmAdvanceId:b})},disabled:0===W.length,children:[(0,b.jsx)(k.SelectTrigger,{id:"pmAdvance",children:(0,b.jsx)(k.SelectValue,{placeholder:0===W.length?"لا توجد عهد متاحة":"اختر مدير المشروع"})}),(0,b.jsx)(k.SelectContent,{children:0===W.length?(0,b.jsx)(k.SelectItem,{value:"__empty",disabled:!0,children:"لا توجد عهد متاحة"}):W.map(a=>(0,b.jsxs)(k.SelectItem,{value:a.staffId,children:[a.staffName," (متبقي إجمالي: ",a.totalRemaining.toFixed(2),")"]},a.staffId))})]}),Y&&(0,b.jsxs)("div",{className:"mt-2 space-y-1 rounded-lg bg-blue-50 p-3 text-sm",children:[(0,b.jsxs)("div",{children:["المتبقي الإجمالي: ",(0,b.jsxs)("span",{className:"font-bold",children:[Y.totalRemaining.toFixed(2)," ج.م"]})]}),Z?(0,b.jsxs)("div",{className:"space-y-1 text-xs text-muted-foreground",children:[(0,b.jsxs)("div",{children:["سيتم خصم النفقة من عهدة برصيد ",Z.remainingAmount.toFixed(2)," ج.م",Z.project?.name?` • ${Z.project.name}`:""]}),null!==$&&(0,b.jsxs)("div",{className:$<0?"text-red-600":"text-muted-foreground",children:["الرصيد بعد الخصم: ",$.toFixed(2)," ج.م"]})]}):(0,b.jsx)("div",{className:"text-xs text-muted-foreground",children:"أدخل مبلغًا لاختيار العهدة المناسبة تلقائيًا."})]})]}),(0,b.jsxs)(l.DialogFooter,{children:[(0,b.jsx)(f.Button,{type:"button",variant:"outline",onClick:()=>w(!1),children:"إلغاء"}),(0,b.jsxs)(f.Button,{type:"submit",disabled:x,children:[x&&(0,b.jsx)(p.Loader2,{className:"h-4 w-4 animate-spin ml-2"}),"حفظ النفقة"]})]})]})]})]})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsxs)(i.CardHeader,{children:[(0,b.jsxs)(i.CardTitle,{className:"flex items-center gap-2 text-lg",children:[(0,b.jsx)(q,{className:"h-5 w-5"}),"عهد مديري المشاريع"]}),(0,b.jsx)(i.CardDescription,{children:"راقب العهد المتاحة وسجل الصرفيات المرتبطة بكل مدير"})]}),(0,b.jsx)(i.CardContent,{children:0===_.length?(0,b.jsxs)(s.Alert,{children:[(0,b.jsx)(n.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(s.AlertDescription,{children:"لا توجد عهد مسجلة حالياً"})]}):(0,b.jsx)(at,{type:"single",collapsible:!0,className:"w-full",children:_.map(a=>(0,b.jsxs)(au,{value:a.staffId,children:[(0,b.jsx)(av,{className:"justify-between",children:(0,b.jsxs)("div",{className:"flex flex-col items-start text-right",children:[(0,b.jsx)("span",{className:"font-semibold text-base",children:a.staffName}),(0,b.jsxs)("span",{className:"text-xs text-muted-foreground",children:["إجمالي العهد: ",a.totalAmount.toFixed(2)," • المتبقي: ",a.totalRemaining.toFixed(2)," جنيه"]})]})}),(0,b.jsx)(aw,{children:(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-2",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsxs)("h4",{className:"text-sm font-semibold flex items-center gap-2",children:[(0,b.jsx)(r.FileText,{className:"h-4 w-4"}),"سجل العهد المصروفة"]}),0===a.advances.length?(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"لا توجد صرفيات مسجلة على العهد"}):(0,b.jsx)("ul",{className:"space-y-2 text-sm",children:a.advances.map(a=>(0,b.jsxs)("li",{className:"flex items-center justify-between rounded-lg border bg-muted/40 px-3 py-2",children:[(0,b.jsx)("span",{className:"text-muted-foreground text-xs",children:a.givenAt?new Date(a.givenAt).toLocaleDateString("ar-EG",{year:"numeric",month:"short",day:"numeric"}):"—"}),(0,b.jsxs)("span",{className:"font-semibold",children:[a.amount.toFixed(2)," جنيه"]}),(0,b.jsxs)("span",{className:"text-xs text-green-700",children:["المتبقي ",a.remainingAmount.toFixed(2)]})]},a.id))})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)("h4",{className:"text-sm font-semibold",children:"صرفيات مسجلة على العهد"}),0===a.operationalExpenses.length&&0===a.unitExpenses.length?(0,b.jsx)("p",{className:"text-xs text-muted-foreground",children:"لم يتم تسجيل صرفيات من العهد بعد"}):(0,b.jsxs)("div",{className:"space-y-3",children:[a.operationalExpenses.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"نفقات تشغيلية"}),(0,b.jsxs)("ul",{className:"space-y-1 text-sm",children:[a.operationalExpenses.slice(0,5).map(a=>(0,b.jsxs)("li",{className:"flex justify-between",children:[(0,b.jsxs)("span",{className:"text-muted-foreground",children:[a.unit?.name??"وحدة غير محددة"," - ",a.description]}),(0,b.jsxs)("span",{className:"font-semibold",children:[a.amount.toFixed(2)," جنيه"]})]},a.id)),a.operationalExpenses.length>5&&(0,b.jsxs)("li",{className:"text-xs text-muted-foreground",children:["+",a.operationalExpenses.length-5," نفقات أخرى"]})]})]}),a.unitExpenses.length>0&&(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"text-xs text-muted-foreground mb-1",children:"نفقات وحدات"}),(0,b.jsxs)("ul",{className:"space-y-1 text-sm",children:[a.unitExpenses.slice(0,5).map(a=>(0,b.jsxs)("li",{className:"flex justify-between",children:[(0,b.jsxs)("span",{className:"text-muted-foreground",children:[a.unit?.name??"وحدة غير محددة"," - ",a.description]}),(0,b.jsxs)("span",{className:"font-semibold",children:[a.amount.toFixed(2)," جنيه"]})]},a.id)),a.unitExpenses.length>5&&(0,b.jsxs)("li",{className:"text-xs text-muted-foreground",children:["+",a.unitExpenses.length-5," نفقات إضافية"]})]})]})]})]})]})})]},a.staffId))})})]}),(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-4",children:[(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{className:"pb-2",children:(0,b.jsx)(i.CardTitle,{className:"text-sm font-medium",children:"نفقات قيد المراجعة"})}),(0,b.jsxs)(i.CardContent,{children:[(0,b.jsxs)("div",{className:"text-2xl font-bold",children:[S.toFixed(2)," جنيه"]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[R.length," طلب قيد الاعتماد"]})]})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{className:"pb-2",children:(0,b.jsx)(i.CardTitle,{className:"text-sm font-medium",children:"نفقات معتمدة"})}),(0,b.jsxs)(i.CardContent,{children:[(0,b.jsxs)("div",{className:"text-2xl font-bold",children:[T.toFixed(2)," جنيه"]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[J.length," نفقة تمت مراجعتها"]})]})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{className:"pb-2",children:(0,b.jsx)(i.CardTitle,{className:"text-sm font-medium",children:"من العهد"})}),(0,b.jsxs)(i.CardContent,{children:[(0,b.jsxs)("div",{className:"text-2xl font-bold",children:[V.toFixed(2)," جنيه"]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[J.filter(a=>"PM_ADVANCE"===a.sourceType).length," نفقة"]})]})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsx)(i.CardHeader,{className:"pb-2",children:(0,b.jsx)(i.CardTitle,{className:"text-sm font-medium",children:"من صندوق المكتب"})}),(0,b.jsxs)(i.CardContent,{children:[(0,b.jsxs)("div",{className:"text-2xl font-bold",children:[U.toFixed(2)," جنيه"]}),(0,b.jsxs)("p",{className:"text-xs text-muted-foreground mt-1",children:[J.filter(a=>"OFFICE_FUND"===a.sourceType).length," نفقة"]})]})]})]}),(0,b.jsxs)(i.Card,{children:[(0,b.jsxs)(i.CardHeader,{children:[(0,b.jsx)(i.CardTitle,{children:"سجل النفقات وملاحظات المراجعة"}),(0,b.jsx)(i.CardDescription,{children:"يتضمن الطلبات المرسلة والحالات المعتمدة أو المرفوضة"})]}),(0,b.jsx)(i.CardContent,{children:0===L.length?(0,b.jsxs)(s.Alert,{children:[(0,b.jsx)(n.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(s.AlertDescription,{children:"لا توجد ملاحظات محاسبية مسجلة حتى الآن"})]}):(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(m.Table,{children:[(0,b.jsx)(m.TableHeader,{children:(0,b.jsxs)(m.TableRow,{children:[(0,b.jsx)(m.TableHead,{children:"الوحدة"}),(0,b.jsx)(m.TableHead,{children:"الوصف"}),(0,b.jsx)(m.TableHead,{children:"المبلغ"}),(0,b.jsx)(m.TableHead,{children:"المصدر"}),(0,b.jsx)(m.TableHead,{children:"الحالة"}),(0,b.jsx)(m.TableHead,{children:"أنشئ بواسطة"}),(0,b.jsx)(m.TableHead,{children:"آخر تحديث"})]})}),(0,b.jsx)(m.TableBody,{children:L.map(a=>{let c={PENDING:{label:"قيد المراجعة",className:"bg-yellow-100 text-yellow-800"},CONVERTED:{label:"معتمدة",className:"bg-green-100 text-green-800"},REJECTED:{label:"مرفوضة",className:"bg-red-100 text-red-800"}}[a.status],d="OFFICE_FUND"===a.sourceType?"صندوق المكتب":`عهدة ${a.pmAdvance?.staff?.name??"غير محددة"}`,e="CONVERTED"===a.status&&(a.convertedAt||a.convertedToExpense?.recordedAt)||a.createdAt;return(0,b.jsxs)(m.TableRow,{children:[(0,b.jsxs)(m.TableCell,{className:"font-medium",children:[a.unit.name," (",a.unit.code,")"]}),(0,b.jsx)(m.TableCell,{children:a.description}),(0,b.jsxs)(m.TableCell,{className:"font-bold",children:[a.amount.toFixed(2)," جنيه"]}),(0,b.jsx)(m.TableCell,{children:(0,b.jsx)(t.Badge,{variant:"secondary",className:"text-xs font-medium",children:d})}),(0,b.jsx)(m.TableCell,{children:(0,b.jsx)("span",{className:`px-3 py-1 rounded-full text-xs font-semibold ${c.className}`,children:c.label})}),(0,b.jsx)(m.TableCell,{children:(0,b.jsxs)("div",{className:"flex flex-col text-xs",children:[(0,b.jsx)("span",{className:"font-semibold text-sm",children:a.createdByUser.name}),"CONVERTED"===a.status&&a.convertedToExpense?.recordedByUser&&(0,b.jsxs)("span",{className:"text-muted-foreground",children:["اعتمدت بواسطة: ",a.convertedToExpense.recordedByUser.name]})]})}),(0,b.jsx)(m.TableCell,{children:new Date(e).toLocaleDateString("ar-EG",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"})})]},a.id)})})]})})})]})]})}a.s(["default",()=>ax],20894)}];

//# sourceMappingURL=3d860_cmd-main_src_app_dashboard_accountant_operational-expenses_page_tsx_33e01bff._.js.map