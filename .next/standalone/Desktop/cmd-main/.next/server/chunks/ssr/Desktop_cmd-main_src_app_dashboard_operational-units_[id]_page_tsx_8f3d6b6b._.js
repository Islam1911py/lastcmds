module.exports=[57055,a=>{"use strict";var b=a.i(43713),c=a.i(68599),d=a.i(84642),e=a.i(17545),f=a.i(72760),g=a.i(79059),h=a.i(22488),i=a.i(90306);let j=(0,i.default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);var k=a.i(49015),l=a.i(49466),m=a.i(22654),n=a.i(15877),o=a.i(55658),p=a.i(66871),q=a.i(46382),r=a.i(27167),s=a.i(53749),t=a.i(50063);let u=(0,i.default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var v=a.i(57684),w=a.i(21706),x=a.i(66128),y=a.i(65189),z=a.i(63395),A=a.i(77726),B=a.i(59627),C=a.i(61977),D=a.i(48421);function E(){let a=(0,e.useParams)(),i=(0,e.useRouter)(),{data:E,status:F}=(0,d.useSession)(),G=a.id,[H,I]=(0,c.useState)(null),[J,K]=(0,c.useState)([]),[L,M]=(0,c.useState)([]),[N,O]=(0,c.useState)([]),[P,Q]=(0,c.useState)([]),[R,S]=(0,c.useState)([]),[T,U]=(0,c.useState)(null),[V,W]=(0,c.useState)(null),[X,Y]=(0,c.useState)([]),[Z,$]=(0,c.useState)(""),[_,aa]=(0,c.useState)(""),[ab,ac]=(0,c.useState)(""),[ad,ae]=(0,c.useState)(!1),[af,ag]=(0,c.useState)(!1),[ah,ai]=(0,c.useState)(!0),[aj,ak]=(0,c.useState)(null),[al,am]=(0,c.useState)("overview"),[an,ao]=(0,c.useState)(!1),[ap,aq]=(0,c.useState)(!1),[ar,as]=(0,c.useState)(0),[at,au]=(0,c.useState)(1),[av,aw]=(0,c.useState)(!1),[ax,ay]=(0,c.useState)(!1),[az,aA]=(0,c.useState)(""),[aB,aC]=(0,c.useState)(!1),[aD,aE]=(0,c.useState)(!1),[aF,aG]=(0,c.useState)({name:"",email:"",phone:"",address:""}),aH=E?.user?.role==="PROJECT_MANAGER",aI=E?.user?.role==="ACCOUNTANT",aJ=E?.user?.role==="ADMIN";(0,c.useEffect)(()=>{"loading"!==F&&E&&aK()},[E,F,G]),(0,c.useEffect)(()=>{let a=()=>{!document.hidden&&E&&aK()},b=()=>{E&&aK()};return document.addEventListener("visibilitychange",a),window.addEventListener("focus",b),()=>{document.removeEventListener("visibilitychange",a),window.removeEventListener("focus",b)}},[E,G]);let aK=async()=>{try{ai(!0),ak(null),ae(!0);let a=await fetch(`/api/summary/unit/${G}`);if(!a.ok)throw Error("Failed to fetch unit");let b=await a.json();U(b),b.unit&&(I(b.unit),as(b.unit.monthlyManagementFee||0),au(b.unit.monthlyBillingDay||1),aA(b.unit.name||""));let[c,d,e,f,g,h]=await Promise.all([fetch(`/api/operational-units/${G}/residents`),fetch(`/api/tickets?unitId=${G}`),fetch(`/api/technician-work?unitId=${G}`),fetch(`/api/unit-expenses?unitId=${G}`),fetch(`/api/invoices?unitId=${G}`),fetch(`/api/operational-units/${G}/owner`)]);if(c.ok&&K(await c.json()),d.ok&&M(await d.json()),e.ok&&O(await e.json()),f.ok&&Q(await f.json()),g.ok&&S(await g.json()),h.ok){let a=await h.json();a?(W(a),$(a.name||""),aa(a.email||""),ac(a.phone||""),Y((a.contacts||[]).map(a=>({id:a.id,type:a.type,label:a.label||"",value:a.value||"",isPrimary:a.isPrimary,markedForDeletion:!1,isNew:!1})))):(W(null),$(""),aa(""),ac(""),Y([]))}}catch(a){console.error("Error:",a),ak("Failed to load unit details")}finally{ai(!1),ae(!1)}},aL=async()=>{if(H){aq(!0);try{let a=await fetch(`/api/operational-units/${H.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({monthlyManagementFee:ar,monthlyBillingDay:at})});a.ok?(await a.json(),I({...H,monthlyManagementFee:ar,monthlyBillingDay:at}),ao(!1),alert("تم تحديث بيانات الفوترة الشهرية بنجاح")):alert("فشل تحديث بيانات الفوترة")}catch(a){console.error("Error:",a),alert("حدث خطأ أثناء التحديث")}finally{aq(!1)}}},aM=async()=>{if(H){if(!az.trim())return void alert("الرجاء إدخال اسم الوحدة");ay(!0);try{(await fetch(`/api/operational-units/${H.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:az.trim()})})).ok?(I({...H,name:az.trim()}),T?.unit&&U({...T,unit:{...T.unit,name:az.trim()}}),aw(!1),alert("تم تحديث اسم الوحدة بنجاح")):alert("فشل تحديث اسم الوحدة")}catch(a){console.error("Error:",a),alert("حدث خطأ أثناء التحديث")}finally{ay(!1)}}},aN=async()=>{if(!aF.name.trim())return void alert("الرجاء إدخال اسم الساكن");aE(!0);try{let a=await fetch("/api/residents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...aF,unitId:G})});if(a.ok){let b=await a.json();K([...J,b]),aG({name:"",email:"",phone:"",address:""}),aC(!1),alert("تم إضافة الساكن بنجاح"),aK()}else{let b=await a.json();alert(b.error||"فشل إضافة الساكن")}}catch(a){console.error("Error:",a),alert("حدث خطأ أثناء إضافة الساكن")}finally{aE(!1)}},aO=a=>{Y(b=>{let c=!b.some(b=>b.type===a&&!b.markedForDeletion&&b.isPrimary);return[...b,{id:void 0,type:a,label:"",value:"",isPrimary:c,markedForDeletion:!1,isNew:!0}]})},aP=(a,b,c)=>{Y(d=>{let e=[...d],f=e[a];if(!f||f.markedForDeletion)return d;if("type"===b&&("PHONE"===c||"EMAIL"===c)){let b=f.isPrimary;f.type=c,b&&e.some((b,d)=>d!==a&&b.type===c&&!b.markedForDeletion&&b.isPrimary)&&(f.isPrimary=!1)}else"label"===b?f.label=c:"value"===b&&(f.value=c);return e[a]={...f},e})},aQ=async()=>{if(!Z.trim())return void alert("الرجاء إدخال اسم جهة المالك");ag(!0);try{let a=X.filter(a=>a.markedForDeletion||a.value.trim()).map(a=>({id:a.id,type:a.type,value:a.value.trim(),label:a.label?.trim()||null,isPrimary:a.isPrimary,_delete:!!a.markedForDeletion})),b=await fetch(`/api/operational-units/${G}/owner`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:Z.trim(),email:_.trim()?_.trim():null,phone:ab.trim()?ab.trim():null,contacts:a})});if(!b.ok){let a=await b.json().catch(()=>null);alert(a?.error||"فشل حفظ بيانات جهة المالك");return}let c=await b.json();W(c),$(c?.name||""),aa(c?.email||""),ac(c?.phone||""),Y((c?.contacts||[]).map(a=>({id:a.id,type:a.type,label:a.label||"",value:a.value||"",isPrimary:a.isPrimary,markedForDeletion:!1,isNew:!1}))),alert("تم حفظ بيانات جهة المالك")}catch(a){console.error("Error saving owner association:",a),alert("حدث خطأ أثناء حفظ بيانات جهة المالك")}finally{ag(!1)}},aR=async()=>{if(V&&window.confirm("هل أنت متأكد من حذف جهة المالك لهذا الوحدة؟")){ag(!0);try{let a=await fetch(`/api/operational-units/${G}/owner`,{method:"DELETE"});if(!a.ok){let b=await a.json().catch(()=>null);alert(b?.error||"فشل حذف جهة المالك");return}W(null),$(""),aa(""),ac(""),Y([]),alert("تم حذف جهة المالك بنجاح")}catch(a){console.error("Error deleting owner association:",a),alert("حدث خطأ أثناء حذف جهة المالك")}finally{ag(!1)}}};return ah?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)(g.Loader,{className:"h-8 w-8 animate-spin"})}):aj||!H?(0,b.jsx)("div",{className:"space-y-6",children:(0,b.jsxs)(x.Alert,{variant:"destructive",children:[(0,b.jsx)(f.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(x.AlertDescription,{children:aj||"Unit not found"})]})}):(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-4xl font-bold",children:H.name}),(0,b.jsxs)("div",{className:"flex items-center gap-3 mt-2 text-muted-foreground",children:[(0,b.jsx)(n.MapPin,{className:"h-4 w-4"}),(0,b.jsx)("span",{children:H.project.name}),(0,b.jsx)("span",{children:"•"}),(0,b.jsx)("span",{className:"text-sm",children:H.code})]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[aJ&&(0,b.jsxs)(z.Button,{variant:"outline",onClick:()=>aw(!0),className:"gap-2",children:[(0,b.jsx)(j,{className:"h-4 w-4"}),"تعديل اسم الوحدة"]}),(0,b.jsx)(y.Badge,{variant:H.isActive?"default":"secondary",children:H.isActive?"Active":"Inactive"})]})]}),(aJ||aI)&&(0,b.jsxs)(v.Card,{className:"bg-gradient-to-br from-blue-500/10 to-purple-500/10 border-blue-500/20",children:[(0,b.jsx)(v.CardHeader,{children:(0,b.jsxs)(v.CardTitle,{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 text-blue-400",children:[(0,b.jsx)(o.Calendar,{className:"h-5 w-5"}),"الفوترة الشهرية"]}),(0,b.jsxs)(z.Button,{size:"sm",onClick:()=>ao(!0),className:"bg-blue-600 hover:bg-blue-700",children:[(0,b.jsx)(j,{className:"h-4 w-4 mr-2"}),"تعديل"]})]})}),(0,b.jsxs)(v.CardContent,{children:[(0,b.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(C.Label,{className:"text-sm text-zinc-400 mb-2 block",children:"المطالبة الشهرية"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(k.DollarSign,{className:"h-5 w-5 text-emerald-400"}),(0,b.jsxs)("span",{className:"text-2xl font-bold text-emerald-400",children:[(H.monthlyManagementFee||0).toLocaleString("ar-EG")," EGP"]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(C.Label,{className:"text-sm text-zinc-400 mb-2 block",children:"يوم التحصيل الشهري"}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(o.Calendar,{className:"h-5 w-5 text-blue-400"}),(0,b.jsxs)("span",{className:"text-2xl font-bold text-blue-400",children:["اليوم ",H.monthlyBillingDay||1]})]})]})]}),(!H.monthlyManagementFee||0===H.monthlyManagementFee)&&(0,b.jsxs)(x.Alert,{className:"mt-4 bg-yellow-500/10 border-yellow-500/20",children:[(0,b.jsx)(f.AlertCircle,{className:"h-4 w-4 text-yellow-500"}),(0,b.jsx)(x.AlertDescription,{className:"text-yellow-500",children:"لم يتم تحديد رسوم شهرية لهذه الوحدة. لن يتم إنشاء فواتير تلقائية."})]})]})]}),T&&(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,b.jsxs)(v.Card,{children:[(0,b.jsx)(v.CardHeader,{className:"pb-2",children:(0,b.jsxs)(v.CardTitle,{className:"text-sm text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(l.Users,{className:"h-4 w-4"}),"السكان"]})}),(0,b.jsx)(v.CardContent,{children:(0,b.jsx)("div",{className:"text-3xl font-bold",children:T.residents.total})})]}),(0,b.jsxs)(v.Card,{children:[(0,b.jsx)(v.CardHeader,{className:"pb-2",children:(0,b.jsxs)(v.CardTitle,{className:"text-sm text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(f.AlertCircle,{className:"h-4 w-4"}),"التذاكر المفتوحة"]})}),(0,b.jsx)(v.CardContent,{children:(0,b.jsx)("div",{className:"text-3xl font-bold text-red-600",children:T.tickets.new+T.tickets.inProgress})})]}),(0,b.jsxs)(v.Card,{className:"cursor-pointer hover:bg-muted/30 transition-colors",onClick:()=>am("expenses"),onKeyDown:a=>{("Enter"===a.key||" "===a.key)&&(a.preventDefault(),am("expenses"))},tabIndex:0,role:"button","aria-label":"عرض المصروفات المعلقة",children:[(0,b.jsx)(v.CardHeader,{className:"pb-2",children:(0,b.jsxs)(v.CardTitle,{className:"text-sm text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(m.FileText,{className:"h-4 w-4"}),"المصروفات المعلقة"]})}),(0,b.jsx)(v.CardContent,{children:(0,b.jsx)("div",{className:"text-3xl font-bold text-yellow-600",children:T.expenseNotes.pending})})]}),(0,b.jsxs)(v.Card,{children:[(0,b.jsx)(v.CardHeader,{className:"pb-2",children:(0,b.jsxs)(v.CardTitle,{className:"text-sm text-muted-foreground flex items-center gap-2",children:[(0,b.jsx)(k.DollarSign,{className:"h-4 w-4"}),"إجمالي المصروفات"]})}),(0,b.jsx)(v.CardContent,{children:(0,b.jsxs)("div",{className:"text-3xl font-bold",children:["$",T.expenseNotes.totalAmount.toFixed(2)]})})]})]}),(0,b.jsxs)(w.Tabs,{value:al,onValueChange:am,className:"w-full",children:[(0,b.jsxs)(w.TabsList,{className:"grid w-full grid-cols-8",children:[(0,b.jsx)(w.TabsTrigger,{value:"overview",children:"نظرة عامة"}),(0,b.jsx)(w.TabsTrigger,{value:"residents",children:"السكان"}),(0,b.jsx)(w.TabsTrigger,{value:"tickets",children:"التذاكر"}),(0,b.jsx)(w.TabsTrigger,{value:"technician",children:"أعمال الفنيين"}),(0,b.jsx)(w.TabsTrigger,{value:"expenses",children:"المصروفات"}),(aI||aJ)&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(w.TabsTrigger,{value:"owner",children:"جهة المالك"}),(0,b.jsx)(w.TabsTrigger,{value:"invoices",children:"الفواتير"}),(0,b.jsx)(w.TabsTrigger,{value:"payments",children:"المدفوعات"})]})]}),(0,b.jsx)(w.TabsContent,{value:"overview",className:"space-y-4",children:T&&(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,b.jsxs)(v.Card,{children:[(0,b.jsx)(v.CardHeader,{children:(0,b.jsx)(v.CardTitle,{children:"ملخص العمليات"})}),(0,b.jsxs)(v.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center pb-2 border-b",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"إجمالي السكان"}),(0,b.jsx)("span",{className:"text-2xl font-bold",children:T.residents.total})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center pb-2 border-b",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"التذاكر"}),(0,b.jsx)("span",{className:"text-2xl font-bold",children:T.tickets.total})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center pb-2 border-b",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"سجلات أعمال الفنيين"}),(0,b.jsx)("span",{className:"text-2xl font-bold",children:T.technicianWork.total})]})]})]}),(0,b.jsxs)(v.Card,{children:[(0,b.jsx)(v.CardHeader,{children:(0,b.jsx)(v.CardTitle,{children:"الملخص المالي"})}),(0,b.jsxs)(v.CardContent,{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center pb-2 border-b",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"إجمالي المصروفات"}),(0,b.jsxs)("span",{className:"text-2xl font-bold text-yellow-600",children:["$",T.expenseNotes.totalAmount.toFixed(2)]})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center pb-2 border-b",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"الفواتير"}),(0,b.jsx)("span",{className:"text-2xl font-bold",children:T.invoices.total})]}),(0,b.jsxs)("div",{className:"flex justify-between items-center pb-2 border-b",children:[(0,b.jsx)("span",{className:"text-muted-foreground",children:"المصروفات المعلقة"}),(0,b.jsx)("span",{className:"text-2xl font-bold text-red-600",children:T.expenseNotes.pending})]})]})]})]})}),(0,b.jsxs)(w.TabsContent,{value:"residents",className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"السكان"}),aH&&(0,b.jsxs)(z.Button,{onClick:()=>aC(!0),className:"gap-2 bg-emerald-600 hover:bg-emerald-700",size:"sm",children:[(0,b.jsx)(h.Plus,{className:"h-4 w-4"}),"إضافة ساكن"]})]}),(0,b.jsx)(v.Card,{children:(0,b.jsx)(v.CardContent,{className:"pt-6",children:0===J.length?(0,b.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"لا يوجد سكان في هذه الوحدة"}):(0,b.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,b.jsxs)(A.Table,{children:[(0,b.jsx)(A.TableHeader,{children:(0,b.jsxs)(A.TableRow,{children:[(0,b.jsx)(A.TableHead,{children:"الاسم"}),(0,b.jsx)(A.TableHead,{children:"البريد الإلكتروني"}),(0,b.jsx)(A.TableHead,{children:"رقم الهاتف"}),(0,b.jsx)(A.TableHead,{children:"العنوان"}),aH&&(0,b.jsx)(A.TableHead,{children:"الإجراءات"})]})}),(0,b.jsx)(A.TableBody,{children:J.map(a=>(0,b.jsxs)(A.TableRow,{children:[(0,b.jsx)(A.TableCell,{className:"font-medium",children:a.name}),(0,b.jsx)(A.TableCell,{children:a.email||"-"}),(0,b.jsx)(A.TableCell,{children:a.phone||"-"}),(0,b.jsx)(A.TableCell,{className:"max-w-[200px] truncate",children:a.address||"-"}),aH&&(0,b.jsx)(A.TableCell,{children:(0,b.jsx)(z.Button,{variant:"ghost",size:"sm",onClick:()=>i.push(`/dashboard/residents/${a.id}/edit`),children:(0,b.jsx)(j,{className:"h-4 w-4"})})})]},a.id))})]})})})})]}),(0,b.jsxs)(w.TabsContent,{value:"tickets",className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"التذاكر"}),aH&&(0,b.jsxs)(z.Button,{onClick:()=>i.push(`/dashboard/tickets/new?unitId=${G}`),className:"gap-2",size:"sm",children:[(0,b.jsx)(h.Plus,{className:"h-4 w-4"}),"إضافة تذكرة"]})]}),(0,b.jsx)(v.Card,{children:(0,b.jsx)(v.CardContent,{className:"pt-6",children:0===L.length?(0,b.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد تذاكر في هذه الوحدة"}):(0,b.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,b.jsxs)(A.Table,{children:[(0,b.jsx)(A.TableHeader,{children:(0,b.jsxs)(A.TableRow,{children:[(0,b.jsx)(A.TableHead,{children:"العنوان"}),(0,b.jsx)(A.TableHead,{children:"الساكن"}),(0,b.jsx)(A.TableHead,{children:"الحالة"}),(0,b.jsx)(A.TableHead,{children:"الأولوية"}),(0,b.jsx)(A.TableHead,{children:"مُسند إلى"}),(0,b.jsx)(A.TableHead,{children:"تاريخ الإنشاء"}),aH&&(0,b.jsx)(A.TableHead,{children:"الإجراءات"})]})}),(0,b.jsx)(A.TableBody,{children:L.map(a=>(0,b.jsxs)(A.TableRow,{children:[(0,b.jsx)(A.TableCell,{className:"font-medium",children:a.title}),(0,b.jsx)(A.TableCell,{children:a.resident.name}),(0,b.jsx)(A.TableCell,{children:(0,b.jsx)(y.Badge,{variant:"done"===a.status?"default":"secondary",children:a.status})}),(0,b.jsx)(A.TableCell,{children:(0,b.jsx)(y.Badge,{variant:"high"===a.priority?"destructive":"outline",children:a.priority})}),(0,b.jsx)(A.TableCell,{children:a.assignedTo?.name||"-"}),(0,b.jsx)(A.TableCell,{children:new Date(a.createdAt).toLocaleDateString()}),aH&&(0,b.jsx)(A.TableCell,{children:(0,b.jsx)(z.Button,{variant:"ghost",size:"sm",onClick:()=>i.push(`/dashboard/tickets/${a.id}/edit`),children:(0,b.jsx)(j,{className:"h-4 w-4"})})})]},a.id))})]})})})})]}),(0,b.jsxs)(w.TabsContent,{value:"technician",className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"أعمال الفنيين"}),aH&&(0,b.jsxs)(z.Button,{onClick:()=>i.push(`/dashboard/technician-work?unitId=${G}`),className:"gap-2",size:"sm",children:[(0,b.jsx)(h.Plus,{className:"h-4 w-4"}),"تسجيل عمل"]})]}),N.length>0&&(0,b.jsxs)(v.Card,{children:[(0,b.jsx)(v.CardHeader,{children:(0,b.jsx)(v.CardTitle,{className:"text-base",children:"ملخص الفنيين"})}),(0,b.jsx)(v.CardContent,{children:(0,b.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,b.jsxs)(A.Table,{children:[(0,b.jsx)(A.TableHeader,{children:(0,b.jsxs)(A.TableRow,{className:"bg-muted/50",children:[(0,b.jsx)(A.TableHead,{children:"الفني"}),(0,b.jsx)(A.TableHead,{className:"text-right",children:"إجمالي المستحقات"}),(0,b.jsx)(A.TableHead,{className:"text-right",children:"المدفوع"}),(0,b.jsx)(A.TableHead,{className:"text-right",children:"المعلق"}),(0,b.jsx)(A.TableHead,{className:"text-right",children:"الإجراء"})]})}),(0,b.jsx)(A.TableBody,{children:Array.from(new Map(N.map(a=>[a.technician.name,N.filter(b=>b.technician.name===a.technician.name)])).entries()).map(([a,c])=>{let d=c.reduce((a,b)=>a+b.amount,0),e=c.filter(a=>"paid"===a.paymentStatus).reduce((a,b)=>a+b.amount,0),f=d-e;return(0,b.jsxs)(A.TableRow,{children:[(0,b.jsx)(A.TableCell,{className:"font-medium",children:a}),(0,b.jsxs)(A.TableCell,{className:"text-right font-semibold",children:["$",d.toFixed(2)]}),(0,b.jsxs)(A.TableCell,{className:"text-right text-green-600",children:["$",e.toFixed(2)]}),(0,b.jsxs)(A.TableCell,{className:`text-right font-semibold ${f>0?"text-red-600":"text-green-600"}`,children:["$",f.toFixed(2)]}),(0,b.jsx)(A.TableCell,{className:"text-right",children:f>0&&(0,b.jsxs)(z.Button,{onClick:()=>i.push(`/dashboard/payments?unit=${G}&amount=${f.toFixed(2)}`),size:"sm",className:"text-xs",variant:"outline",children:["دفع $",f.toFixed(2)]})})]},a)})})]})})})]}),(0,b.jsxs)(v.Card,{children:[(0,b.jsx)(v.CardHeader,{children:(0,b.jsxs)(v.CardTitle,{className:"text-base",children:["سجلات الأعمال (",N.length,")"]})}),(0,b.jsx)(v.CardContent,{children:0===N.length?(0,b.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد أعمال فنيين مسجلة"}):(0,b.jsx)("div",{className:"space-y-3",children:N.map(a=>(0,b.jsx)("div",{className:"border p-4 rounded-lg hover:bg-muted/50 transition-colors",children:(0,b.jsxs)("div",{className:"flex justify-between items-start",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-medium",children:a.description}),(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:a.technician.name}),(0,b.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(a.createdAt).toLocaleDateString()})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsxs)("p",{className:"text-lg font-bold",children:["$",a.amount.toFixed(2)]}),(0,b.jsx)(y.Badge,{variant:"paid"===a.paymentStatus?"default":"secondary",children:a.paymentStatus})]})]})},a.id))})})]})]}),(0,b.jsxs)(w.TabsContent,{value:"expenses",className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"المصروفات"}),aH&&(0,b.jsxs)(z.Button,{onClick:()=>i.push(`/dashboard/accounting-notes/new?unitId=${G}&type=expense`),className:"gap-2",size:"sm",children:[(0,b.jsx)(h.Plus,{className:"h-4 w-4"}),"إضافة مصروف"]})]}),(0,b.jsx)(v.Card,{children:(0,b.jsx)(v.CardContent,{className:"pt-6",children:0===P.length?(0,b.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد مصروفات مسجلة"}):(0,b.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,b.jsxs)(A.Table,{children:[(0,b.jsx)(A.TableHeader,{children:(0,b.jsxs)(A.TableRow,{children:[(0,b.jsx)(A.TableHead,{children:"الوصف"}),(0,b.jsx)(A.TableHead,{children:"المبلغ"}),(0,b.jsx)(A.TableHead,{children:"الحالة"}),(0,b.jsx)(A.TableHead,{children:"التاريخ"})]})}),(0,b.jsx)(A.TableBody,{children:P.map(a=>(0,b.jsxs)(A.TableRow,{children:[(0,b.jsx)(A.TableCell,{className:"font-medium",children:a.description}),(0,b.jsxs)(A.TableCell,{children:["$",a.amount.toFixed(2)]}),(0,b.jsx)(A.TableCell,{children:(0,b.jsx)(y.Badge,{variant:a.isClaimed?"default":"secondary",children:a.isClaimed?"مطالب بها":"غير مطالب بها"})}),(0,b.jsx)(A.TableCell,{children:new Date(a.date).toLocaleDateString()})]},a.id))})]})})})})]}),(aI||aJ)&&(0,b.jsxs)(w.TabsContent,{value:"owner",className:"space-y-4",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,b.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,b.jsx)(q.Building2,{className:"h-5 w-5 text-muted-foreground"}),"بيانات جهة المالك"]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[V&&aJ&&(0,b.jsxs)(z.Button,{variant:"destructive",size:"sm",onClick:aR,disabled:af||ad,className:"gap-2",children:[(0,b.jsx)(t.Trash2,{className:"h-4 w-4"}),"حذف الجهة"]}),(0,b.jsxs)(z.Button,{onClick:aQ,disabled:af||ad,className:"gap-2",size:"sm",children:[af?(0,b.jsx)(g.Loader,{className:"h-4 w-4 animate-spin"}):(0,b.jsx)(u,{className:"h-4 w-4"}),"حفظ البيانات"]})]})]}),!V&&!ad&&(0,b.jsxs)(x.Alert,{children:[(0,b.jsx)(f.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(x.AlertDescription,{children:"لم يتم تسجيل جهة المالك لهذه الوحدة بعد. يرجى إدخال البيانات وحفظها."})]}),(0,b.jsx)(v.Card,{children:(0,b.jsx)(v.CardContent,{className:"pt-6 space-y-6",children:ad&&!V&&0===X.length?(0,b.jsxs)("div",{className:"flex items-center justify-center py-8 text-muted-foreground",children:[(0,b.jsx)(g.Loader,{className:"h-5 w-5 animate-spin"}),(0,b.jsx)("span",{className:"ml-2",children:"جاري تحميل بيانات جهة المالك..."})]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(C.Label,{children:"اسم الجهة"}),(0,b.jsx)(B.Input,{value:Z,onChange:a=>$(a.target.value),placeholder:"مثال: اتحاد ملاك البرج",disabled:af||ad})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(C.Label,{children:"البريد الرئيسي"}),(0,b.jsx)(B.Input,{type:"email",value:_,onChange:a=>aa(a.target.value),placeholder:"owner@example.com",disabled:af||ad})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(C.Label,{children:"الهاتف الرئيسي"}),(0,b.jsx)(B.Input,{value:ab,onChange:a=>ac(a.target.value),placeholder:"01000000000",disabled:af||ad})]})]}),(0,b.jsxs)("div",{className:"space-y-3",children:[(0,b.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[(0,b.jsx)("h4",{className:"font-semibold",children:"وسائل التواصل الإضافية"}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,b.jsxs)(z.Button,{type:"button",size:"sm",variant:"outline",onClick:()=>aO("PHONE"),disabled:af||ad,className:"gap-2",children:[(0,b.jsx)(r.Phone,{className:"h-4 w-4"}),"إضافة رقم"]}),(0,b.jsxs)(z.Button,{type:"button",size:"sm",variant:"outline",onClick:()=>aO("EMAIL"),disabled:af||ad,className:"gap-2",children:[(0,b.jsx)(s.Mail,{className:"h-4 w-4"}),"إضافة بريد"]})]})]}),0===X.filter(a=>!a.markedForDeletion).length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground border rounded-lg p-4",children:"لا توجد وسائل تواصل إضافية. استخدم الأزرار أعلاه لإضافة أرقام أو بريد إلكتروني."}):(0,b.jsx)("div",{className:"space-y-3",children:X.map((a,c)=>a.markedForDeletion?null:(0,b.jsxs)("div",{className:"grid gap-3 md:grid-cols-[150px_1fr_1fr_auto] items-end border rounded-lg p-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(C.Label,{children:"النوع"}),(0,b.jsxs)("select",{className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:a.type,onChange:a=>aP(c,"type",a.target.value),disabled:af||ad,children:[(0,b.jsx)("option",{value:"PHONE",children:"رقم هاتف"}),(0,b.jsx)("option",{value:"EMAIL",children:"بريد إلكتروني"})]})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(C.Label,{children:"الوصف"}),(0,b.jsx)(B.Input,{value:a.label||"",onChange:a=>aP(c,"label",a.target.value),placeholder:"مثال: رئيس الاتحاد",disabled:af||ad})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(C.Label,{children:"القيمة"}),(0,b.jsx)(B.Input,{value:a.value,onChange:a=>aP(c,"value",a.target.value),placeholder:"PHONE"===a.type?"01000000000":"owner@example.com",disabled:af||ad})]}),(0,b.jsxs)("div",{className:"flex flex-col gap-2 md:items-end",children:[(0,b.jsx)(z.Button,{type:"button",size:"sm",variant:a.isPrimary?"secondary":"outline",onClick:()=>{Y(a=>{let b=a[c];return!b||b.markedForDeletion?a:a.map((a,d)=>a.markedForDeletion||a.type!==b.type?a:{...a,isPrimary:d===c})})},disabled:af||ad,className:"w-full md:w-auto",children:a.isPrimary?"الرئيسي":"تعيين كرئيسي"}),(0,b.jsxs)(z.Button,{type:"button",size:"sm",variant:"ghost",onClick:()=>{Y(a=>{let b=a[c];if(!b)return a;if(!b.id)return a.filter((a,b)=>b!==c);let d=[...a];return d[c]={...b,markedForDeletion:!0,isPrimary:!1},d})},disabled:af||ad,className:"gap-2 text-red-600 hover:text-red-600",children:[(0,b.jsx)(t.Trash2,{className:"h-4 w-4"}),"حذف"]})]})]},a.id??`new-contact-${c}`))})]})]})})})]}),(aI||aJ)&&(0,b.jsxs)(w.TabsContent,{value:"invoices",className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"الفواتير"}),(0,b.jsx)(v.Card,{children:(0,b.jsx)(v.CardContent,{className:"pt-6",children:0===R.length?(0,b.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد فواتير"}):(0,b.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,b.jsxs)(A.Table,{children:[(0,b.jsx)(A.TableHeader,{children:(0,b.jsxs)(A.TableRow,{children:[(0,b.jsx)(A.TableHead,{children:"رقم الفاتورة"}),(0,b.jsx)(A.TableHead,{children:"النوع"}),(0,b.jsx)(A.TableHead,{children:"المالك"}),(0,b.jsx)(A.TableHead,{children:"المبلغ"}),(0,b.jsx)(A.TableHead,{children:"المدفوع"}),(0,b.jsx)(A.TableHead,{children:"الحالة"}),(0,b.jsx)(A.TableHead,{children:"التاريخ"})]})}),(0,b.jsx)(A.TableBody,{children:R.map(a=>(0,b.jsxs)(A.TableRow,{children:[(0,b.jsx)(A.TableCell,{className:"font-medium",children:a.invoiceNumber}),(0,b.jsx)(A.TableCell,{children:a.type}),(0,b.jsx)(A.TableCell,{children:a.ownerAssociation?.name||"-"}),(0,b.jsxs)(A.TableCell,{children:["$",a.amount.toFixed(2)]}),(0,b.jsx)(A.TableCell,{children:"-"}),(0,b.jsx)(A.TableCell,{children:(0,b.jsx)(y.Badge,{variant:a.isPaid?"default":"secondary",children:a.isPaid?"مدفوعة":"غير مدفوعة"})}),(0,b.jsx)(A.TableCell,{children:new Date(a.issuedAt).toLocaleDateString()})]},a.id))})]})})})})]}),(aI||aJ)&&(0,b.jsxs)(w.TabsContent,{value:"payments",className:"space-y-4",children:[(0,b.jsx)("h3",{className:"text-lg font-semibold",children:"المدفوعات"}),(0,b.jsx)(v.Card,{children:(0,b.jsx)(v.CardContent,{className:"pt-6",children:(0,b.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"سجل المدفوعات"})})})]})]}),(0,b.jsxs)(v.Card,{children:[(0,b.jsx)(v.CardHeader,{children:(0,b.jsx)(v.CardTitle,{className:"text-base",children:"التنقل السريع"})}),(0,b.jsx)(v.CardContent,{children:(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsx)("button",{onClick:()=>i.push(`/dashboard/payments?unit=${G}`),className:"text-sm px-3 py-2 bg-[#F3F4F6] hover:bg-[#E5E7EB] text-[#111827] border border-[#E5E7EB] rounded-md font-medium transition-colors",children:"عرض مدفوعات الوحدة"}),(0,b.jsx)("button",{onClick:()=>i.push(`/dashboard/invoices?unit=${G}`),className:"text-sm px-3 py-2 bg-[#F3F4F6] hover:bg-[#E5E7EB] text-[#111827] border border-[#E5E7EB] rounded-md font-medium transition-colors",children:"عرض فواتير الوحدة"}),(aH||aJ)&&(0,b.jsx)("button",{onClick:()=>i.push(`/dashboard/residents/new?unitId=${G}`),className:"text-sm px-3 py-2 bg-[#F3F4F6] hover:bg-[#E5E7EB] text-[#111827] border border-[#E5E7EB] rounded-md font-medium transition-colors",children:"إضافة ساكن"}),(0,b.jsx)("button",{onClick:()=>i.push("/dashboard/technicians"),className:"text-sm px-3 py-2 bg-[#F3F4F6] hover:bg-[#E5E7EB] text-[#111827] border border-[#E5E7EB] rounded-md font-medium transition-colors",children:"عرض الفنيين"}),(0,b.jsx)("button",{onClick:()=>i.push("/dashboard/operational-units"),className:"text-sm px-3 py-2 bg-[#F3F4F6] hover:bg-[#E5E7EB] text-[#111827] border border-[#E5E7EB] rounded-md font-medium transition-colors",children:"العودة للوحدات"})]})})]}),(0,b.jsx)(D.Dialog,{open:an,onOpenChange:ao,children:(0,b.jsxs)(D.DialogContent,{className:"bg-zinc-900 border-zinc-800",children:[(0,b.jsxs)(D.DialogHeader,{children:[(0,b.jsx)(D.DialogTitle,{className:"text-xl text-blue-400",children:"تعديل بيانات الفوترة الشهرية"}),(0,b.jsx)(D.DialogDescription,{className:"text-zinc-400",children:"قم بتحديث المطالبة الشهرية ويوم التحصيل لهذه الوحدة"})]}),(0,b.jsxs)("div",{className:"space-y-6 py-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(C.Label,{className:"text-sm text-zinc-300",children:"المطالبة الشهرية (EGP)"}),(0,b.jsx)(B.Input,{type:"number",min:"0",step:"0.01",value:ar,onChange:a=>as(parseFloat(a.target.value)||0),className:"bg-zinc-800 border-zinc-700 text-white",placeholder:"0.00"}),(0,b.jsx)("p",{className:"text-xs text-zinc-500",children:"أدخل 0 لإيقاف الفوترة التلقائية لهذه الوحدة"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(C.Label,{className:"text-sm text-zinc-300",children:"يوم التحصيل الشهري (1-31)"}),(0,b.jsx)(B.Input,{type:"number",min:"1",max:"31",value:at,onChange:a=>{au(Math.min(31,Math.max(1,parseInt(a.target.value)||1)))},className:"bg-zinc-800 border-zinc-700 text-white",placeholder:"1"}),(0,b.jsx)("p",{className:"text-xs text-zinc-500",children:"اليوم من الشهر الذي سيتم فيه توليد الفاتورة تلقائيًا"})]})]}),(0,b.jsxs)(D.DialogFooter,{children:[(0,b.jsx)(z.Button,{variant:"outline",onClick:()=>ao(!1),className:"border-zinc-700 text-zinc-300 hover:bg-zinc-800",disabled:ap,children:"إلغاء"}),(0,b.jsx)(z.Button,{onClick:aL,className:"bg-blue-600 hover:bg-blue-700",disabled:ap,children:ap?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.Loader,{className:"h-4 w-4 mr-2 animate-spin"}),"جاري الحفظ..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.CheckCircle2,{className:"h-4 w-4 mr-2"}),"حفظ التغييرات"]})})]})]})}),(0,b.jsx)(D.Dialog,{open:av,onOpenChange:aw,children:(0,b.jsxs)(D.DialogContent,{className:"bg-zinc-900 border-zinc-800",children:[(0,b.jsxs)(D.DialogHeader,{children:[(0,b.jsx)(D.DialogTitle,{className:"text-white",children:"تعديل اسم الوحدة"}),(0,b.jsx)(D.DialogDescription,{className:"text-zinc-400",children:"عدل اسم الوحدة الحالية."})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(C.Label,{className:"text-sm text-zinc-300",children:"اسم الوحدة"}),(0,b.jsx)(B.Input,{value:az,onChange:a=>aA(a.target.value),className:"bg-zinc-800 border-zinc-700 text-white",placeholder:"اسم الوحدة"})]}),(0,b.jsxs)(D.DialogFooter,{children:[(0,b.jsx)(z.Button,{variant:"outline",onClick:()=>aw(!1),className:"border-zinc-700 text-zinc-300 hover:bg-zinc-800",disabled:ax,children:"إلغاء"}),(0,b.jsx)(z.Button,{onClick:aM,className:"bg-blue-600 hover:bg-blue-700",disabled:ax||!az.trim(),children:ax?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.Loader,{className:"h-4 w-4 mr-2 animate-spin"}),"جاري الحفظ..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(p.CheckCircle2,{className:"h-4 w-4 mr-2"}),"حفظ التغييرات"]})})]})]})}),(0,b.jsx)(D.Dialog,{open:aB,onOpenChange:aC,children:(0,b.jsxs)(D.DialogContent,{className:"bg-zinc-900 border-zinc-800",children:[(0,b.jsxs)(D.DialogHeader,{children:[(0,b.jsx)(D.DialogTitle,{className:"text-white",children:"إضافة ساكن جديد"}),(0,b.jsxs)(D.DialogDescription,{className:"text-zinc-400",children:["أضف ساكن جديد لوحدة ",H?.name]})]}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(C.Label,{className:"text-sm text-zinc-300",children:"الاسم *"}),(0,b.jsx)(B.Input,{value:aF.name,onChange:a=>aG({...aF,name:a.target.value}),className:"bg-zinc-800 border-zinc-700 text-white",placeholder:"اسم الساكن"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(C.Label,{className:"text-sm text-zinc-300",children:"البريد الإلكتروني"}),(0,b.jsx)(B.Input,{type:"email",value:aF.email,onChange:a=>aG({...aF,email:a.target.value}),className:"bg-zinc-800 border-zinc-700 text-white",placeholder:"example@email.com"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(C.Label,{className:"text-sm text-zinc-300",children:"رقم الهاتف"}),(0,b.jsx)(B.Input,{type:"tel",value:aF.phone,onChange:a=>aG({...aF,phone:a.target.value}),className:"bg-zinc-800 border-zinc-700 text-white",placeholder:"+20 123 456 7890"})]}),(0,b.jsxs)("div",{className:"space-y-2",children:[(0,b.jsx)(C.Label,{className:"text-sm text-zinc-300",children:"العنوان"}),(0,b.jsx)(B.Input,{value:aF.address,onChange:a=>aG({...aF,address:a.target.value}),className:"bg-zinc-800 border-zinc-700 text-white",placeholder:"العنوان الكامل"})]})]}),(0,b.jsxs)(D.DialogFooter,{children:[(0,b.jsx)(z.Button,{variant:"outline",onClick:()=>{aC(!1),aG({name:"",email:"",phone:"",address:""})},className:"border-zinc-700 text-zinc-300 hover:bg-zinc-800",disabled:aD,children:"إلغاء"}),(0,b.jsx)(z.Button,{onClick:aN,className:"bg-emerald-600 hover:bg-emerald-700",disabled:aD||!aF.name.trim(),children:aD?(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(g.Loader,{className:"h-4 w-4 mr-2 animate-spin"}),"جاري الإضافة..."]}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)(h.Plus,{className:"h-4 w-4 mr-2"}),"إضافة الساكن"]})})]})]})})]})}a.s(["default",()=>E],57055)}];

//# sourceMappingURL=Desktop_cmd-main_src_app_dashboard_operational-units_%5Bid%5D_page_tsx_8f3d6b6b._.js.map