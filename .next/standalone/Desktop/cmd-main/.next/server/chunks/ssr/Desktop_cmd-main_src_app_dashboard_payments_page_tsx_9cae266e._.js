module.exports=[57842,a=>{"use strict";var b=a.i(43713),c=a.i(68599),d=a.i(84642),e=a.i(17545),f=a.i(53053),g=a.i(49015),h=a.i(33347),i=a.i(55658),j=a.i(72760),k=a.i(79059),l=a.i(66871),m=a.i(9446),n=a.i(91564),o=a.i(57684),p=a.i(66128),q=a.i(77726),r=a.i(65189),s=a.i(48367),t=a.i(63395),u=a.i(59627);function v(){let{data:a,status:v}=(0,d.useSession)(),w=(0,e.useRouter)(),x=(0,e.useSearchParams)().get("unit"),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)(!0),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)("all"),[I,J]=(0,c.useState)(""),[K,L]=(0,c.useState)(""),[M,N]=(0,c.useState)(""),[O,P]=(0,c.useState)(null),[Q,R]=(0,c.useState)(!1);(0,c.useEffect)(()=>{if(D(!0),"loading"!==v&&a){if("ADMIN"!==a.user.role&&"ACCOUNTANT"!==a.user.role)return void w.replace("/dashboard");S()}},[v,a]),(0,c.useEffect)(()=>{x?(async()=>{try{R(!0);let a=await fetch(`/api/operational-units/${x}`);if(!a.ok)throw Error("Failed to fetch unit");let b=await a.json();P(b)}catch(a){console.error("Error fetching unit:",a),P(null)}finally{R(!1)}})():P(null)},[x]);let S=async()=>{try{B(!0),F(null);let a=await fetch("/api/invoices"),b=a.ok?await a.json():[],c=[];b.forEach(a=>{a.payments?.forEach(b=>{c.push({id:b.id,amount:b.amount,paidAt:b.createdAt||a.issuedAt,type:"invoice",invoiceId:a.id,invoiceNumber:a.invoiceNumber,unitId:a.unitId,unitName:a.unit?.name,projectId:a.unit?.project?.id,projectName:a.unit?.project?.name})}),a.isPaid&&a.totalPaid>0&&(!a.payments||0===a.payments.length)&&c.push({id:`inv-${a.id}`,amount:a.totalPaid,paidAt:a.updatedAt||a.issuedAt,type:"invoice",invoiceId:a.id,invoiceNumber:a.invoiceNumber,unitId:a.unitId,unitName:a.unit?.name,projectId:a.unit?.project?.id,projectName:a.unit?.project?.name})});let d=await fetch("/api/technician-payments"),e=[];d.ok&&(await d.json()).forEach(a=>{e.push({id:a.id,amount:a.amount,paidAt:a.paidAt,type:"technician",technicianId:a.technicianId,technicianName:a.technician?.name||"Unknown",unitId:a.work?.unit?.id,unitName:a.work?.unit?.name,projectId:a.work?.unit?.project?.id,projectName:a.work?.unit?.project?.name})}),z([...c,...e])}catch(a){console.error("Error fetching payments:",a),F("فشل تحميل المدفوعات")}finally{B(!1)}},T=(0,c.useMemo)(()=>{let a=y;if(x&&(a=a.filter(a=>a.unitId===x)),""!==G&&"all"!==G&&(a=a.filter(a=>a.type===G)),I&&(a=a.filter(a=>a.invoiceNumber?.includes(I)||a.unitName?.toLowerCase().includes(I.toLowerCase())||a.technicianName?.toLowerCase().includes(I.toLowerCase()))),K){let b=new Date(K);a=a.filter(a=>new Date(a.paidAt)>=b)}if(M){let b=new Date(M);a=a.filter(a=>new Date(a.paidAt)<=b)}return a.sort((a,b)=>new Date(b.paidAt).getTime()-new Date(a.paidAt).getTime())},[y,G,I,K,M]),U=(0,c.useMemo)(()=>{let a=T.reduce((a,b)=>a+b.amount,0),b=T.filter(a=>"invoice"===a.type),c=T.filter(a=>"technician"===a.type);return{total:a.toFixed(2),count:T.length,invoiceAmount:b.reduce((a,b)=>a+b.amount,0).toFixed(2),invoiceCount:b.length,techAmount:c.reduce((a,b)=>a+b.amount,0).toFixed(2),techCount:c.length}},[T]);return C?A?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,b.jsx)(k.Loader,{className:"h-8 w-8 animate-spin text-emerald-500"})}):(0,b.jsx)("div",{className:"flex-1 p-8 lg:p-12 overflow-y-auto",children:(0,b.jsxs)("div",{className:"max-w-7xl mx-auto space-y-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)("h1",{className:"text-3xl font-semibold text-gray-900 mb-2 flex items-center gap-3",children:[(0,b.jsx)("div",{className:"p-2.5 bg-gray-100 rounded-md",children:(0,b.jsx)(h.TrendingUp,{className:"h-6 w-6 text-gray-600"})}),"المدفوعات"]}),(0,b.jsx)("p",{className:"text-gray-500",children:x?"عرض مدفوعات الوحدة المحددة":"عرض ومتابعة جميع المدفوعات والتحويلات"})]}),x&&(0,b.jsxs)(o.Card,{children:[(0,b.jsx)(o.CardHeader,{children:(0,b.jsx)(o.CardTitle,{className:"text-base",children:"تفاصيل الوحدة"})}),(0,b.jsx)(o.CardContent,{children:Q?(0,b.jsxs)("div",{className:"flex items-center gap-2 text-gray-500",children:[(0,b.jsx)(k.Loader,{className:"h-4 w-4 animate-spin"}),"جاري تحميل بيانات الوحدة..."]}):O?(0,b.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-3",children:[(0,b.jsx)(r.Badge,{variant:"outline",className:"bg-gray-50 border-gray-200 text-gray-700",children:O.code}),(0,b.jsx)("span",{className:"font-semibold text-gray-900",children:O.name}),O.project?.name&&(0,b.jsx)(r.Badge,{variant:"secondary",className:"text-xs",children:O.project.name}),void 0!==O.isActive&&(0,b.jsx)(r.Badge,{className:O.isActive?"bg-[#ECFDF5] border border-[#16A34A]/20 text-[#16A34A]":"bg-[#FEF2F2] border border-[#DC2626]/20 text-[#DC2626]",variant:"outline",children:O.isActive?"نشطة":"غير نشطة"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-3",children:[(0,b.jsxs)("div",{className:"bg-gray-50 rounded-md border border-[#E5E7EB] p-3",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"عدد السكان"}),(0,b.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:O._count?.residents??0})]}),(0,b.jsxs)("div",{className:"bg-gray-50 rounded-md border border-[#E5E7EB] p-3",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"التذاكر"}),(0,b.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:O._count?.tickets??0})]}),(0,b.jsxs)("div",{className:"bg-gray-50 rounded-md border border-[#E5E7EB] p-3",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"طلبات التوصيل"}),(0,b.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:O._count?.deliveryOrders??0})]}),(0,b.jsxs)("div",{className:"bg-gray-50 rounded-md border border-[#E5E7EB] p-3",children:[(0,b.jsx)("p",{className:"text-xs text-gray-500",children:"يوم التحصيل"}),(0,b.jsx)("p",{className:"text-lg font-semibold text-gray-900",children:O.monthlyBillingDay??"-"})]})]}),(0,b.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,b.jsx)(t.Button,{variant:"outline",onClick:()=>w.push(`/dashboard/operational-units/${O.id}`),children:"عرض بيانات الوحدة"}),(0,b.jsx)(t.Button,{variant:"outline",onClick:()=>w.push(`/dashboard/invoices?unit=${O.id}`),children:"فواتير الوحدة"})]})]}):(0,b.jsx)("p",{className:"text-gray-500",children:"تعذر تحميل بيانات الوحدة"})})]}),E&&(0,b.jsxs)(p.Alert,{variant:"destructive",className:"bg-red-500/10 border-red-500/20",children:[(0,b.jsx)(j.AlertCircle,{className:"h-4 w-4"}),(0,b.jsx)(p.AlertDescription,{className:"text-red-400",children:E})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{className:"bg-white border border-[#E5E7EB] rounded-[12px] p-4 shadow-sm",children:[(0,b.jsx)("div",{className:"flex items-start justify-between mb-3",children:(0,b.jsx)("div",{className:"p-2.5 bg-gray-100 rounded-md",children:(0,b.jsx)(l.CheckCircle2,{className:"w-5 h-5 text-gray-600"})})}),(0,b.jsx)("p",{className:"text-gray-500 text-sm mb-1",children:"إجمالي المدفوعات"}),(0,b.jsx)("p",{className:"text-3xl font-semibold text-gray-900",children:U.count})]}),(0,b.jsxs)("div",{className:"bg-white border border-[#E5E7EB] rounded-[12px] p-4 shadow-sm",children:[(0,b.jsx)("div",{className:"flex items-start justify-between mb-3",children:(0,b.jsx)("div",{className:"p-2.5 bg-gray-100 rounded-md",children:(0,b.jsx)(g.DollarSign,{className:"w-5 h-5 text-gray-600"})})}),(0,b.jsx)("p",{className:"text-gray-500 text-sm mb-1",children:"المجموع"}),(0,b.jsx)("p",{className:"text-3xl font-semibold text-gray-900",children:U.total}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-2",children:"جنيه مصري"})]}),(0,b.jsxs)("div",{className:"bg-white border border-[#E5E7EB] rounded-[12px] p-4 shadow-sm",children:[(0,b.jsx)("div",{className:"flex items-start justify-between mb-3",children:(0,b.jsx)("div",{className:"p-2.5 bg-gray-100 rounded-md",children:(0,b.jsx)(m.CreditCard,{className:"w-5 h-5 text-gray-600"})})}),(0,b.jsx)("p",{className:"text-gray-500 text-sm mb-1",children:"دفعات الفواتير"}),(0,b.jsx)("p",{className:"text-3xl font-semibold text-gray-900",children:U.invoiceAmount}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:[U.invoiceCount," معاملة"]})]}),(0,b.jsxs)("div",{className:"bg-white border border-[#E5E7EB] rounded-[12px] p-4 shadow-sm",children:[(0,b.jsx)("div",{className:"flex items-start justify-between mb-3",children:(0,b.jsx)("div",{className:"p-2.5 bg-gray-100 rounded-md",children:(0,b.jsx)(n.User,{className:"w-5 h-5 text-gray-600"})})}),(0,b.jsx)("p",{className:"text-gray-500 text-sm mb-1",children:"رواتب التقنيين"}),(0,b.jsx)("p",{className:"text-3xl font-semibold text-gray-900",children:U.techAmount}),(0,b.jsxs)("p",{className:"text-xs text-gray-500 mt-2",children:[U.techCount," معاملة"]})]})]}),(0,b.jsxs)("div",{className:"bg-white border border-[#E5E7EB] rounded-[12px] p-4 shadow-sm",children:[(0,b.jsx)("h2",{className:"text-base font-semibold text-gray-900 mb-4",children:"البحث والتصفية"}),(0,b.jsxs)("div",{className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-500 block mb-2",children:"البحث"}),(0,b.jsx)(u.Input,{placeholder:"ابحث برقم الفاتورة أو الوحدة أو الفني...",value:I,onChange:a=>J(a.target.value),className:"bg-white border-gray-200 text-gray-900 placeholder:text-gray-400 focus:border-[#2563EB]"})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-500 block mb-2",children:"نوع المدفوعات"}),(0,b.jsxs)(s.Select,{value:G||"default",onValueChange:a=>{"default"===a?H("all"):H(a)},children:[(0,b.jsx)(s.SelectTrigger,{className:"bg-white border-gray-200 text-gray-900",children:(0,b.jsx)(s.SelectValue,{placeholder:"جميع المدفوعات"})}),(0,b.jsxs)(s.SelectContent,{children:[(0,b.jsx)(s.SelectItem,{value:"default",children:"جميع المدفوعات"}),(0,b.jsx)(s.SelectItem,{value:"invoice",children:"دفعات الفواتير"}),(0,b.jsx)(s.SelectItem,{value:"technician",children:"رواتب التقنيين"})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-500 block mb-2",children:"من التاريخ"}),(0,b.jsx)(u.Input,{type:"date",value:K,onChange:a=>L(a.target.value),className:"bg-white border-gray-200 text-gray-900"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)("label",{className:"text-sm font-medium text-gray-500 block mb-2",children:"إلى التاريخ"}),(0,b.jsx)(u.Input,{type:"date",value:M,onChange:a=>N(a.target.value),className:"bg-white border-gray-200 text-gray-900"})]})]}),(I||"all"!==G||K||M)&&(0,b.jsx)(t.Button,{variant:"outline",onClick:()=>{J(""),H("all"),L(""),N("")},className:"w-full border-gray-300 text-gray-700 hover:bg-gray-50",children:"مسح التصفية"})]})]}),(0,b.jsx)("div",{className:"bg-white border border-[#E5E7EB] rounded-[12px] p-4 shadow-sm overflow-x-auto",children:0===T.length?(0,b.jsxs)("div",{className:"text-center py-12 text-gray-500",children:[(0,b.jsx)(g.DollarSign,{className:"h-12 w-12 mx-auto opacity-50 mb-2 text-gray-400"}),(0,b.jsx)("p",{children:"لا توجد مدفوعات"})]}):(0,b.jsx)("div",{className:"overflow-x-auto",children:(0,b.jsxs)(q.Table,{children:[(0,b.jsx)(q.TableHeader,{children:(0,b.jsxs)(q.TableRow,{className:"hover:bg-transparent",children:[(0,b.jsx)(q.TableHead,{children:"النوع"}),(0,b.jsx)(q.TableHead,{children:"التفاصيل"}),(0,b.jsx)(q.TableHead,{children:"الوحدة / الفني"}),(0,b.jsxs)(q.TableHead,{className:"flex items-center gap-1",children:[(0,b.jsx)(i.Calendar,{className:"h-4 w-4"})," التاريخ"]}),(0,b.jsx)(q.TableHead,{className:"text-right",children:"المبلغ"})]})}),(0,b.jsx)(q.TableBody,{children:T.map(a=>(0,b.jsxs)(q.TableRow,{children:[(0,b.jsx)(q.TableCell,{children:(0,b.jsx)(r.Badge,{className:"invoice"===a.type?"bg-[#EFF6FF] border border-[#2563EB]/20 text-[#2563EB]":"bg-[#F3F4F6] border border-[#E5E7EB] text-[#111827]",variant:"outline",children:"invoice"===a.type?"فاتورة":"راتب فني"})}),(0,b.jsx)(q.TableCell,{className:"font-semibold text-gray-900",children:"invoice"===a.type?(0,b.jsxs)(f.default,{href:`/dashboard/invoices/${a.invoiceId}`,className:"text-[#2563EB] hover:underline cursor-pointer",children:["الفاتورة رقم: ",a.invoiceNumber]}):a.technicianId?(0,b.jsxs)(f.default,{href:`/dashboard/technicians/${a.technicianId}`,className:"text-[#2563EB] hover:underline cursor-pointer",children:["الفني: ",a.technicianName]}):`الفني: ${a.technicianName}`}),(0,b.jsx)(q.TableCell,{className:"text-gray-500",children:(a.type,(0,b.jsxs)("div",{className:"text-sm",children:[(0,b.jsx)("div",{className:"text-gray-700",children:a.unitName||"-"}),a.projectName&&(0,b.jsx)("div",{className:"text-xs text-gray-500",children:a.projectName})]}))}),(0,b.jsx)(q.TableCell,{className:"text-sm text-gray-500",children:new Date(a.paidAt).toLocaleDateString("ar-EG")}),(0,b.jsxs)(q.TableCell,{className:"text-right font-semibold text-gray-900",children:[a.amount.toFixed(2)," ج.م"]})]},a.id))})]})})})]})}):null}a.s(["default",()=>v])}];

//# sourceMappingURL=Desktop_cmd-main_src_app_dashboard_payments_page_tsx_9cae266e._.js.map