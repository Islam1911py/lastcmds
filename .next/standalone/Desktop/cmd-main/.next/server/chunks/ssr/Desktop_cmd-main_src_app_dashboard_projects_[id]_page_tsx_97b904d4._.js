module.exports=[98020,a=>{"use strict";var b=a.i(43713),c=a.i(68599),d=a.i(84642),e=a.i(17545),f=a.i(72760);let g=(0,a.i(90306).default)("arrow-right",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);var h=a.i(79059),i=a.i(49466),j=a.i(52341),k=a.i(34192),l=a.i(46382),m=a.i(66128),n=a.i(65189),o=a.i(63395),p=a.i(59627),q=a.i(57684),r=a.i(48421),s=a.i(73348);let t={MANAGER:"مدير مشروع",ACCOUNTANT:"محاسب",SECURITY:"أمن",CLEANER:"نظافة",PLUMBER:"سباك",CARPENTER:"نجار",ELECTRICIAN:"كهربائي",PAINTER:"دهان",GENERAL_WORKER:"عامل عام",TECHNICIAN:"فني"},u={OFFICE_STAFF:"موظف مكتبي",FIELD_WORKER:"عامل ميداني"},v={NEW:"جديدة",IN_PROGRESS:"قيد التنفيذ",COMPLETED:"مكتملة",CLOSED:"مغلقة",RESOLVED:"مغلقة"};function w(){let a,w,x,{data:y,status:z}=(0,d.useSession)(),A=(0,e.useRouter)(),B=(0,e.useParams)().id,[C,D]=(0,c.useState)(null),[E,F]=(0,c.useState)(!0),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)(null),[K,L]=(0,c.useState)(""),M=y?.user?.role==="ADMIN",N=y?.user?.role==="ADMIN"||y?.user?.role==="ACCOUNTANT",O=a=>{let b=[...a.staff??[],...(a.staffUnitAssignments??[]).map(a=>a.staff).filter(a=>!!a)],c=new Map;return b.forEach(a=>{"ACTIVE"===a.status&&c.set(a.id,a)}),Array.from(c.values())},P=(a,b)=>{J({scope:"unit",unit:a,section:b}),L("")},Q=a=>{J({scope:"project",section:a}),L("")};(0,c.useEffect)(()=>{"loading"!==z&&y&&R()},[y,z,B]);let R=async()=>{try{F(!0),H(null);let a=await fetch(`/api/projects?projectId=${B}`);if(!a.ok)throw Error("Failed to fetch project");let b=await a.json();D(b[0]||null)}catch(a){console.error("Error:",a),H("Failed to load project")}finally{F(!1)}},S=(0,c.useMemo)(()=>{if(!C?.operationalUnits)return[];let a=new Map;return C.operationalUnits.forEach(b=>{O(b).forEach(c=>((b,c)=>{if(!b||"ACTIVE"!==b.status)return;let d=a.get(b.id);if(d){d.units.some(a=>a.id===c.id)||d.units.push({id:c.id,name:c.name,code:c.code});return}a.set(b.id,{id:b.id,name:b.name,phone:b.phone||void 0,role:b.role,type:b.type,units:[{id:c.id,name:c.name,code:c.code}]})})(c,b))}),Array.from(a.values()).map(a=>({...a,units:a.units.sort((a,b)=>a.name.localeCompare(b.name,"ar"))})).sort((a,b)=>a.name.localeCompare(b.name,"ar"))},[C]),T=(0,c.useMemo)(()=>C?{units:C.operationalUnits?.length??0,residents:C.operationalUnits?.reduce((a,b)=>a+(b.residents?.length??0),0)??0,tickets:C.operationalUnits?.reduce((a,b)=>a+(b.tickets?.length??0),0)??0,staff:S.length}:{units:0,residents:0,tickets:0,staff:0},[C,S]);return"loading"===z||E?(0,b.jsx)("div",{className:"flex items-center justify-center min-h-screen bg-background",children:(0,b.jsx)(h.Loader,{className:"h-8 w-8 animate-spin text-primary"})}):G||!C?(0,b.jsxs)("div",{className:"p-6 bg-background min-h-screen",children:[(0,b.jsxs)(o.Button,{variant:"outline",onClick:()=>A.back(),className:"mb-6 border-gray-300 text-gray-700 hover:bg-gray-50",children:[(0,b.jsx)(g,{className:"h-4 w-4 mr-2 rotate-180"}),"العودة"]}),(0,b.jsxs)(m.Alert,{className:"bg-[#FEF2F2] border-[#DC2626]/20",children:[(0,b.jsx)(f.AlertCircle,{className:"h-4 w-4 text-[#DC2626]"}),(0,b.jsx)(m.AlertDescription,{className:"text-[#DC2626]",children:G||"المشروع غير موجود"})]})]}):(0,b.jsxs)("div",{className:"p-6 bg-background min-h-screen",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-8",children:[(0,b.jsxs)("div",{children:[(0,b.jsxs)(o.Button,{variant:"outline",onClick:()=>A.back(),className:"mb-4 border-gray-300 text-gray-700 hover:bg-gray-50",children:[(0,b.jsx)(g,{className:"h-4 w-4 mr-2 rotate-180"}),"العودة"]}),(0,b.jsx)("h1",{className:"text-3xl font-semibold text-gray-900 mb-2",children:C.name}),(0,b.jsxs)("p",{className:"text-gray-500",children:["RESIDENTIAL_COMPOUND"===C.type&&"مجمع سكني","PHARMACY"===C.type&&"صيدلية","MALL"===C.type&&"مول تجاري","OFFICE_BUILDING"===C.type&&"مبنى إداري","RESORT"===C.type&&"منتجع سياحي"]}),(0,b.jsxs)("p",{className:"text-gray-500 text-sm mt-1",children:["تاريخ الإنشاء: ",new Date(C.createdAt).toLocaleDateString("ar-EG")]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[M&&(0,b.jsx)(o.Button,{onClick:()=>A.push(`/dashboard/operational-units?projectId=${C.id}`),className:"bg-[#2563EB] hover:bg-[#1D4ED8] text-white",children:"إضافة وحدة"}),C.isActive&&(0,b.jsx)(n.Badge,{className:"bg-[#ECFDF5] border border-[#16A34A]/20 text-[#16A34A]",children:"نشط"})]})]}),(0,b.jsxs)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4 mb-8",children:[(0,b.jsxs)(q.Card,{className:"border-[#E5E7EB]",children:[(0,b.jsxs)(q.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(q.CardTitle,{className:"text-sm font-medium text-gray-600",children:"الوحدات"}),(0,b.jsx)(l.Building2,{className:"h-5 w-5 text-gray-400"})]}),(0,b.jsxs)(q.CardContent,{children:[(0,b.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:T.units}),(0,b.jsx)(o.Button,{variant:"outline",size:"sm",className:"mt-3",onClick:()=>document.getElementById("project-units-section")?.scrollIntoView({behavior:"smooth",block:"start"}),children:"عرض الوحدات"})]})]}),(0,b.jsxs)(q.Card,{className:"border-[#E5E7EB]",children:[(0,b.jsxs)(q.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(q.CardTitle,{className:"text-sm font-medium text-gray-600",children:"السكان"}),(0,b.jsx)(i.Users,{className:"h-5 w-5 text-emerald-500"})]}),(0,b.jsxs)(q.CardContent,{children:[(0,b.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:T.residents}),(0,b.jsx)(o.Button,{variant:"outline",size:"sm",className:"mt-3",onClick:()=>Q("residents"),children:"عرض السكان"})]})]}),(0,b.jsxs)(q.Card,{className:"border-[#E5E7EB]",children:[(0,b.jsxs)(q.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(q.CardTitle,{className:"text-sm font-medium text-gray-600",children:"التذاكر"}),(0,b.jsx)(j.Ticket,{className:"h-5 w-5 text-blue-500"})]}),(0,b.jsxs)(q.CardContent,{children:[(0,b.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:T.tickets}),(0,b.jsx)(o.Button,{variant:"outline",size:"sm",className:"mt-3",onClick:()=>Q("tickets"),children:"عرض التذاكر"})]})]}),(0,b.jsxs)(q.Card,{className:"border-[#E5E7EB]",children:[(0,b.jsxs)(q.CardHeader,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,b.jsx)(q.CardTitle,{className:"text-sm font-medium text-gray-600",children:"فريق العمل"}),(0,b.jsx)(k.HardHat,{className:"h-5 w-5 text-amber-500"})]}),(0,b.jsxs)(q.CardContent,{children:[(0,b.jsx)("p",{className:"text-2xl font-semibold text-gray-900",children:T.staff}),(0,b.jsx)(o.Button,{variant:"outline",size:"sm",className:"mt-3",onClick:()=>Q("staff"),children:"عرض الفريق"})]})]})]}),N&&(0,b.jsxs)("div",{className:"bg-white border border-[#E5E7EB] rounded-[12px] p-4 mb-8 shadow-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,b.jsx)(f.AlertCircle,{className:"h-5 w-5 text-gray-500"}),(0,b.jsx)("h3",{className:"text-base font-semibold text-gray-900",children:"رسوم الإدارة الشهرية"})]}),(0,b.jsxs)("p",{className:"text-gray-500 text-sm mb-2",children:["رسوم الإدارة الشهرية يتم تحديدها على مستوى كل ",(0,b.jsx)("strong",{children:"وحدة تشغيلية"})," بشكل منفصل."]}),(0,b.jsx)("p",{className:"text-gray-500 text-sm",children:"لتعديل الرسوم الشهرية، قم بفتح صفحة الوحدة التشغيلية من القائمة أدناه."})]}),(0,b.jsxs)("div",{id:"project-units-section",className:"bg-white border border-[#E5E7EB] rounded-[12px] p-4 shadow-sm",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-6",children:(0,b.jsx)("h2",{className:"text-base font-semibold text-gray-900",children:"الوحدات التشغيلية"})}),C.operationalUnits&&0!==C.operationalUnits.length?(0,b.jsx)("div",{className:"space-y-3",children:C.operationalUnits.map(a=>{let c=a.residents?.length??0,d=a.tickets?.length??0,e=O(a).length;return(0,b.jsxs)("div",{className:"bg-[#F9FAFB] border border-[#E5E7EB] rounded-[12px] p-4",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between gap-4",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("h3",{className:"text-gray-900 font-semibold",children:a.name}),(0,b.jsx)(n.Badge,{variant:"outline",className:"bg-white border border-[#E5E7EB] text-gray-700 text-xs",children:a.code})]}),(0,b.jsxs)("div",{className:"flex flex-wrap items-center gap-4 mt-2 text-sm text-gray-500",children:[(0,b.jsxs)("span",{children:["النوع: ",a.type]}),N&&a.monthlyManagementFee&&(0,b.jsxs)("span",{className:"text-gray-900 font-semibold",children:[a.monthlyManagementFee.toLocaleString()," جنيه/شهر"]}),N&&a.monthlyBillingDay&&(0,b.jsxs)("span",{children:["يوم التحصيل: ",a.monthlyBillingDay]}),(0,b.jsx)("span",{className:"text-gray-400",children:a.isActive?"نشطة":"غير نشطة"})]})]}),(0,b.jsxs)(o.Button,{variant:"ghost",size:"sm",className:"text-emerald-600 hover:text-emerald-700",onClick:()=>A.push(`/dashboard/operational-units/${a.id}`),children:["فتح الوحدة",(0,b.jsx)(g,{className:"mr-2 h-4 w-4 rotate-180"})]})]}),(0,b.jsxs)("div",{className:"mt-4 flex flex-wrap gap-2",children:[(0,b.jsxs)(o.Button,{variant:"secondary",size:"sm",className:"flex items-center gap-2",onClick:()=>P(a,"residents"),children:["السكان",(0,b.jsx)(n.Badge,{variant:"outline",className:"text-xs",children:c})]}),(0,b.jsxs)(o.Button,{variant:"outline",size:"sm",className:"flex items-center gap-2",onClick:()=>P(a,"tickets"),children:["التذاكر",(0,b.jsx)(n.Badge,{variant:"outline",className:"text-xs",children:d})]}),(0,b.jsxs)(o.Button,{variant:"outline",size:"sm",className:"flex items-center gap-2",onClick:()=>P(a,"staff"),children:["الفريق",(0,b.jsx)(n.Badge,{variant:"outline",className:"text-xs",children:e})]})]})]},a.id)})}):(0,b.jsxs)("div",{className:"text-center py-8",children:[(0,b.jsx)("p",{className:"text-gray-500 mb-4",children:"لا توجد وحدات تشغيلية للمشروع حالياً"}),M&&(0,b.jsx)(o.Button,{onClick:()=>A.push(`/dashboard/operational-units?projectId=${C.id}`),className:"bg-[#2563EB] hover:bg-[#1D4ED8] text-white",children:"إضافة أول وحدة"})]})]}),(0,b.jsx)(r.Dialog,{open:!!I,onOpenChange:a=>a?null:void(J(null),L("")),children:(0,b.jsx)(r.DialogContent,{className:"max-w-2xl",children:I&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)(r.DialogHeader,{children:[(0,b.jsx)(r.DialogTitle,{children:"project"===I.scope?"residents"===I.section?"سكان المشروع":"tickets"===I.section?"التذاكر المرتبطة":"فريق المشروع":"residents"===I.section?`سكان وحدة ${I.unit.name}`:"tickets"===I.section?`تذاكر وحدة ${I.unit.name}`:`فريق وحدة ${I.unit.name}`}),(0,b.jsx)(r.DialogDescription,{children:"استخدم البحث للعثور بسرعة على التفاصيل المطلوبة."})]}),(0,b.jsx)(p.Input,{autoFocus:!0,placeholder:"ابحث بالاسم أو الرقم أو الكود",className:"mt-4",value:K,onChange:a=>L(a.target.value)}),(0,b.jsx)(s.ScrollArea,{className:"mt-4 max-h-[420px] pr-4",children:(a=K.trim().toLowerCase(),w=[],w="residents"===I.section?("project"===I.scope?C?.operationalUnits.flatMap(a=>(a.residents??[]).map(b=>({resident:b,unit:a})))??[]:(I.unit.residents??[]).map(a=>({resident:a,unit:I.unit}))).map(({resident:a,unit:b})=>({id:a.id,title:a.name,subtitle:a.phone||a.whatsappPhone||"لا يوجد رقم للتواصل",meta:b?`${b.code} \xb7 ${b.name}`:void 0})):"tickets"===I.section?("project"===I.scope?C?.operationalUnits.flatMap(a=>(a.tickets??[]).map(b=>({ticket:b,unit:a})))??[]:(I.unit.tickets??[]).map(a=>({ticket:a,unit:I.unit}))).map(({ticket:a,unit:b})=>({id:a.id,title:a.title,subtitle:a.resident?.name?`${a.resident.name}${a.resident.phone?` • ${a.resident.phone}`:""}`:a.description||"بدون وصف",meta:`${b.code} \xb7 ${b.name} • ${v[a.status]||a.status}`})):("project"===I.scope?S.map(a=>({member:a})):O(I.unit).map(a=>({staff:a}))).map(a=>"member"in a?{id:a.member.id,title:a.member.name,subtitle:a.member.phone||"لا يوجد رقم",meta:`${t[a.member.role]||a.member.role} • ${a.member.units.map(a=>a.code).join("، ")}`}:{id:a.staff.id,title:a.staff.name,subtitle:a.staff.phone||"لا يوجد رقم",meta:`${t[a.staff.role]||a.staff.role} • ${u[a.staff.type]}`}),0===(x=a?w.filter(b=>b.title.toLowerCase().includes(a)||(b.subtitle??"").toLowerCase().includes(a)||(b.meta??"").toLowerCase().includes(a)):w).length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground mt-2",children:"لا توجد نتائج مطابقة."}):(0,b.jsx)("div",{className:"space-y-3",children:x.map(a=>(0,b.jsxs)("div",{className:"rounded-lg border border-[#E5E7EB] bg-[#F9FAFB] px-4 py-3",children:[(0,b.jsx)("p",{className:"font-medium text-gray-900",children:a.title}),a.subtitle&&(0,b.jsx)("p",{className:"text-sm text-gray-500 mt-1",children:a.subtitle}),a.meta&&(0,b.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:a.meta})]},a.id))}))})]})})})]})}a.s(["default",()=>w],98020)}];

//# sourceMappingURL=Desktop_cmd-main_src_app_dashboard_projects_%5Bid%5D_page_tsx_97b904d4._.js.map