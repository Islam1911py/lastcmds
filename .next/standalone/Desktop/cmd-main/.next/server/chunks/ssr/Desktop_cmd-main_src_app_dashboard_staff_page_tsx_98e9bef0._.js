module.exports=[29259,a=>{"use strict";var b=a.i(43713),c=a.i(68599),d=a.i(84642),e=a.i(49466),f=a.i(22488),g=a.i(74509),h=a.i(50063),i=a.i(90306);let j=(0,i.default)("briefcase",[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]]),k=(0,i.default)("hammer",[["path",{d:"m15 12-8.373 8.373a1 1 0 1 1-3-3L12 9",key:"eefl8a"}],["path",{d:"m18 15 4-4",key:"16gjal"}],["path",{d:"m21.5 11.5-1.914-1.914A2 2 0 0 1 19 8.172V7l-2.26-2.26a6 6 0 0 0-4.202-1.756L9 2.96l.92.82A6.18 6.18 0 0 1 12 8.4V10l2 2h1.172a2 2 0 0 1 1.414.586L18.5 14.5",key:"b7pghm"}]]);var l=a.i(57684),m=a.i(63395),n=a.i(84177),o=a.i(77726),p=a.i(65189),q=a.i(48421),r=a.i(48367),s=a.i(59627),t=a.i(61977),u=a.i(20179),v=a.i(84194);let w={OFFICE_STAFF:["MANAGER","ACCOUNTANT","SECURITY","CLEANER"],FIELD_WORKER:["PLUMBER","CARPENTER","ELECTRICIAN","PAINTER","GENERAL_WORKER","TECHNICIAN"]},x={MANAGER:"مدير مشروع",ACCOUNTANT:"محاسب",SECURITY:"أمن",CLEANER:"نظافة",PLUMBER:"سباك",CARPENTER:"نجار",ELECTRICIAN:"كهربائي",PAINTER:"دهاش",GENERAL_WORKER:"عامل عام",TECHNICIAN:"فني"};function y(){let{data:a}=(0,d.useSession)(),{toast:i}=(0,v.useToast)(),[y,z]=(0,c.useState)([]),[A,B]=(0,c.useState)(!0),[C,D]=(0,c.useState)(!1),[E,F]=(0,c.useState)(null),[G,H]=(0,c.useState)(null),[I,J]=(0,c.useState)([]),[K,L]=(0,c.useState)([]),[M,N]=(0,c.useState)("ALL"),[O,P]=(0,c.useState)({name:"",type:"OFFICE_STAFF",role:"",phone:"",salary:"",paymentDay:"",unitId:"",projectIds:[],unitIds:[]}),Q=(0,c.useMemo)(()=>O.projectIds.length?I.filter(a=>O.projectIds.includes(a.projectId)):[],[I,O.projectIds]);(0,c.useEffect)(()=>{T(),R(),S()},[]);let R=async()=>{try{let a=await fetch("/api/operational-units"),b=await a.json();J(b)}catch(a){console.error("Error fetching units:",a)}},S=async()=>{try{let a=await fetch("/api/projects"),b=await a.json();L(b)}catch(a){console.error("Error fetching projects:",a)}},T=async()=>{try{B(!0);let a=await fetch("/api/staff"),b=await a.json();z(b)}catch(a){console.error("Error:",a),i({title:"Error",description:"Failed to fetch staff members",variant:"destructive"})}finally{B(!1)}},U=async a=>{a.preventDefault();let b=Array.from(new Set([O.unitId,...O.unitIds].filter(Boolean)));if(!O.name||!O.type||!O.role||0===b.length||!b[0])return void i({title:"خطأ",description:"الرجاء ملء جميع الحقول المطلوبة",variant:"destructive"});if("OFFICE_STAFF"===O.type&&!O.salary)return void i({title:"خطأ",description:"الراتب مطلوب لموظفي المكاتب",variant:"destructive"});if("OFFICE_STAFF"===O.type&&!O.paymentDay)return void i({title:"خطأ",description:"يوم الدفع مطلوب لموظفي المكاتب",variant:"destructive"});if(0===O.projectIds.length)return void i({title:"خطأ",description:"الرجاء اختيار مشروع واحد على الأقل",variant:"destructive"});try{let a=E?`/api/staff/${E}`:"/api/staff";if(!(await fetch(a,{method:E?"PUT":"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:O.name,type:O.type,role:O.role,phone:O.phone||null,salary:"OFFICE_STAFF"===O.type?parseFloat(O.salary):null,paymentDay:"OFFICE_STAFF"===O.type?parseInt(O.paymentDay):null,unitId:b[0],unitIds:b,projectIds:O.projectIds})})).ok)throw Error("Failed to save");i({title:"نجح",description:E?"تم تحديث بيانات الموظف":"تم إضافة الموظف"}),D(!1),W(),T()}catch(a){console.error("Error:",a),i({title:"خطأ",description:E?"فشل تحديث بيانات الموظف":"فشل إضافة الموظف",variant:"destructive"})}},V=async()=>{try{if(!(await fetch(`/api/staff/${G}`,{method:"DELETE"})).ok)throw Error("Failed to delete");i({title:"نجح",description:"تم حذف الموظف"}),H(null),T()}catch(a){console.error("Error:",a),i({title:"خطأ",description:"فشل حذف الموظف",variant:"destructive"})}},W=()=>{P({name:"",type:"OFFICE_STAFF",role:"",phone:"",salary:"",paymentDay:"",unitId:"",projectIds:[],unitIds:[]}),F(null)},X=y.filter(a=>"ALL"===M||a.type===M),Y=w[O.type];return(0,b.jsxs)("div",{className:"space-y-6",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold",children:"إدارة الموظفين"}),(0,b.jsx)("p",{className:"text-muted-foreground mt-2",children:"إدارة موظفي المكاتب والعمال الميدانيين"})]}),(0,b.jsxs)(q.Dialog,{open:C,onOpenChange:D,children:[(0,b.jsx)(q.DialogTrigger,{asChild:!0,children:(0,b.jsxs)(m.Button,{onClick:()=>W(),children:[(0,b.jsx)(f.Plus,{className:"mr-2 h-4 w-4"}),"إضافة موظف"]})}),(0,b.jsxs)(q.DialogContent,{children:[(0,b.jsxs)(q.DialogHeader,{children:[(0,b.jsx)(q.DialogTitle,{children:E?"تحرير الموظف":"إضافة موظف جديد"}),(0,b.jsx)(q.DialogDescription,{children:E?"تحديث تفاصيل الموظف":"إنشاء سجل موظف جديد"})]}),(0,b.jsxs)("form",{onSubmit:U,className:"space-y-4",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{htmlFor:"name",children:"الاسم *"}),(0,b.jsx)(s.Input,{id:"name",value:O.name,onChange:a=>P({...O,name:a.target.value}),placeholder:"أدخل اسم الموظف"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{htmlFor:"type",children:"نوع الموظف *"}),(0,b.jsxs)(r.Select,{value:O.type,onValueChange:a=>P({...O,type:a,role:""}),children:[(0,b.jsx)(r.SelectTrigger,{id:"type",children:(0,b.jsx)(r.SelectValue,{})}),(0,b.jsxs)(r.SelectContent,{children:[(0,b.jsx)(r.SelectItem,{value:"OFFICE_STAFF",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j,{className:"h-4 w-4"}),"موظفو المكتب"]})}),(0,b.jsx)(r.SelectItem,{value:"FIELD_WORKER",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(k,{className:"h-4 w-4"}),"العامل الميداني"]})})]})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{htmlFor:"role",children:"الدور *"}),(0,b.jsxs)(r.Select,{value:O.role,onValueChange:a=>P({...O,role:a}),children:[(0,b.jsx)(r.SelectTrigger,{id:"role",children:(0,b.jsx)(r.SelectValue,{placeholder:"اختر دورا"})}),(0,b.jsx)(r.SelectContent,{children:Y.map(a=>(0,b.jsx)(r.SelectItem,{value:a,children:x[a]},a))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{htmlFor:"phone",children:"الهاتف (اختياري)"}),(0,b.jsx)(s.Input,{id:"phone",value:O.phone,onChange:a=>P({...O,phone:a.target.value}),placeholder:"أدخل رقم الهاتف"})]}),"OFFICE_STAFF"===O.type&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{htmlFor:"salary",children:"الراتب الشهري (جنيه مصري) *"}),(0,b.jsx)(s.Input,{id:"salary",type:"number",value:O.salary,onChange:a=>P({...O,salary:a.target.value}),placeholder:"أدخل الراتب الشهري"})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{htmlFor:"paymentDay",children:"يوم الدفع (1-30) *"}),(0,b.jsx)(s.Input,{id:"paymentDay",type:"number",min:"1",max:"30",value:O.paymentDay,onChange:a=>P({...O,paymentDay:a.target.value}),placeholder:"أدخل يوم الدفع (1-30)"})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{children:"المشاريع المعينة *"}),(0,b.jsx)("div",{className:"space-y-2 mt-2 p-3 border rounded-md bg-muted",children:0===K.length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"لا توجد مشاريع"}):K.map(a=>(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"checkbox",id:`project-${a.id}`,checked:O.projectIds.includes(a.id),onChange:b=>{let{checked:c}=b.target;P(b=>{let d=c?Array.from(new Set([...b.projectIds,a.id])):b.projectIds.filter(b=>b!==a.id),e=I.filter(a=>d.includes(a.projectId)).map(a=>a.id),f=b.unitIds.filter(a=>e.includes(a)),g=b.unitId;return e.includes(g)||(g=f[0]||""),{...b,projectIds:d,unitIds:f,unitId:g}})}}),(0,b.jsx)(t.Label,{htmlFor:`project-${a.id}`,className:"cursor-pointer font-normal",children:a.name})]},a.id))})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{htmlFor:"unit",children:"الوحدة التشغيلية الأساسية *"}),(0,b.jsxs)(r.Select,{value:O.unitId,onValueChange:a=>P(b=>{let c=new Set(b.unitIds.length?b.unitIds:b.unitId?[b.unitId]:[]);return c.add(a),{...b,unitId:a,unitIds:Array.from(c)}}),disabled:0===Q.length,children:[(0,b.jsx)(r.SelectTrigger,{id:"unit",children:(0,b.jsx)(r.SelectValue,{placeholder:Q.length?"اختر وحدة":"اختر المشاريع أولًا"})}),(0,b.jsx)(r.SelectContent,{children:Q.map(a=>(0,b.jsxs)(r.SelectItem,{value:a.id,children:[a.code," - ",a.name," (",a.project?.name||"",")"]},a.id))})]})]}),(0,b.jsxs)("div",{children:[(0,b.jsx)(t.Label,{children:"الوحدات المرتبطة *"}),(0,b.jsx)("div",{className:"space-y-2 mt-2 p-3 border rounded-md bg-muted",children:O.projectIds.length?0===Q.length?(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"لا توجد وحدات ضمن المشاريع المحددة."}):Q.map(a=>{let c=`unit-${a.id}`,d=O.unitIds.includes(a.id);return(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)("input",{type:"checkbox",id:c,checked:d,onChange:b=>{var c,d;return c=a.id,d=b.target.checked,void P(a=>{let b=new Set(a.unitIds.length?a.unitIds:a.unitId?[a.unitId]:[]);if(d?b.add(c):b.delete(c),0===b.size)return i({title:"تنبيه",description:"يجب اختيار وحدة واحدة على الأقل",variant:"destructive"}),a;let e=I.filter(b=>a.projectIds.includes(b.projectId)).map(a=>a.id),f=new Set([...b].filter(a=>e.includes(a)));if(!f.size)return i({title:"تنبيه",description:"الوحدات المختارة يجب أن تتبع المشاريع المحددة",variant:"destructive"}),a;let g=a.unitId;return f.has(g)||(g=[...f][0]||""),{...a,unitId:g,unitIds:Array.from(f)}})}}),(0,b.jsxs)(t.Label,{htmlFor:c,className:"cursor-pointer font-normal",children:[a.code," - ",a.name,(0,b.jsx)("span",{className:"text-xs text-muted-foreground block",children:a.project?.name||""})]})]},a.id)}):(0,b.jsx)("p",{className:"text-sm text-muted-foreground",children:"اختر مشروعًا لعرض الوحدات المتاحة."})})]}),(0,b.jsxs)(m.Button,{type:"submit",className:"w-full",children:[E?"تحديث":"إضافة"," موظف"]})]})]})]})]}),(0,b.jsxs)(l.Card,{children:[(0,b.jsx)(l.CardHeader,{children:(0,b.jsxs)("div",{className:"flex items-center justify-between",children:[(0,b.jsxs)(l.CardTitle,{className:"flex items-center gap-2",children:[(0,b.jsx)(e.Users,{className:"h-5 w-5"}),"جميع الموظفين"]}),(0,b.jsxs)(r.Select,{value:M,onValueChange:a=>N(a),children:[(0,b.jsx)(r.SelectTrigger,{className:"w-40",children:(0,b.jsx)(r.SelectValue,{})}),(0,b.jsxs)(r.SelectContent,{children:[(0,b.jsx)(r.SelectItem,{value:"ALL",children:"جميع الموظفين"}),(0,b.jsx)(r.SelectItem,{value:"OFFICE_STAFF",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(j,{className:"h-4 w-4"}),"موظفو المكتب"]})}),(0,b.jsx)(r.SelectItem,{value:"FIELD_WORKER",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(k,{className:"h-4 w-4"}),"العمال الميدانيون"]})})]})]})]})}),(0,b.jsx)(l.CardContent,{children:A?(0,b.jsx)("div",{className:"space-y-4",children:[void 0,void 0,void 0,void 0,void 0].map((a,c)=>(0,b.jsx)(n.Skeleton,{className:"h-12"},c))}):0===X.length?(0,b.jsxs)("div",{className:"flex flex-col items-center justify-center py-12",children:[(0,b.jsx)(e.Users,{className:"h-12 w-12 text-muted-foreground mb-4"}),(0,b.jsx)("p",{className:"text-muted-foreground",children:"لم يتم العثور على موظفين"})]}):(0,b.jsxs)(o.Table,{children:[(0,b.jsx)(o.TableHeader,{children:(0,b.jsxs)(o.TableRow,{children:[(0,b.jsx)(o.TableHead,{children:"الاسم"}),(0,b.jsx)(o.TableHead,{children:"النوع"}),(0,b.jsx)(o.TableHead,{children:"الدور"}),(0,b.jsx)(o.TableHead,{children:"الوحدة"}),(0,b.jsx)(o.TableHead,{children:"الراتب"}),(0,b.jsx)(o.TableHead,{children:"الحالة"}),(0,b.jsx)(o.TableHead,{children:"الإجراءات"})]})}),(0,b.jsx)(o.TableBody,{children:X.map(a=>(0,b.jsxs)(o.TableRow,{children:[(0,b.jsx)(o.TableCell,{className:"font-medium",children:a.name}),(0,b.jsx)(o.TableCell,{children:(0,b.jsxs)(p.Badge,{variant:"outline",className:"flex w-fit gap-1",children:["OFFICE_STAFF"===a.type?(0,b.jsx)(j,{className:"h-3 w-3"}):(0,b.jsx)(k,{className:"h-3 w-3"}),"OFFICE_STAFF"===a.type?"موظفو المكتب":"العامل الميداني"]})}),(0,b.jsx)(o.TableCell,{children:x[a.role]}),(0,b.jsx)(o.TableCell,{children:(0,b.jsxs)(p.Badge,{variant:"secondary",children:[a.unit.code," - ",a.unit.name]})}),(0,b.jsx)(o.TableCell,{children:"OFFICE_STAFF"===a.type?`${a.salary?.toLocaleString()} جنيه مصري/شهر`:"سعر يومي"}),(0,b.jsx)(o.TableCell,{children:(0,b.jsx)(p.Badge,{variant:"ACTIVE"===a.status?"default":"secondary",children:a.status})}),(0,b.jsxs)(o.TableCell,{className:"flex gap-2",children:[(0,b.jsx)(m.Button,{size:"sm",variant:"ghost",onClick:()=>{let b,c,d,e;return b=Array.isArray(a.projectAssignments)?a.projectAssignments.map(a=>a.projectId||a.project?.id).filter(a=>!!a):[],c=Array.isArray(a.unitAssignments)?a.unitAssignments.map(a=>a.unitId||a.unit?.id).filter(a=>!!a):[],e=Array.from(new Set([d=a.unit?.id||c[0]||"",...c].filter(Boolean))),void(P({name:a.name,type:a.type,role:a.role,phone:a.phone||"",salary:a.salary?a.salary.toString():"",paymentDay:"OFFICE_STAFF"===a.type&&null!=a.paymentDay?a.paymentDay.toString():"",unitId:d,projectIds:b,unitIds:e}),F(a.id),D(!0))},children:(0,b.jsx)(g.Edit2,{className:"h-4 w-4"})}),(0,b.jsx)(m.Button,{size:"sm",variant:"ghost",className:"text-red-500",onClick:()=>H(a.id),children:(0,b.jsx)(h.Trash2,{className:"h-4 w-4"})})]})]},a.id))})]})})]}),(0,b.jsx)(u.AlertDialog,{open:!!G,onOpenChange:a=>!a&&H(null),children:(0,b.jsxs)(u.AlertDialogContent,{children:[(0,b.jsx)(u.AlertDialogTitle,{children:"حذف الموظف"}),(0,b.jsx)(u.AlertDialogDescription,{children:"هل أنت متأكد من حذف هذا الموظف؟ لا يمكن التراجع عن هذا الإجراء."}),(0,b.jsxs)("div",{className:"flex gap-4",children:[(0,b.jsx)(u.AlertDialogCancel,{children:"إلغاء"}),(0,b.jsx)(u.AlertDialogAction,{onClick:V,className:"bg-red-600 hover:bg-red-700",children:"حذف"})]})]})})]})}a.s(["default",()=>y],29259)}];

//# sourceMappingURL=Desktop_cmd-main_src_app_dashboard_staff_page_tsx_98e9bef0._.js.map