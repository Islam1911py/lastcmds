(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,9416,e=>{"use strict";var t=e.i(2985),a=e.i(99442),r=e.i(63886),i=e.i(29234);let s=(0,r.cva)("inline-flex items-center justify-center rounded-md border px-2 py-0.5 text-xs font-medium w-fit whitespace-nowrap shrink-0 [&>svg]:size-3 gap-1 [&>svg]:pointer-events-none focus-visible:border-ring focus-visible:ring-ring/50 focus-visible:ring-[3px] aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive transition-[color,box-shadow] overflow-hidden",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground [a&]:hover:bg-primary/90",secondary:"border-transparent bg-secondary text-secondary-foreground [a&]:hover:bg-secondary/90",destructive:"border-transparent bg-destructive text-white [a&]:hover:bg-destructive/90 focus-visible:ring-destructive/20 dark:focus-visible:ring-destructive/40 dark:bg-destructive/60",outline:"text-foreground [a&]:hover:bg-accent [a&]:hover:text-accent-foreground"}},defaultVariants:{variant:"default"}});function l({className:e,variant:r,asChild:l=!1,...n}){let c=l?a.Slot:"span";return(0,t.jsx)(c,{"data-slot":"badge",className:(0,i.cn)(s({variant:r}),e),...n})}e.s(["Badge",()=>l])},29462,e=>{"use strict";var t=e.i(2985),a=e.i(29234);function r({className:e,...r}){return(0,t.jsx)("div",{"data-slot":"table-container",className:"relative w-full overflow-x-auto",children:(0,t.jsx)("table",{"data-slot":"table",className:(0,a.cn)("w-full caption-bottom text-sm",e),...r})})}function i({className:e,...r}){return(0,t.jsx)("thead",{"data-slot":"table-header",className:(0,a.cn)("bg-secondary [&_tr]:border-b [&_tr]:border-border",e),...r})}function s({className:e,...r}){return(0,t.jsx)("tbody",{"data-slot":"table-body",className:(0,a.cn)("[&_tr:last-child]:border-0",e),...r})}function l({className:e,...r}){return(0,t.jsx)("tr",{"data-slot":"table-row",className:(0,a.cn)("border-b border-border hover:bg-[#F9FAFB] data-[state=selected]:bg-muted transition-colors",e),...r})}function n({className:e,...r}){return(0,t.jsx)("th",{"data-slot":"table-head",className:(0,a.cn)("text-foreground h-10 px-3 text-right align-middle font-semibold text-[15px] whitespace-nowrap [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}function c({className:e,...r}){return(0,t.jsx)("td",{"data-slot":"table-cell",className:(0,a.cn)("px-3 py-3 align-middle whitespace-nowrap text-[14px] text-foreground text-right [&:has([role=checkbox])]:pr-0 [&>[role=checkbox]]:translate-y-[2px]",e),...r})}e.s(["Table",()=>r,"TableBody",()=>s,"TableCell",()=>c,"TableHead",()=>n,"TableHeader",()=>i,"TableRow",()=>l])},52936,e=>{"use strict";var t=e.i(2985),a=e.i(29234);function r({className:e,...r}){return(0,t.jsx)("textarea",{"data-slot":"textarea",className:(0,a.cn)("border-input placeholder:text-muted-foreground focus-visible:border-ring focus-visible:ring-ring/50 aria-invalid:ring-destructive/20 dark:aria-invalid:ring-destructive/40 aria-invalid:border-destructive dark:bg-input/30 flex field-sizing-content min-h-16 w-full rounded-md border bg-transparent px-3 py-2 text-base shadow-xs transition-[color,box-shadow] outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),...r})}e.s(["Textarea",()=>r])},50186,e=>{"use strict";let t=(0,e.i(72188).default)("trash-2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);e.s(["Trash2",()=>t],50186)},32666,e=>{"use strict";var t=e.i(2985),a=e.i(88020),r=e.i(19007),i=e.i(40059),s=e.i(11316),l=e.i(92825),n=e.i(2678),c=e.i(97546),d=e.i(52936),o=e.i(26633),h=e.i(29462),x=e.i(9416),u=e.i(51581),g=e.i(26486),b=e.i(72188);let m=(0,b.default)("play",[["polygon",{points:"6 3 20 12 6 21 6 3",key:"1oa8hb"}]]),p=(0,b.default)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);var j=e.i(50186);function v(){(0,a.useRouter)();let{toast:e}=(0,u.useToast)(),{data:b}=(0,r.useSession)(),[v,y]=(0,i.useState)(!0),[f,w]=(0,i.useState)([]),[N,T]=(0,i.useState)([]),[C,k]=(0,i.useState)([]),[S,I]=(0,i.useState)(!1),[E,B]=(0,i.useState)(!1),[D,F]=(0,i.useState)(null),[H,A]=(0,i.useState)({technicianId:"",projectId:"",unitId:"",description:""}),[P,R]=(0,i.useState)({amount:"",notes:""}),[O,L]=(0,i.useState)(!1);(0,i.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/projects"),t=await e.json();w(t);let a=await fetch("/api/technicians"),r=await a.json();T(r);let i=await fetch("/api/technician-work"),s=await i.json();k(s),y(!1)}catch(e){console.error(e),y(!1)}})()},[]);let V=async()=>{if(!H.technicianId||!H.projectId||!H.unitId||!H.description.trim())return void e({title:"خطأ",description:"ملء جميع الحقول مطلوب",variant:"destructive"});try{if(L(!0),!(await fetch("/api/technician-work",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({technicianId:H.technicianId,unitId:H.unitId,description:H.description})})).ok)throw Error("Failed");e({title:"نجاح",description:"تم إضافة العمل"}),A({technicianId:"",projectId:"",unitId:"",description:""}),I(!1);let t=await fetch("/api/technician-work"),a=await t.json();k(a)}catch(t){e({title:"خطأ",description:"فشل الحفظ",variant:"destructive"})}finally{L(!1)}},z=async t=>{try{if(!(await fetch(`/api/technician-work/${t}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"start"})})).ok)throw Error("Failed");e({title:"نجاح",description:"تم بدء العمل"});let a=await fetch("/api/technician-work"),r=await a.json();k(r)}catch(t){e({title:"خطأ",variant:"destructive"})}},G=async()=>{if(!P.amount||!P.notes.trim()||!D)return void e({title:"خطأ",description:"ملء الحقول مطلوب",variant:"destructive"});try{if(L(!0),!(await fetch(`/api/technician-work/${D}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({action:"complete",amount:parseFloat(P.amount),description:P.notes})})).ok)throw Error("Failed");e({title:"نجاح",description:"تم إكمال العمل وإضافة الفلوس للعامل والفاتورة"}),R({amount:"",notes:""}),F(null),B(!1);let t=await fetch("/api/technician-work"),a=await t.json();k(a)}catch(t){e({title:"خطأ",variant:"destructive"})}finally{L(!1)}},_=async t=>{if(confirm("حذف هذا العمل؟"))try{if(!(await fetch(`/api/technician-work/${t}`,{method:"DELETE"})).ok)throw Error("Failed");e({title:"نجاح",description:"تم الحذف"});let a=await fetch("/api/technician-work"),r=await a.json();k(r)}catch(t){e({title:"خطأ",variant:"destructive"})}};if(v)return(0,t.jsx)("div",{className:"p-8",children:"جاري التحميل..."});let M=f.find(e=>e.id===H.projectId);return(0,t.jsx)("div",{className:"p-8",children:(0,t.jsxs)("div",{className:"max-w-7xl mx-auto",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"أعمال التقنيين"}),(0,t.jsxs)("p",{className:"text-gray-500 mt-1",children:[C.length," عمل مسجل"]})]}),(0,t.jsxs)(o.Dialog,{open:S,onOpenChange:I,children:[(0,t.jsx)(o.DialogTrigger,{asChild:!0,children:(0,t.jsxs)(s.Button,{className:"bg-[#2563EB] hover:bg-[#1D4ED8] text-white",children:[(0,t.jsx)(g.Plus,{className:"w-4 h-4 ml-2"}),"إضافة عمل"]})}),(0,t.jsxs)(o.DialogContent,{className:"bg-white max-w-md",children:[(0,t.jsx)(o.DialogHeader,{children:(0,t.jsx)(o.DialogTitle,{className:"text-gray-900",children:"عمل جديد"})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(n.Label,{className:"text-gray-700 text-sm",children:"العامل"}),(0,t.jsxs)(l.Select,{value:H.technicianId,onValueChange:e=>A({...H,technicianId:e}),children:[(0,t.jsx)(l.SelectTrigger,{className:"bg-white border-gray-200 mt-2",children:(0,t.jsx)(l.SelectValue,{placeholder:"اختر العامل..."})}),(0,t.jsx)(l.SelectContent,{children:N.map(e=>(0,t.jsx)(l.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(n.Label,{className:"text-gray-700 text-sm",children:"المشروع"}),(0,t.jsxs)(l.Select,{value:H.projectId,onValueChange:e=>A({...H,projectId:e,unitId:""}),children:[(0,t.jsx)(l.SelectTrigger,{className:"bg-white border-gray-200 mt-2",children:(0,t.jsx)(l.SelectValue,{placeholder:"اختر المشروع..."})}),(0,t.jsx)(l.SelectContent,{children:f.map(e=>(0,t.jsx)(l.SelectItem,{value:e.id,children:e.name},e.id))})]})]}),M&&(0,t.jsxs)("div",{children:[(0,t.jsx)(n.Label,{className:"text-gray-700 text-sm",children:"الوحدة"}),(0,t.jsxs)(l.Select,{value:H.unitId,onValueChange:e=>A({...H,unitId:e}),children:[(0,t.jsx)(l.SelectTrigger,{className:"bg-white border-gray-200 mt-2",children:(0,t.jsx)(l.SelectValue,{placeholder:"اختر الوحدة..."})}),(0,t.jsx)(l.SelectContent,{children:M.operationalUnits.map(e=>(0,t.jsxs)(l.SelectItem,{value:e.id,children:[e.code," - ",e.name]},e.id))})]})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(n.Label,{className:"text-gray-700 text-sm",children:"وصف العمل"}),(0,t.jsx)(d.Textarea,{placeholder:"ماذا سيتم عمله؟",value:H.description,onChange:e=>A({...H,description:e.target.value}),className:"bg-white border-gray-200 mt-2",rows:3})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(s.Button,{onClick:()=>I(!1),variant:"outline",className:"flex-1 border-gray-300 text-gray-600 hover:bg-gray-50",children:"إلغاء"}),(0,t.jsx)(s.Button,{onClick:V,disabled:O||!H.technicianId||!H.unitId||!H.description.trim(),className:"flex-1 bg-[#2563EB] hover:bg-[#1D4ED8] text-white",children:O?"جاري...":"حفظ"})]})]})]})]})]}),(0,t.jsx)("div",{className:"bg-white border border-gray-200 rounded-xl overflow-hidden shadow-sm",children:0===C.length?(0,t.jsx)("div",{className:"p-8 text-center text-gray-500",children:"لا توجد أعمال"}):(0,t.jsxs)(h.Table,{children:[(0,t.jsx)(h.TableHeader,{className:"bg-gray-50",children:(0,t.jsxs)(h.TableRow,{className:"border-gray-200",children:[(0,t.jsx)(h.TableHead,{className:"text-gray-700",children:"العامل"}),(0,t.jsx)(h.TableHead,{className:"text-gray-700",children:"المشروع"}),(0,t.jsx)(h.TableHead,{className:"text-gray-700",children:"الوحدة"}),(0,t.jsx)(h.TableHead,{className:"text-gray-700",children:"الوصف"}),(0,t.jsx)(h.TableHead,{className:"text-gray-700",children:"الحالة"}),(0,t.jsx)(h.TableHead,{className:"text-gray-700",children:"المبلغ"}),(0,t.jsx)(h.TableHead,{className:"text-gray-700 text-center",children:"إجراءات"})]})}),(0,t.jsx)(h.TableBody,{children:C.map(e=>(0,t.jsxs)(h.TableRow,{className:"border-gray-200 hover:bg-gray-50",children:[(0,t.jsx)(h.TableCell,{className:"text-gray-900",children:e.technician.name}),(0,t.jsx)(h.TableCell,{className:"text-gray-500",children:e.unit.project.name}),(0,t.jsx)(h.TableCell,{className:"text-gray-500",children:e.unit.code}),(0,t.jsx)(h.TableCell,{className:"text-gray-500",children:e.description}),(0,t.jsx)(h.TableCell,{children:(0,t.jsx)(x.Badge,{className:"PENDING"===e.status?"bg-[#FFFBEB] text-[#F59E0B] border border-[#F59E0B]/20":"IN_PROGRESS"===e.status?"bg-[#EFF6FF] text-[#2563EB] border border-[#2563EB]/20":"bg-[#ECFDF5] text-[#16A34A] border border-[#16A34A]/20",children:"PENDING"===e.status?"⏳ معلق":"IN_PROGRESS"===e.status?"▶️ قيد العمل":"✓ مكتمل"})}),(0,t.jsx)(h.TableCell,{className:"text-gray-900",children:e.amount?`${e.amount.toLocaleString()} جنيه`:"-"}),(0,t.jsxs)(h.TableCell,{className:"text-center space-x-2",children:["PENDING"===e.status&&(0,t.jsx)(s.Button,{size:"sm",onClick:()=>z(e.id),className:"bg-[#2563EB] hover:bg-[#1D4ED8] text-white",children:(0,t.jsx)(m,{className:"w-4 h-4"})}),"IN_PROGRESS"===e.status&&(0,t.jsxs)(o.Dialog,{open:E&&D===e.id,onOpenChange:t=>{B(t),t&&F(e.id)},children:[(0,t.jsx)(o.DialogTrigger,{asChild:!0,children:(0,t.jsx)(s.Button,{size:"sm",className:"bg-emerald-600 hover:bg-emerald-700",children:(0,t.jsx)(p,{className:"w-4 h-4"})})}),(0,t.jsxs)(o.DialogContent,{className:"bg-white",children:[(0,t.jsx)(o.DialogHeader,{children:(0,t.jsx)(o.DialogTitle,{className:"text-gray-900",children:"إكمال العمل"})}),(0,t.jsxs)("div",{className:"space-y-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)(n.Label,{className:"text-gray-700 text-sm",children:"المبلغ (جنيه)"}),(0,t.jsx)(c.Input,{type:"number",placeholder:"200",value:P.amount,onChange:e=>R({...P,amount:e.target.value}),className:"bg-white border-gray-200 mt-2"})]}),(0,t.jsxs)("div",{children:[(0,t.jsx)(n.Label,{className:"text-gray-700 text-sm",children:"ملاحظات العمل"}),(0,t.jsx)(d.Textarea,{placeholder:"تفاصيل العمل المنجز",value:P.notes,onChange:e=>R({...P,notes:e.target.value}),className:"bg-white border-gray-200 mt-2",rows:3})]}),(0,t.jsxs)("div",{className:"flex gap-2",children:[(0,t.jsx)(s.Button,{onClick:()=>B(!1),variant:"outline",className:"flex-1 border-gray-300 text-gray-600 hover:bg-gray-50",children:"إلغاء"}),(0,t.jsx)(s.Button,{onClick:G,disabled:O||!P.amount||!P.notes.trim(),className:"flex-1 bg-[#16A34A] hover:bg-[#15803D] text-white",children:O?"جاري...":"إكمال"})]})]})]})]}),(0,t.jsx)(s.Button,{size:"sm",onClick:()=>_(e.id),className:"bg-[#DC2626] hover:bg-[#B91C1C] text-white",children:(0,t.jsx)(j.Trash2,{className:"w-4 h-4"})})]})]},e.id))})]})})]})})}e.s(["default",()=>v],32666)}]);