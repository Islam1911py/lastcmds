(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,25029,e=>{"use strict";var s=e.i(2985),a=e.i(40059),l=e.i(19007),t=e.i(88020),n=e.i(2251),i=e.i(73258),r=e.i(26486),d=e.i(72188);let c=(0,d.default)("square-pen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);var o=e.i(91013),x=e.i(60942),m=e.i(71840),h=e.i(3531),j=e.i(91724),u=e.i(30626),b=e.i(63967),p=e.i(13075),g=e.i(63917),N=e.i(50186);let v=(0,d.default)("save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);var f=e.i(46658),y=e.i(47756),C=e.i(13949),w=e.i(9416),T=e.i(11316),k=e.i(29462),z=e.i(97546),E=e.i(2678),F=e.i(26633);function D(){let e=(0,t.useParams)(),d=(0,t.useRouter)(),{data:D,status:H}=(0,l.useSession)(),B=e.id,[S,P]=(0,a.useState)(null),[L,$]=(0,a.useState)([]),[A,I]=(0,a.useState)([]),[M,O]=(0,a.useState)([]),[R,U]=(0,a.useState)([]),[J,_]=(0,a.useState)([]),[G,K]=(0,a.useState)(null),[V,q]=(0,a.useState)(null),[W,Q]=(0,a.useState)([]),[X,Y]=(0,a.useState)(""),[Z,ee]=(0,a.useState)(""),[es,ea]=(0,a.useState)(""),[el,et]=(0,a.useState)(!1),[en,ei]=(0,a.useState)(!1),[er,ed]=(0,a.useState)(!0),[ec,eo]=(0,a.useState)(null),[ex,em]=(0,a.useState)("overview"),[eh,ej]=(0,a.useState)(!1),[eu,eb]=(0,a.useState)(!1),[ep,eg]=(0,a.useState)(0),[eN,ev]=(0,a.useState)(1),[ef,ey]=(0,a.useState)(!1),[eC,ew]=(0,a.useState)(!1),[eT,ek]=(0,a.useState)(""),[ez,eE]=(0,a.useState)(!1),[eF,eD]=(0,a.useState)(!1),[eH,eB]=(0,a.useState)({name:"",email:"",phone:"",address:""}),eS=D?.user?.role==="PROJECT_MANAGER",eP=D?.user?.role==="ACCOUNTANT",eL=D?.user?.role==="ADMIN";(0,a.useEffect)(()=>{"loading"!==H&&D&&e$()},[D,H,B]),(0,a.useEffect)(()=>{let e=()=>{!document.hidden&&D&&e$()},s=()=>{D&&e$()};return document.addEventListener("visibilitychange",e),window.addEventListener("focus",s),()=>{document.removeEventListener("visibilitychange",e),window.removeEventListener("focus",s)}},[D,B]);let e$=async()=>{try{ed(!0),eo(null),et(!0);let e=await fetch(`/api/summary/unit/${B}`);if(!e.ok)throw Error("Failed to fetch unit");let s=await e.json();K(s),s.unit&&(P(s.unit),eg(s.unit.monthlyManagementFee||0),ev(s.unit.monthlyBillingDay||1),ek(s.unit.name||""));let[a,l,t,n,i,r]=await Promise.all([fetch(`/api/operational-units/${B}/residents`),fetch(`/api/tickets?unitId=${B}`),fetch(`/api/technician-work?unitId=${B}`),fetch(`/api/unit-expenses?unitId=${B}`),fetch(`/api/invoices?unitId=${B}`),fetch(`/api/operational-units/${B}/owner`)]);if(a.ok&&$(await a.json()),l.ok&&I(await l.json()),t.ok&&O(await t.json()),n.ok&&U(await n.json()),i.ok&&_(await i.json()),r.ok){let e=await r.json();e?(q(e),Y(e.name||""),ee(e.email||""),ea(e.phone||""),Q((e.contacts||[]).map(e=>({id:e.id,type:e.type,label:e.label||"",value:e.value||"",isPrimary:e.isPrimary,markedForDeletion:!1,isNew:!1})))):(q(null),Y(""),ee(""),ea(""),Q([]))}}catch(e){console.error("Error:",e),eo("Failed to load unit details")}finally{ed(!1),et(!1)}},eA=async()=>{if(S){eb(!0);try{let e=await fetch(`/api/operational-units/${S.id}`,{method:"PATCH",headers:{"Content-Type":"application/json"},body:JSON.stringify({monthlyManagementFee:ep,monthlyBillingDay:eN})});e.ok?(await e.json(),P({...S,monthlyManagementFee:ep,monthlyBillingDay:eN}),ej(!1),alert("تم تحديث بيانات الفوترة الشهرية بنجاح")):alert("فشل تحديث بيانات الفوترة")}catch(e){console.error("Error:",e),alert("حدث خطأ أثناء التحديث")}finally{eb(!1)}}},eI=async()=>{if(S){if(!eT.trim())return void alert("الرجاء إدخال اسم الوحدة");ew(!0);try{(await fetch(`/api/operational-units/${S.id}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:eT.trim()})})).ok?(P({...S,name:eT.trim()}),G?.unit&&K({...G,unit:{...G.unit,name:eT.trim()}}),ey(!1),alert("تم تحديث اسم الوحدة بنجاح")):alert("فشل تحديث اسم الوحدة")}catch(e){console.error("Error:",e),alert("حدث خطأ أثناء التحديث")}finally{ew(!1)}}},eM=async()=>{if(!eH.name.trim())return void alert("الرجاء إدخال اسم الساكن");eD(!0);try{let e=await fetch("/api/residents",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({...eH,unitId:B})});if(e.ok){let s=await e.json();$([...L,s]),eB({name:"",email:"",phone:"",address:""}),eE(!1),alert("تم إضافة الساكن بنجاح"),e$()}else{let s=await e.json();alert(s.error||"فشل إضافة الساكن")}}catch(e){console.error("Error:",e),alert("حدث خطأ أثناء إضافة الساكن")}finally{eD(!1)}},eO=e=>{Q(s=>{let a=!s.some(s=>s.type===e&&!s.markedForDeletion&&s.isPrimary);return[...s,{id:void 0,type:e,label:"",value:"",isPrimary:a,markedForDeletion:!1,isNew:!0}]})},eR=(e,s,a)=>{Q(l=>{let t=[...l],n=t[e];if(!n||n.markedForDeletion)return l;if("type"===s&&("PHONE"===a||"EMAIL"===a)){let s=n.isPrimary;n.type=a,s&&t.some((s,l)=>l!==e&&s.type===a&&!s.markedForDeletion&&s.isPrimary)&&(n.isPrimary=!1)}else"label"===s?n.label=a:"value"===s&&(n.value=a);return t[e]={...n},t})},eU=async()=>{if(!X.trim())return void alert("الرجاء إدخال اسم جهة المالك");ei(!0);try{let e=W.filter(e=>e.markedForDeletion||e.value.trim()).map(e=>({id:e.id,type:e.type,value:e.value.trim(),label:e.label?.trim()||null,isPrimary:e.isPrimary,_delete:!!e.markedForDeletion})),s=await fetch(`/api/operational-units/${B}/owner`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:X.trim(),email:Z.trim()?Z.trim():null,phone:es.trim()?es.trim():null,contacts:e})});if(!s.ok){let e=await s.json().catch(()=>null);alert(e?.error||"فشل حفظ بيانات جهة المالك");return}let a=await s.json();q(a),Y(a?.name||""),ee(a?.email||""),ea(a?.phone||""),Q((a?.contacts||[]).map(e=>({id:e.id,type:e.type,label:e.label||"",value:e.value||"",isPrimary:e.isPrimary,markedForDeletion:!1,isNew:!1}))),alert("تم حفظ بيانات جهة المالك")}catch(e){console.error("Error saving owner association:",e),alert("حدث خطأ أثناء حفظ بيانات جهة المالك")}finally{ei(!1)}},eJ=async()=>{if(V&&window.confirm("هل أنت متأكد من حذف جهة المالك لهذا الوحدة؟")){ei(!0);try{let e=await fetch(`/api/operational-units/${B}/owner`,{method:"DELETE"});if(!e.ok){let s=await e.json().catch(()=>null);alert(s?.error||"فشل حذف جهة المالك");return}q(null),Y(""),ee(""),ea(""),Q([]),alert("تم حذف جهة المالك بنجاح")}catch(e){console.error("Error deleting owner association:",e),alert("حدث خطأ أثناء حذف جهة المالك")}finally{ei(!1)}}};return er?(0,s.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,s.jsx)(i.Loader,{className:"h-8 w-8 animate-spin"})}):ec||!S?(0,s.jsx)("div",{className:"space-y-6",children:(0,s.jsxs)(C.Alert,{variant:"destructive",children:[(0,s.jsx)(n.AlertCircle,{className:"h-4 w-4"}),(0,s.jsx)(C.AlertDescription,{children:ec||"Unit not found"})]})}):(0,s.jsxs)("div",{className:"space-y-6",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{className:"text-4xl font-bold",children:S.name}),(0,s.jsxs)("div",{className:"flex items-center gap-3 mt-2 text-muted-foreground",children:[(0,s.jsx)(h.MapPin,{className:"h-4 w-4"}),(0,s.jsx)("span",{children:S.project.name}),(0,s.jsx)("span",{children:"•"}),(0,s.jsx)("span",{className:"text-sm",children:S.code})]})]}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[eL&&(0,s.jsxs)(T.Button,{variant:"outline",onClick:()=>ey(!0),className:"gap-2",children:[(0,s.jsx)(c,{className:"h-4 w-4"}),"تعديل اسم الوحدة"]}),(0,s.jsx)(w.Badge,{variant:S.isActive?"default":"secondary",children:S.isActive?"Active":"Inactive"})]})]}),(eL||eP)&&(0,s.jsxs)(f.Card,{className:"bg-gradient-to-br from-blue-500/10 to-purple-500/10 border-blue-500/20",children:[(0,s.jsx)(f.CardHeader,{children:(0,s.jsxs)(f.CardTitle,{className:"flex items-center justify-between",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2 text-blue-400",children:[(0,s.jsx)(j.Calendar,{className:"h-5 w-5"}),"الفوترة الشهرية"]}),(0,s.jsxs)(T.Button,{size:"sm",onClick:()=>ej(!0),className:"bg-blue-600 hover:bg-blue-700",children:[(0,s.jsx)(c,{className:"h-4 w-4 mr-2"}),"تعديل"]})]})}),(0,s.jsxs)(f.CardContent,{children:[(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-6",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)(E.Label,{className:"text-sm text-zinc-400 mb-2 block",children:"المطالبة الشهرية"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(o.DollarSign,{className:"h-5 w-5 text-emerald-400"}),(0,s.jsxs)("span",{className:"text-2xl font-bold text-emerald-400",children:[(S.monthlyManagementFee||0).toLocaleString("ar-EG")," EGP"]})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)(E.Label,{className:"text-sm text-zinc-400 mb-2 block",children:"يوم التحصيل الشهري"}),(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(j.Calendar,{className:"h-5 w-5 text-blue-400"}),(0,s.jsxs)("span",{className:"text-2xl font-bold text-blue-400",children:["اليوم ",S.monthlyBillingDay||1]})]})]})]}),(!S.monthlyManagementFee||0===S.monthlyManagementFee)&&(0,s.jsxs)(C.Alert,{className:"mt-4 bg-yellow-500/10 border-yellow-500/20",children:[(0,s.jsx)(n.AlertCircle,{className:"h-4 w-4 text-yellow-500"}),(0,s.jsx)(C.AlertDescription,{className:"text-yellow-500",children:"لم يتم تحديد رسوم شهرية لهذه الوحدة. لن يتم إنشاء فواتير تلقائية."})]})]})]}),G&&(0,s.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[(0,s.jsxs)(f.Card,{children:[(0,s.jsx)(f.CardHeader,{className:"pb-2",children:(0,s.jsxs)(f.CardTitle,{className:"text-sm text-muted-foreground flex items-center gap-2",children:[(0,s.jsx)(x.Users,{className:"h-4 w-4"}),"السكان"]})}),(0,s.jsx)(f.CardContent,{children:(0,s.jsx)("div",{className:"text-3xl font-bold",children:G.residents.total})})]}),(0,s.jsxs)(f.Card,{children:[(0,s.jsx)(f.CardHeader,{className:"pb-2",children:(0,s.jsxs)(f.CardTitle,{className:"text-sm text-muted-foreground flex items-center gap-2",children:[(0,s.jsx)(n.AlertCircle,{className:"h-4 w-4"}),"التذاكر المفتوحة"]})}),(0,s.jsx)(f.CardContent,{children:(0,s.jsx)("div",{className:"text-3xl font-bold text-red-600",children:G.tickets.new+G.tickets.inProgress})})]}),(0,s.jsxs)(f.Card,{className:"cursor-pointer hover:bg-muted/30 transition-colors",onClick:()=>em("expenses"),onKeyDown:e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),em("expenses"))},tabIndex:0,role:"button","aria-label":"عرض المصروفات المعلقة",children:[(0,s.jsx)(f.CardHeader,{className:"pb-2",children:(0,s.jsxs)(f.CardTitle,{className:"text-sm text-muted-foreground flex items-center gap-2",children:[(0,s.jsx)(m.FileText,{className:"h-4 w-4"}),"المصروفات المعلقة"]})}),(0,s.jsx)(f.CardContent,{children:(0,s.jsx)("div",{className:"text-3xl font-bold text-yellow-600",children:G.expenseNotes.pending})})]}),(0,s.jsxs)(f.Card,{children:[(0,s.jsx)(f.CardHeader,{className:"pb-2",children:(0,s.jsxs)(f.CardTitle,{className:"text-sm text-muted-foreground flex items-center gap-2",children:[(0,s.jsx)(o.DollarSign,{className:"h-4 w-4"}),"إجمالي المصروفات"]})}),(0,s.jsx)(f.CardContent,{children:(0,s.jsxs)("div",{className:"text-3xl font-bold",children:["$",G.expenseNotes.totalAmount.toFixed(2)]})})]})]}),(0,s.jsxs)(y.Tabs,{value:ex,onValueChange:em,className:"w-full",children:[(0,s.jsxs)(y.TabsList,{className:"grid w-full grid-cols-8",children:[(0,s.jsx)(y.TabsTrigger,{value:"overview",children:"نظرة عامة"}),(0,s.jsx)(y.TabsTrigger,{value:"residents",children:"السكان"}),(0,s.jsx)(y.TabsTrigger,{value:"tickets",children:"التذاكر"}),(0,s.jsx)(y.TabsTrigger,{value:"technician",children:"أعمال الفنيين"}),(0,s.jsx)(y.TabsTrigger,{value:"expenses",children:"المصروفات"}),(eP||eL)&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(y.TabsTrigger,{value:"owner",children:"جهة المالك"}),(0,s.jsx)(y.TabsTrigger,{value:"invoices",children:"الفواتير"}),(0,s.jsx)(y.TabsTrigger,{value:"payments",children:"المدفوعات"})]})]}),(0,s.jsx)(y.TabsContent,{value:"overview",className:"space-y-4",children:G&&(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)(f.Card,{children:[(0,s.jsx)(f.CardHeader,{children:(0,s.jsx)(f.CardTitle,{children:"ملخص العمليات"})}),(0,s.jsxs)(f.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center pb-2 border-b",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"إجمالي السكان"}),(0,s.jsx)("span",{className:"text-2xl font-bold",children:G.residents.total})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center pb-2 border-b",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"التذاكر"}),(0,s.jsx)("span",{className:"text-2xl font-bold",children:G.tickets.total})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center pb-2 border-b",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"سجلات أعمال الفنيين"}),(0,s.jsx)("span",{className:"text-2xl font-bold",children:G.technicianWork.total})]})]})]}),(0,s.jsxs)(f.Card,{children:[(0,s.jsx)(f.CardHeader,{children:(0,s.jsx)(f.CardTitle,{children:"الملخص المالي"})}),(0,s.jsxs)(f.CardContent,{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center pb-2 border-b",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"إجمالي المصروفات"}),(0,s.jsxs)("span",{className:"text-2xl font-bold text-yellow-600",children:["$",G.expenseNotes.totalAmount.toFixed(2)]})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center pb-2 border-b",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"الفواتير"}),(0,s.jsx)("span",{className:"text-2xl font-bold",children:G.invoices.total})]}),(0,s.jsxs)("div",{className:"flex justify-between items-center pb-2 border-b",children:[(0,s.jsx)("span",{className:"text-muted-foreground",children:"المصروفات المعلقة"}),(0,s.jsx)("span",{className:"text-2xl font-bold text-red-600",children:G.expenseNotes.pending})]})]})]})]})}),(0,s.jsxs)(y.TabsContent,{value:"residents",className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"السكان"}),eS&&(0,s.jsxs)(T.Button,{onClick:()=>eE(!0),className:"gap-2 bg-emerald-600 hover:bg-emerald-700",size:"sm",children:[(0,s.jsx)(r.Plus,{className:"h-4 w-4"}),"إضافة ساكن"]})]}),(0,s.jsx)(f.Card,{children:(0,s.jsx)(f.CardContent,{className:"pt-6",children:0===L.length?(0,s.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"لا يوجد سكان في هذه الوحدة"}):(0,s.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,s.jsxs)(k.Table,{children:[(0,s.jsx)(k.TableHeader,{children:(0,s.jsxs)(k.TableRow,{children:[(0,s.jsx)(k.TableHead,{children:"الاسم"}),(0,s.jsx)(k.TableHead,{children:"البريد الإلكتروني"}),(0,s.jsx)(k.TableHead,{children:"رقم الهاتف"}),(0,s.jsx)(k.TableHead,{children:"العنوان"}),eS&&(0,s.jsx)(k.TableHead,{children:"الإجراءات"})]})}),(0,s.jsx)(k.TableBody,{children:L.map(e=>(0,s.jsxs)(k.TableRow,{children:[(0,s.jsx)(k.TableCell,{className:"font-medium",children:e.name}),(0,s.jsx)(k.TableCell,{children:e.email||"-"}),(0,s.jsx)(k.TableCell,{children:e.phone||"-"}),(0,s.jsx)(k.TableCell,{className:"max-w-[200px] truncate",children:e.address||"-"}),eS&&(0,s.jsx)(k.TableCell,{children:(0,s.jsx)(T.Button,{variant:"ghost",size:"sm",onClick:()=>d.push(`/dashboard/residents/${e.id}/edit`),children:(0,s.jsx)(c,{className:"h-4 w-4"})})})]},e.id))})]})})})})]}),(0,s.jsxs)(y.TabsContent,{value:"tickets",className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"التذاكر"}),eS&&(0,s.jsxs)(T.Button,{onClick:()=>d.push(`/dashboard/tickets/new?unitId=${B}`),className:"gap-2",size:"sm",children:[(0,s.jsx)(r.Plus,{className:"h-4 w-4"}),"إضافة تذكرة"]})]}),(0,s.jsx)(f.Card,{children:(0,s.jsx)(f.CardContent,{className:"pt-6",children:0===A.length?(0,s.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد تذاكر في هذه الوحدة"}):(0,s.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,s.jsxs)(k.Table,{children:[(0,s.jsx)(k.TableHeader,{children:(0,s.jsxs)(k.TableRow,{children:[(0,s.jsx)(k.TableHead,{children:"العنوان"}),(0,s.jsx)(k.TableHead,{children:"الساكن"}),(0,s.jsx)(k.TableHead,{children:"الحالة"}),(0,s.jsx)(k.TableHead,{children:"الأولوية"}),(0,s.jsx)(k.TableHead,{children:"مُسند إلى"}),(0,s.jsx)(k.TableHead,{children:"تاريخ الإنشاء"}),eS&&(0,s.jsx)(k.TableHead,{children:"الإجراءات"})]})}),(0,s.jsx)(k.TableBody,{children:A.map(e=>(0,s.jsxs)(k.TableRow,{children:[(0,s.jsx)(k.TableCell,{className:"font-medium",children:e.title}),(0,s.jsx)(k.TableCell,{children:e.resident.name}),(0,s.jsx)(k.TableCell,{children:(0,s.jsx)(w.Badge,{variant:"done"===e.status?"default":"secondary",children:e.status})}),(0,s.jsx)(k.TableCell,{children:(0,s.jsx)(w.Badge,{variant:"high"===e.priority?"destructive":"outline",children:e.priority})}),(0,s.jsx)(k.TableCell,{children:e.assignedTo?.name||"-"}),(0,s.jsx)(k.TableCell,{children:new Date(e.createdAt).toLocaleDateString()}),eS&&(0,s.jsx)(k.TableCell,{children:(0,s.jsx)(T.Button,{variant:"ghost",size:"sm",onClick:()=>d.push(`/dashboard/tickets/${e.id}/edit`),children:(0,s.jsx)(c,{className:"h-4 w-4"})})})]},e.id))})]})})})})]}),(0,s.jsxs)(y.TabsContent,{value:"technician",className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"أعمال الفنيين"}),eS&&(0,s.jsxs)(T.Button,{onClick:()=>d.push(`/dashboard/technician-work?unitId=${B}`),className:"gap-2",size:"sm",children:[(0,s.jsx)(r.Plus,{className:"h-4 w-4"}),"تسجيل عمل"]})]}),M.length>0&&(0,s.jsxs)(f.Card,{children:[(0,s.jsx)(f.CardHeader,{children:(0,s.jsx)(f.CardTitle,{className:"text-base",children:"ملخص الفنيين"})}),(0,s.jsx)(f.CardContent,{children:(0,s.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,s.jsxs)(k.Table,{children:[(0,s.jsx)(k.TableHeader,{children:(0,s.jsxs)(k.TableRow,{className:"bg-muted/50",children:[(0,s.jsx)(k.TableHead,{children:"الفني"}),(0,s.jsx)(k.TableHead,{className:"text-right",children:"إجمالي المستحقات"}),(0,s.jsx)(k.TableHead,{className:"text-right",children:"المدفوع"}),(0,s.jsx)(k.TableHead,{className:"text-right",children:"المعلق"}),(0,s.jsx)(k.TableHead,{className:"text-right",children:"الإجراء"})]})}),(0,s.jsx)(k.TableBody,{children:Array.from(new Map(M.map(e=>[e.technician.name,M.filter(s=>s.technician.name===e.technician.name)])).entries()).map(([e,a])=>{let l=a.reduce((e,s)=>e+s.amount,0),t=a.filter(e=>"paid"===e.paymentStatus).reduce((e,s)=>e+s.amount,0),n=l-t;return(0,s.jsxs)(k.TableRow,{children:[(0,s.jsx)(k.TableCell,{className:"font-medium",children:e}),(0,s.jsxs)(k.TableCell,{className:"text-right font-semibold",children:["$",l.toFixed(2)]}),(0,s.jsxs)(k.TableCell,{className:"text-right text-green-600",children:["$",t.toFixed(2)]}),(0,s.jsxs)(k.TableCell,{className:`text-right font-semibold ${n>0?"text-red-600":"text-green-600"}`,children:["$",n.toFixed(2)]}),(0,s.jsx)(k.TableCell,{className:"text-right",children:n>0&&(0,s.jsxs)(T.Button,{onClick:()=>d.push(`/dashboard/payments?unit=${B}&amount=${n.toFixed(2)}`),size:"sm",className:"text-xs",variant:"outline",children:["دفع $",n.toFixed(2)]})})]},e)})})]})})})]}),(0,s.jsxs)(f.Card,{children:[(0,s.jsx)(f.CardHeader,{children:(0,s.jsxs)(f.CardTitle,{className:"text-base",children:["سجلات الأعمال (",M.length,")"]})}),(0,s.jsx)(f.CardContent,{children:0===M.length?(0,s.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد أعمال فنيين مسجلة"}):(0,s.jsx)("div",{className:"space-y-3",children:M.map(e=>(0,s.jsx)("div",{className:"border p-4 rounded-lg hover:bg-muted/50 transition-colors",children:(0,s.jsxs)("div",{className:"flex justify-between items-start",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("p",{className:"font-medium",children:e.description}),(0,s.jsx)("p",{className:"text-sm text-muted-foreground",children:e.technician.name}),(0,s.jsx)("p",{className:"text-xs text-muted-foreground mt-1",children:new Date(e.createdAt).toLocaleDateString()})]}),(0,s.jsxs)("div",{className:"text-right",children:[(0,s.jsxs)("p",{className:"text-lg font-bold",children:["$",e.amount.toFixed(2)]}),(0,s.jsx)(w.Badge,{variant:"paid"===e.paymentStatus?"default":"secondary",children:e.paymentStatus})]})]})},e.id))})})]})]}),(0,s.jsxs)(y.TabsContent,{value:"expenses",className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex justify-between items-center",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"المصروفات"}),eS&&(0,s.jsxs)(T.Button,{onClick:()=>d.push(`/dashboard/accounting-notes/new?unitId=${B}&type=expense`),className:"gap-2",size:"sm",children:[(0,s.jsx)(r.Plus,{className:"h-4 w-4"}),"إضافة مصروف"]})]}),(0,s.jsx)(f.Card,{children:(0,s.jsx)(f.CardContent,{className:"pt-6",children:0===R.length?(0,s.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد مصروفات مسجلة"}):(0,s.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,s.jsxs)(k.Table,{children:[(0,s.jsx)(k.TableHeader,{children:(0,s.jsxs)(k.TableRow,{children:[(0,s.jsx)(k.TableHead,{children:"الوصف"}),(0,s.jsx)(k.TableHead,{children:"المبلغ"}),(0,s.jsx)(k.TableHead,{children:"الحالة"}),(0,s.jsx)(k.TableHead,{children:"التاريخ"})]})}),(0,s.jsx)(k.TableBody,{children:R.map(e=>(0,s.jsxs)(k.TableRow,{children:[(0,s.jsx)(k.TableCell,{className:"font-medium",children:e.description}),(0,s.jsxs)(k.TableCell,{children:["$",e.amount.toFixed(2)]}),(0,s.jsx)(k.TableCell,{children:(0,s.jsx)(w.Badge,{variant:e.isClaimed?"default":"secondary",children:e.isClaimed?"مطالب بها":"غير مطالب بها"})}),(0,s.jsx)(k.TableCell,{children:new Date(e.date).toLocaleDateString()})]},e.id))})]})})})})]}),(eP||eL)&&(0,s.jsxs)(y.TabsContent,{value:"owner",className:"space-y-4",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between",children:[(0,s.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,s.jsx)(b.Building2,{className:"h-5 w-5 text-muted-foreground"}),"بيانات جهة المالك"]}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[V&&eL&&(0,s.jsxs)(T.Button,{variant:"destructive",size:"sm",onClick:eJ,disabled:en||el,className:"gap-2",children:[(0,s.jsx)(N.Trash2,{className:"h-4 w-4"}),"حذف الجهة"]}),(0,s.jsxs)(T.Button,{onClick:eU,disabled:en||el,className:"gap-2",size:"sm",children:[en?(0,s.jsx)(i.Loader,{className:"h-4 w-4 animate-spin"}):(0,s.jsx)(v,{className:"h-4 w-4"}),"حفظ البيانات"]})]})]}),!V&&!el&&(0,s.jsxs)(C.Alert,{children:[(0,s.jsx)(n.AlertCircle,{className:"h-4 w-4"}),(0,s.jsx)(C.AlertDescription,{children:"لم يتم تسجيل جهة المالك لهذه الوحدة بعد. يرجى إدخال البيانات وحفظها."})]}),(0,s.jsx)(f.Card,{children:(0,s.jsx)(f.CardContent,{className:"pt-6 space-y-6",children:el&&!V&&0===W.length?(0,s.jsxs)("div",{className:"flex items-center justify-center py-8 text-muted-foreground",children:[(0,s.jsx)(i.Loader,{className:"h-5 w-5 animate-spin"}),(0,s.jsx)("span",{className:"ml-2",children:"جاري تحميل بيانات جهة المالك..."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"grid gap-4 md:grid-cols-3",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(E.Label,{children:"اسم الجهة"}),(0,s.jsx)(z.Input,{value:X,onChange:e=>Y(e.target.value),placeholder:"مثال: اتحاد ملاك البرج",disabled:en||el})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(E.Label,{children:"البريد الرئيسي"}),(0,s.jsx)(z.Input,{type:"email",value:Z,onChange:e=>ee(e.target.value),placeholder:"owner@example.com",disabled:en||el})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(E.Label,{children:"الهاتف الرئيسي"}),(0,s.jsx)(z.Input,{value:es,onChange:e=>ea(e.target.value),placeholder:"01000000000",disabled:en||el})]})]}),(0,s.jsxs)("div",{className:"space-y-3",children:[(0,s.jsxs)("div",{className:"flex flex-col gap-2 md:flex-row md:items-center md:justify-between",children:[(0,s.jsx)("h4",{className:"font-semibold",children:"وسائل التواصل الإضافية"}),(0,s.jsxs)("div",{className:"flex flex-wrap items-center gap-2",children:[(0,s.jsxs)(T.Button,{type:"button",size:"sm",variant:"outline",onClick:()=>eO("PHONE"),disabled:en||el,className:"gap-2",children:[(0,s.jsx)(p.Phone,{className:"h-4 w-4"}),"إضافة رقم"]}),(0,s.jsxs)(T.Button,{type:"button",size:"sm",variant:"outline",onClick:()=>eO("EMAIL"),disabled:en||el,className:"gap-2",children:[(0,s.jsx)(g.Mail,{className:"h-4 w-4"}),"إضافة بريد"]})]})]}),0===W.filter(e=>!e.markedForDeletion).length?(0,s.jsx)("p",{className:"text-sm text-muted-foreground border rounded-lg p-4",children:"لا توجد وسائل تواصل إضافية. استخدم الأزرار أعلاه لإضافة أرقام أو بريد إلكتروني."}):(0,s.jsx)("div",{className:"space-y-3",children:W.map((e,a)=>e.markedForDeletion?null:(0,s.jsxs)("div",{className:"grid gap-3 md:grid-cols-[150px_1fr_1fr_auto] items-end border rounded-lg p-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(E.Label,{children:"النوع"}),(0,s.jsxs)("select",{className:"w-full rounded-md border border-input bg-background px-3 py-2 text-sm",value:e.type,onChange:e=>eR(a,"type",e.target.value),disabled:en||el,children:[(0,s.jsx)("option",{value:"PHONE",children:"رقم هاتف"}),(0,s.jsx)("option",{value:"EMAIL",children:"بريد إلكتروني"})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(E.Label,{children:"الوصف"}),(0,s.jsx)(z.Input,{value:e.label||"",onChange:e=>eR(a,"label",e.target.value),placeholder:"مثال: رئيس الاتحاد",disabled:en||el})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(E.Label,{children:"القيمة"}),(0,s.jsx)(z.Input,{value:e.value,onChange:e=>eR(a,"value",e.target.value),placeholder:"PHONE"===e.type?"01000000000":"owner@example.com",disabled:en||el})]}),(0,s.jsxs)("div",{className:"flex flex-col gap-2 md:items-end",children:[(0,s.jsx)(T.Button,{type:"button",size:"sm",variant:e.isPrimary?"secondary":"outline",onClick:()=>{Q(e=>{let s=e[a];return!s||s.markedForDeletion?e:e.map((e,l)=>e.markedForDeletion||e.type!==s.type?e:{...e,isPrimary:l===a})})},disabled:en||el,className:"w-full md:w-auto",children:e.isPrimary?"الرئيسي":"تعيين كرئيسي"}),(0,s.jsxs)(T.Button,{type:"button",size:"sm",variant:"ghost",onClick:()=>{Q(e=>{let s=e[a];if(!s)return e;if(!s.id)return e.filter((e,s)=>s!==a);let l=[...e];return l[a]={...s,markedForDeletion:!0,isPrimary:!1},l})},disabled:en||el,className:"gap-2 text-red-600 hover:text-red-600",children:[(0,s.jsx)(N.Trash2,{className:"h-4 w-4"}),"حذف"]})]})]},e.id??`new-contact-${a}`))})]})]})})})]}),(eP||eL)&&(0,s.jsxs)(y.TabsContent,{value:"invoices",className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"الفواتير"}),(0,s.jsx)(f.Card,{children:(0,s.jsx)(f.CardContent,{className:"pt-6",children:0===J.length?(0,s.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"لا توجد فواتير"}):(0,s.jsx)("div",{className:"border rounded-lg overflow-hidden",children:(0,s.jsxs)(k.Table,{children:[(0,s.jsx)(k.TableHeader,{children:(0,s.jsxs)(k.TableRow,{children:[(0,s.jsx)(k.TableHead,{children:"رقم الفاتورة"}),(0,s.jsx)(k.TableHead,{children:"النوع"}),(0,s.jsx)(k.TableHead,{children:"المالك"}),(0,s.jsx)(k.TableHead,{children:"المبلغ"}),(0,s.jsx)(k.TableHead,{children:"المدفوع"}),(0,s.jsx)(k.TableHead,{children:"الحالة"}),(0,s.jsx)(k.TableHead,{children:"التاريخ"})]})}),(0,s.jsx)(k.TableBody,{children:J.map(e=>(0,s.jsxs)(k.TableRow,{children:[(0,s.jsx)(k.TableCell,{className:"font-medium",children:e.invoiceNumber}),(0,s.jsx)(k.TableCell,{children:e.type}),(0,s.jsx)(k.TableCell,{children:e.ownerAssociation?.name||"-"}),(0,s.jsxs)(k.TableCell,{children:["$",e.amount.toFixed(2)]}),(0,s.jsx)(k.TableCell,{children:"-"}),(0,s.jsx)(k.TableCell,{children:(0,s.jsx)(w.Badge,{variant:e.isPaid?"default":"secondary",children:e.isPaid?"مدفوعة":"غير مدفوعة"})}),(0,s.jsx)(k.TableCell,{children:new Date(e.issuedAt).toLocaleDateString()})]},e.id))})]})})})})]}),(eP||eL)&&(0,s.jsxs)(y.TabsContent,{value:"payments",className:"space-y-4",children:[(0,s.jsx)("h3",{className:"text-lg font-semibold",children:"المدفوعات"}),(0,s.jsx)(f.Card,{children:(0,s.jsx)(f.CardContent,{className:"pt-6",children:(0,s.jsx)("p",{className:"text-muted-foreground text-center py-8",children:"سجل المدفوعات"})})})]})]}),(0,s.jsxs)(f.Card,{children:[(0,s.jsx)(f.CardHeader,{children:(0,s.jsx)(f.CardTitle,{className:"text-base",children:"التنقل السريع"})}),(0,s.jsx)(f.CardContent,{children:(0,s.jsxs)("div",{className:"flex flex-wrap gap-2",children:[(0,s.jsx)("button",{onClick:()=>d.push(`/dashboard/payments?unit=${B}`),className:"text-sm px-3 py-2 bg-[#F3F4F6] hover:bg-[#E5E7EB] text-[#111827] border border-[#E5E7EB] rounded-md font-medium transition-colors",children:"عرض مدفوعات الوحدة"}),(0,s.jsx)("button",{onClick:()=>d.push(`/dashboard/invoices?unit=${B}`),className:"text-sm px-3 py-2 bg-[#F3F4F6] hover:bg-[#E5E7EB] text-[#111827] border border-[#E5E7EB] rounded-md font-medium transition-colors",children:"عرض فواتير الوحدة"}),(eS||eL)&&(0,s.jsx)("button",{onClick:()=>d.push(`/dashboard/residents/new?unitId=${B}`),className:"text-sm px-3 py-2 bg-[#F3F4F6] hover:bg-[#E5E7EB] text-[#111827] border border-[#E5E7EB] rounded-md font-medium transition-colors",children:"إضافة ساكن"}),(0,s.jsx)("button",{onClick:()=>d.push("/dashboard/technicians"),className:"text-sm px-3 py-2 bg-[#F3F4F6] hover:bg-[#E5E7EB] text-[#111827] border border-[#E5E7EB] rounded-md font-medium transition-colors",children:"عرض الفنيين"}),(0,s.jsx)("button",{onClick:()=>d.push("/dashboard/operational-units"),className:"text-sm px-3 py-2 bg-[#F3F4F6] hover:bg-[#E5E7EB] text-[#111827] border border-[#E5E7EB] rounded-md font-medium transition-colors",children:"العودة للوحدات"})]})})]}),(0,s.jsx)(F.Dialog,{open:eh,onOpenChange:ej,children:(0,s.jsxs)(F.DialogContent,{className:"bg-zinc-900 border-zinc-800",children:[(0,s.jsxs)(F.DialogHeader,{children:[(0,s.jsx)(F.DialogTitle,{className:"text-xl text-blue-400",children:"تعديل بيانات الفوترة الشهرية"}),(0,s.jsx)(F.DialogDescription,{className:"text-zinc-400",children:"قم بتحديث المطالبة الشهرية ويوم التحصيل لهذه الوحدة"})]}),(0,s.jsxs)("div",{className:"space-y-6 py-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(E.Label,{className:"text-sm text-zinc-300",children:"المطالبة الشهرية (EGP)"}),(0,s.jsx)(z.Input,{type:"number",min:"0",step:"0.01",value:ep,onChange:e=>eg(parseFloat(e.target.value)||0),className:"bg-zinc-800 border-zinc-700 text-white",placeholder:"0.00"}),(0,s.jsx)("p",{className:"text-xs text-zinc-500",children:"أدخل 0 لإيقاف الفوترة التلقائية لهذه الوحدة"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(E.Label,{className:"text-sm text-zinc-300",children:"يوم التحصيل الشهري (1-31)"}),(0,s.jsx)(z.Input,{type:"number",min:"1",max:"31",value:eN,onChange:e=>{ev(Math.min(31,Math.max(1,parseInt(e.target.value)||1)))},className:"bg-zinc-800 border-zinc-700 text-white",placeholder:"1"}),(0,s.jsx)("p",{className:"text-xs text-zinc-500",children:"اليوم من الشهر الذي سيتم فيه توليد الفاتورة تلقائيًا"})]})]}),(0,s.jsxs)(F.DialogFooter,{children:[(0,s.jsx)(T.Button,{variant:"outline",onClick:()=>ej(!1),className:"border-zinc-700 text-zinc-300 hover:bg-zinc-800",disabled:eu,children:"إلغاء"}),(0,s.jsx)(T.Button,{onClick:eA,className:"bg-blue-600 hover:bg-blue-700",disabled:eu,children:eu?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Loader,{className:"h-4 w-4 mr-2 animate-spin"}),"جاري الحفظ..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.CheckCircle2,{className:"h-4 w-4 mr-2"}),"حفظ التغييرات"]})})]})]})}),(0,s.jsx)(F.Dialog,{open:ef,onOpenChange:ey,children:(0,s.jsxs)(F.DialogContent,{className:"bg-zinc-900 border-zinc-800",children:[(0,s.jsxs)(F.DialogHeader,{children:[(0,s.jsx)(F.DialogTitle,{className:"text-white",children:"تعديل اسم الوحدة"}),(0,s.jsx)(F.DialogDescription,{className:"text-zinc-400",children:"عدل اسم الوحدة الحالية."})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(E.Label,{className:"text-sm text-zinc-300",children:"اسم الوحدة"}),(0,s.jsx)(z.Input,{value:eT,onChange:e=>ek(e.target.value),className:"bg-zinc-800 border-zinc-700 text-white",placeholder:"اسم الوحدة"})]}),(0,s.jsxs)(F.DialogFooter,{children:[(0,s.jsx)(T.Button,{variant:"outline",onClick:()=>ey(!1),className:"border-zinc-700 text-zinc-300 hover:bg-zinc-800",disabled:eC,children:"إلغاء"}),(0,s.jsx)(T.Button,{onClick:eI,className:"bg-blue-600 hover:bg-blue-700",disabled:eC||!eT.trim(),children:eC?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Loader,{className:"h-4 w-4 mr-2 animate-spin"}),"جاري الحفظ..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(u.CheckCircle2,{className:"h-4 w-4 mr-2"}),"حفظ التغييرات"]})})]})]})}),(0,s.jsx)(F.Dialog,{open:ez,onOpenChange:eE,children:(0,s.jsxs)(F.DialogContent,{className:"bg-zinc-900 border-zinc-800",children:[(0,s.jsxs)(F.DialogHeader,{children:[(0,s.jsx)(F.DialogTitle,{className:"text-white",children:"إضافة ساكن جديد"}),(0,s.jsxs)(F.DialogDescription,{className:"text-zinc-400",children:["أضف ساكن جديد لوحدة ",S?.name]})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(E.Label,{className:"text-sm text-zinc-300",children:"الاسم *"}),(0,s.jsx)(z.Input,{value:eH.name,onChange:e=>eB({...eH,name:e.target.value}),className:"bg-zinc-800 border-zinc-700 text-white",placeholder:"اسم الساكن"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(E.Label,{className:"text-sm text-zinc-300",children:"البريد الإلكتروني"}),(0,s.jsx)(z.Input,{type:"email",value:eH.email,onChange:e=>eB({...eH,email:e.target.value}),className:"bg-zinc-800 border-zinc-700 text-white",placeholder:"example@email.com"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(E.Label,{className:"text-sm text-zinc-300",children:"رقم الهاتف"}),(0,s.jsx)(z.Input,{type:"tel",value:eH.phone,onChange:e=>eB({...eH,phone:e.target.value}),className:"bg-zinc-800 border-zinc-700 text-white",placeholder:"+20 123 456 7890"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(E.Label,{className:"text-sm text-zinc-300",children:"العنوان"}),(0,s.jsx)(z.Input,{value:eH.address,onChange:e=>eB({...eH,address:e.target.value}),className:"bg-zinc-800 border-zinc-700 text-white",placeholder:"العنوان الكامل"})]})]}),(0,s.jsxs)(F.DialogFooter,{children:[(0,s.jsx)(T.Button,{variant:"outline",onClick:()=>{eE(!1),eB({name:"",email:"",phone:"",address:""})},className:"border-zinc-700 text-zinc-300 hover:bg-zinc-800",disabled:eF,children:"إلغاء"}),(0,s.jsx)(T.Button,{onClick:eM,className:"bg-emerald-600 hover:bg-emerald-700",disabled:eF||!eH.name.trim(),children:eF?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(i.Loader,{className:"h-4 w-4 mr-2 animate-spin"}),"جاري الإضافة..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.Plus,{className:"h-4 w-4 mr-2"}),"إضافة الساكن"]})})]})]})})]})}e.s(["default",()=>D],25029)}]);