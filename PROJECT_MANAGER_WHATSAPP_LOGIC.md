# ูุฏูุฑ ุงููุดุฑูุน ุนูู ูุงุชุณุงุจ - ุฏููู ุงูุนูููุงุช ุงููุงูู

> **ุงูุบุฑุถ:** ุชูุซูู ุดุงูู ูุฌููุน ุงูุนูููุงุช ุงูุชู ูููู ููุฏูุฑ ุงููุดุฑูุน ุชูููุฐูุง ุนุจุฑ ูุงุชุณุงุจ (ุนูููุงุช ูุญุฏูุฏุฉ ุญุณุจ ุงููุดุฑูุน ุงููุนูู)

---

## ๐ ุฌุฏูู ุงููุญุชููุงุช

1. [ุชุณุฌูู ุงููุตุฑููุงุช](#ุชุณุฌูู-ุงููุตุฑููุงุช)
2. [ุงูุงุณุชุนูุงูุงุช ูุงูุจุญุซ](#ุงูุงุณุชุนูุงูุงุช-ูุงูุจุญุซ)
3. [ูุนูููุงุช ุฅุถุงููุฉ](#ูุนูููุงุช-ุฅุถุงููุฉ)
4. [ุงุณุชุฎุฏุงู DSL Filter](#ุงุณุชุฎุฏุงู-dsl-filter)
5. [Prompt ููู Agent](#prompt-ููู-agent)

---

## ุชุณุฌูู ุงููุตุฑููุงุช

### CREATE_OPERATIONAL_EXPENSE - ุชุณุฌูู ูุตุฑููุฉ

**ุงููุตู:** ุชุณุฌูู ูุตุฑููุฉ ููุฏูุฉ ูููุดุฑูุน. ูุชู ุฅูุดุงุคูุง ูู "ูุฐูุฑุฉ ูุญุงุณุจูุฉ" ุจุงูุชุธุงุฑ ูุฑุงุฌุนุฉ ุงููุญุงุณุจ.

**โ๏ธ ููู ุฌุฏุงู:** ูุฐู ุงูุนูููุฉ ุชููุดุฆ ูุฐูุฑุฉ ูุญุงุณุจูุฉ (Accounting Note) ูููุณ ูุตุฑููุฉ ูุจุงุดุฑุฉ. ุงููุญุงุณุจ ูุฑุงุฌุนูุง ููุนุชูุฏูุง ูุงุญูุงู.

**ุงููุชุทูุจุงุช (ูููุง ุฅุฌุจุงุฑูุฉ):**
- `projectId` (ุฅุฌุจุงุฑู) - ุฑูู ุงููุดุฑูุน (ูู ุจูุงูุงุช ุงููุฏูุฑ)
- `unitCode` (ุฅุฌุจุงุฑู) - ููุฏ ุงููุญุฏุฉ (ูุซู GH-B09)
- `description` (ุฅุฌุจุงุฑู) - ูุตู ูุงุถุญ ูููุตุฑููุฉ
- `amount` (ุฅุฌุจุงุฑู) - ุงููุจูุบ (ุฑูู ููุฌุจ)
- `sourceType` (ุฅุฌุจุงุฑู) - **ูุตุฏุฑ ุงููุงู ููุท ูููุชุงู:**
  - `OFFICE_FUND` - ูู ุฎุฒูุฉ ุงูููุชุจ
  - `PM_ADVANCE` - ูู ุนูุฏุฉ/ููุฏู ุงููุฏูุฑ ุงูุดุฎุตู

**ุงูุงุฎุชูุงุฑูุฉ:**
- `pmAdvanceId` - (ุฅุฌุจุงุฑู ุฅุฐุง sourceType = PM_ADVANCE) - ุฑูู ุงูุนูุฏุฉ
- `recordedAt` - ุชุงุฑูุฎ ุงููุตุฑููุฉ (ISO 8601ุ ูุซู 2026-02-19T14:30:00Z)

**ููุงุญุธุฉ ูููุฉ:** ูุฏูุฑ ุงููุดุฑูุน ููุณุฌู ุงููุตุฑููุงุช ููุท ููุดุฑูุนู ุงููุนูู. ูุง ููููู ุงููุตูู ููุดุงุฑูุน ุฃุฎุฑู.

**Request Payload:**
```json
{
  "action": "CREATE_OPERATIONAL_EXPENSE",
  "senderPhone": "+201001234567",
  "payload": {
    "projectId": "cmlhyav18000fpb3owj1izhky",
    "unitCode": "GH-B09",
    "description": "ุตูุงูุฉ ุงูุฃูุงุจูุจ - ุชูุตูู ุงูููุงู",
    "amount": 1500,
    "sourceType": "OFFICE_FUND"
  }
}
```

**ูุซุงู ูุน PM_ADVANCE:**
```json
{
  "action": "CREATE_OPERATIONAL_EXPENSE",
  "senderPhone": "+201001234567",
  "payload": {
    "projectId": "cmlhyav18000fpb3owj1izhky",
    "unitCode": "GH-B09",
    "description": "ุดุฑุงุก ููุงุฏ ุจูุงุก",
    "amount": 800,
    "sourceType": "PM_ADVANCE",
    "pmAdvanceId": "advance-id-here"
  }
}
```

**Response ุงููุงุฌุญ:**
```json
{
  "success": true,
  "projectId": "cmlhyav18000fpb3owj1izhky",
  "message": "Accounting note submitted",
  "data": {
    "accountingNote": {
      "id": "note-12345",
      "description": "ุตูุงูุฉ ุงูุฃูุงุจูุจ - ุชูุตูู ุงูููุงู",
      "amount": 1500,
      "status": "PENDING",
      "sourceType": "OFFICE_FUND",
      "createdAt": "2026-02-19T14:30:00Z",
      "unit": { "code": "GH-B09", "name": "..." },
      "project": { "name": "Green Hills Compound" }
    }
  },
  "humanReadable": {
    "ar": "ุชู ุฅูุดุงุก ูุฐูุฑุฉ ูุญุงุณุจูุฉ ุจูููุฉ 1500 ุฌููู ูููุญุฏุฉ GH-B09 ุถูู ูุดุฑูุน Green Hills Compound ูู ุฎุฒูุฉ ุงูููุชุจ. ุจุงูุชุธุงุฑ ูุฑุงุฌุนุฉ ุงููุญุงุณุจ."
  }
}
```

---

## ุงูุงุณุชุนูุงูุงุช ูุงูุจุญุซ

### LIST_UNIT_EXPENSES - ูุงุฆูุฉ ูุตุฑููุงุช ุงููุญุฏุฉ

**ุงููุตู:** ุงูุญุตูู ุนูู ูุงุฆูุฉ ุงููุตุฑููุงุช ููุฐูุฑุงุช ุงููุญุงุณุจุฉ ูููุดุฑูุน (ูุฏูุฑ ุงููุดุฑูุน ูุฑู ููุท ูุดุฑูุนู)

**ุงููุชุทูุจุงุช:** ูุง ุชูุฌุฏ (ุชูุณุชุฎุฏู ุงูููู ุงูุงูุชุฑุงุถูุฉ ุนูุฏ ุนุฏู ุงูุชุญุฏูุฏ)

**ุงูุงุฎุชูุงุฑูุฉ:**
- `unitCode` - ููุฏ ุงููุญุฏุฉ (ูุซู A1, B2) - ูููุฏ ููุชุตููุฉ ุฏุงุฎู ุงููุดุฑูุน
- `sourceTypes` - ุฃููุงุน ุงููุตุฑููุงุช ุงููุฑุงุฏ ุนุฑุถูุง:
  - `["TECHNICIAN_WORK"]` - ููุท ุฃุนูุงู ูููุฉ
  - `["ELECTRICITY", "WATER"]` - ููุท ูุฑุงูู
  - `["TECHNICIAN_WORK", "STAFF_WORK", "ELECTRICITY", "OTHER"]` - ุฌููุน ุงูุฃููุงุน
- `search` - ุจุญุซ ูุตู ูู ูุตู ุงููุตุฑูู
- `fromDate` - ุชุงุฑูุฎ ุงูุจุฏุงูุฉ (YYYY-MM-DD)
- `toDate` - ุชุงุฑูุฎ ุงูููุงูุฉ (YYYY-MM-DD)
- `filterDsl` - ููุชุฑ ูุชูุฏู (ุงูุธุฑ ูุณู DSL Filter)
- `limit` - ุนุฏุฏ ุงููุชุงุฆุฌ (ุงูุชุฑุงุถู: 25ุ ุงูุญุฏ ุงูุฃูุตู: 200)

**Request Payload:**
```json
{
  "action": "LIST_UNIT_EXPENSES",
  "senderPhone": "+201001234567",
  "payload": {
    "unitCode": "A1",
    "sourceTypes": ["TECHNICIAN_WORK", "ELECTRICITY"],
    "fromDate": "2026-01-01",
    "toDate": "2026-02-19",
    "limit": 20
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "expenses": [
      {
        "id": "exp-001",
        "date": "2026-02-15",
        "description": "ุตูุงูุฉ ุงูุฃูุงุจูุจ - ุชูุตูู ุงูููุงู",
        "amount": 1500,
        "sourceType": "TECHNICIAN_WORK",
        "sourceTypeLabel": "ุฃุนูุงู ูููุฉ",
        "recordKind": "UNIT_EXPENSE",
        "status": "PENDING"
      },
      {
        "id": "exp-002",
        "date": "2026-02-10",
        "description": "ูุงุชูุฑุฉ ุงูููุฑุจุงุก ุงูุดูุฑูุฉ",
        "amount": 450,
        "sourceType": "ELECTRICITY",
        "sourceTypeLabel": "ููุฑุจุงุก",
        "recordKind": "CONVERTED_NOTE",
        "accountingNoteId": "note-xyz789",
        "status": "CONVERTED"
      }
    ]
  },
  "meta": {
    "total": 2,
    "paid": 0,
    "unpaid": 2,
    "totalAmount": 1950,
    "dateFilter": {
      "from": "2026-01-01",
      "to": "2026-02-19"
    }
  }
}
```

---

### LIST_PROJECT_UNITS - ูุงุฆูุฉ ูุญุฏุงุช ุงููุดุฑูุน

**ุงููุตู:** ุงูุญุตูู ุนูู ูุงุฆูุฉ ุฌููุน ุงููุญุฏุงุช ุงูุณูููุฉ ูู ุงููุดุฑูุน

**ุงูุงุฎุชูุงุฑูุฉ:**
- `search` - ุจุญุซ ุจุฑูู ุฃู ููุฏ ุงููุญุฏุฉ
- `limit` - ุนุฏุฏ ุงููุชุงุฆุฌ (ุงูุชุฑุงุถู: 50)

**Request Payload:**
```json
{
  "action": "LIST_PROJECT_UNITS",
  "payload": {
    "search": "A",
    "limit": 30
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "units": [
      {
        "id": "unit-001",
        "code": "A1",
        "floor": 1,
        "residentName": "ุฃุญูุฏ ูุญูุฏ",
        "residentPhone": "+201001234567",
        "totalExpenses": 5000,
        "status": "ACTIVE"
      },
      {
        "id": "unit-002",
        "code": "A2",
        "floor": 1,
        "residentName": "ูุงุทูุฉ ุนูู",
        "residentPhone": "+201009876543",
        "totalExpenses": 2500,
        "status": "ACTIVE"
      }
    ]
  },
  "meta": {
    "total": 25,
    "limit": 30
  }
}
```

---

### LIST_PROJECT_TICKETS - ูุงุฆูุฉ ุงูุชุฐุงูุฑ (ุงูุทูุจุงุช)

**ุงููุตู:** ุงูุญุตูู ุนูู ูุงุฆูุฉ ุงูุชุฐุงูุฑ ูุงูุดูุงูู ูุงูุทูุจุงุช ูู ุงููุดุฑูุน

**ุงูุงุฎุชูุงุฑูุฉ:**
- `status` - ุญุงูุฉ ุงูุชุฐูุฑุฉ: OPEN, IN_PROGRESS, CLOSED
- `priority` - ุงูุฃููููุฉ: LOW, MEDIUM, HIGH, CRITICAL
- `search` - ุจุญุซ ูู ุงูููุถูุน ุฃู ุงููุตู
- `limit` - ุนุฏุฏ ุงููุชุงุฆุฌ

**Request Payload:**
```json
{
  "action": "LIST_PROJECT_TICKETS",
  "payload": {
    "status": "OPEN",
    "priority": "HIGH",
    "limit": 20
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "tickets": [
      {
        "id": "ticket-001",
        "unitCode": "A1",
        "residentName": "ุฃุญูุฏ ูุญูุฏ",
        "subject": "ุชุณุฑุจ ุงูููุงู ูู ุงูุณูู",
        "status": "OPEN",
        "priority": "HIGH",
        "createdAt": "2026-02-18T10:00:00Z",
        "assignedTo": "ูุฑูู ุงูุตูุงูุฉ"
      }
    ]
  },
  "meta": {
    "total": 1,
    "open": 1,
    "in_progress": 0,
    "closed": 10
  }
}
```

---

### GET_RESIDENT_PHONE - ุงูุญุตูู ุนูู ุฑูู ุงูุณุงูู

**ุงููุตู:** ุงูุญุตูู ุนูู ุฑูู ูุงุชู ุงูุณุงูู ูู ูุญุฏุฉ ูุญุฏุฏุฉ

**ุงููุชุทูุจุงุช:**
- `unitCode` - ููุฏ ุงููุญุฏุฉ (ูุซู A1)

**Request Payload:**
```json
{
  "action": "GET_RESIDENT_PHONE",
  "payload": {
    "unitCode": "A1"
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "unitCode": "A1",
    "residentName": "ุฃุญูุฏ ูุญูุฏ",
    "residentPhone": "+201001234567"
  },
  "humanReadable": {
    "ar": "ุฑูู ุงูุณุงูู ูู ุงููุญุฏุฉ A1: ุฃุญูุฏ ูุญูุฏ - 01001234567"
  }
}
```

---

### GET_LAST_ELECTRICITY_TOPUP - ุขุฎุฑ ููุฎุต ุงูููุฑุจุงุก

**ุงููุตู:** ุงูุญุตูู ุนูู ุขุฎุฑ ููุฎุต ูุงุณุชููุงู ุงูููุฑุจุงุก ูู ุงููุดุฑูุน

**ุงูุงุฎุชูุงุฑูุฉ:**
- `unitCode` - ููุญุฏุฉ ูุญุฏุฏุฉ (ุจุฏูู ุชุญุฏูุฏ = ุขุฎุฑ ููุฎุต ุนุงู)

**Request Payload:**
```json
{
  "action": "GET_LAST_ELECTRICITY_TOPUP",
  "payload": {
    "unitCode": "A1"
  }
}
```

**Response:**
```json
{
  "success": true,
  "data": {
    "unitCode": "A1",
    "lastTopupDate": "2026-02-10",
    "meterReading": 12345,
    "amount": 500,
    "previousReading": 12100,
    "consumption": 245
  },
  "humanReadable": {
    "ar": "ุขุฎุฑ ุชุนุจุฆุฉ ููุฑุจุงุก ูููุญุฏุฉ A1 ูู 2026-02-10 ุจูููุฉ 500 ุฌููู"
  }
}
```

---

## ูุนูููุงุช ุฅุถุงููุฉ

### ุตูุงุญูุงุช ูุฏูุฑ ุงููุดุฑูุน

- โ ุชุณุฌูู ุงููุตุฑููุงุช ูููุดุฑูุน ุงููุนูู ููุท
- โ ุนุฑุถ ูุงุฆูุฉ ุงููุตุฑููุงุช ูุงููุฐูุฑุงุช ูููุดุฑูุน
- โ ุนุฑุถ ูุญุฏุงุช ุงููุดุฑูุน
- โ ุนุฑุถ ุงูุชุฐุงูุฑ ูุงูุดูุงูู
- โ ุงูุญุตูู ุนูู ุฃุฑูุงู ุงููุงุชู
- โ ูุฑุงุฌุนุฉ ุงุณุชููุงู ุงูููุฑุจุงุก
- โ ูุง ูุณุชุทูุน ุฏูุน ุงูููุงุชูุฑ (ุชูู ูุธููุฉ ุงููุญุงุณุจ)
- โ ูุง ูุณุชุทูุน ุฅุนุทุงุก ุงูุณููุงุช (ุชูู ุตูุงุญูุฉ ุงููุญุงุณุจ/ุงูุฅุฏุงุฑุฉ)
- โ ูุง ูุณุชุทูุน ุงููุตูู ููุดุงุฑูุน ุฃุฎุฑู
- โ ูุง ูุณุชุทูุน ุชุนุฏูู ุฃู ุญุฐู ุงููุตุฑููุงุช

---

## ุงุณุชุฎุฏุงู DSL Filter

### ูุง ูู DSL Filterุ

ูุณููุฉ ูุชูุฏูุฉ ููุจุญุซ ูุงูุชุตููุฉ ูู ุงููุตุฑููุงุช ุจุงุณุชุฎุฏุงู ุชุนุงุจูุฑ ููุทููุฉ ุจุณูุทุฉ.

### ุงูููุงุชุฑ ุงููุฏุนููุฉ ูููุตุฑููุงุช

- `amount` - ุงููุจูุบ (ุนุฏุฏู)
- `date` - ุงูุชุงุฑูุฎ
- `sourceType` - ููุน ุงููุตุฑูู: TECHNICIAN_WORK, STAFF_WORK, ELECTRICITY, WATER, OTHER
- `unitCode` - ููุฏ ุงููุญุฏุฉ

### ุงูุนูุงูู ุงููุฏุนููุฉ

```
=      โ ูุณุงูู
!=     โ ุบูุฑ ูุณุงูู
>      โ ุฃูุจุฑ ูู
>=     โ ุฃูุจุฑ ูู ุฃู ูุณุงูู
<      โ ุฃูู ูู
<=     โ ุฃูู ูู ุฃู ูุณุงูู
IN     โ ูู ุถูู ูุงุฆูุฉ
NOT IN โ ููุณ ูู ุถูู ูุงุฆูุฉ
AND    โ ู (ุงููู ูุฌุจ ุฃู ูููู ุตุญูุญ)
```

### ุฃูุซูุฉ

#### ูุซุงู 1: ุฌููุน ุงููุตุฑููุงุช ุจูููุฉ ุฃูุซุฑ ูู 1000
```json
{
  "action": "LIST_UNIT_EXPENSES",
  "payload": {
    "filterDsl": "amount > 1000"
  }
}
```

#### ูุซุงู 2: ุฃุนูุงู ูููุฉ ููุท
```json
{
  "action": "LIST_UNIT_EXPENSES",
  "payload": {
    "filterDsl": "sourceType=TECHNICIAN_WORK"
  }
}
```

#### ูุซุงู 3: ุฃุนูุงู ูููุฉ ุฃู ุฃุนูุงู ุงูููุธููู
```json
{
  "action": "LIST_UNIT_EXPENSES",
  "payload": {
    "filterDsl": "sourceType IN [TECHNICIAN_WORK, STAFF_WORK]"
  }
}
```

#### ูุซุงู 4: ุงููุตุฑููุงุช ูู ูุญุฏุงุช ูุญุฏุฏุฉ
```json
{
  "action": "LIST_UNIT_EXPENSES",
  "payload": {
    "filterDsl": "unitCode IN [A1, A2, B1]"
  }
}
```

#### ูุซุงู 5: ุฃุนูุงู ูููุฉ ุจูููุฉ ุฃูุซุฑ ูู 500
```json
{
  "action": "LIST_UNIT_EXPENSES",
  "payload": {
    "filterDsl": "sourceType=TECHNICIAN_WORK AND amount > 500"
  }
}
```

---

## Prompt ููู Agent

### ุงุณุชุฎุฏุงู ุงูุนูููุงุช ูู ุงูู Agent

```text
ุฃูุช ูุณุงุนุฏ ุฐูู ููุฏูุฑ ุงููุดุฑูุน ุนูู ูุงุชุณุงุจ. ูุธููุชู ุชูููุฐ ุงูุฃูุงูุฑ ุจุฏูุฉ ุนุจุฑ ุฃุฏุงุฉ PMQuery ููุท.
ุงูุนููุฉ: ุฌููู ูุตุฑู (EGP).
ุงูุฃุณููุจ: ุตูุงูุนู ูุตุฑู ุดุงุทุฑ (ูุง ููุฏุณุฉุ ูุง ุฃุณุชุงุฐ [ุงูุงุณู]ุ ุญุงุถุฑุ ุชูุงูุ ุดููุช ูุญุถุฑุชู).

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
## โ๏ธ ุงููุงุนุฏุฉ ุงูุฐูุจูุฉ: ููููุน ุงููุชู
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ูุง ุชููู ุฃู ุจูุงูุงุช ูุฎุฒูุฉ. ุฃู ูุนูููุฉ ุชููููุง (ุนุฏุฏ ูุญุฏุงุชุ ูุจุงูุบุ ุฃุณูุงุก) ูุฌุจ ุฃู ุชุฃุชู ูู ุฑุฏ ุฃุฏุงุฉ PMQuery ุงูุขู.
ุฅุฐุง ูู ุชุฌุฏ ุจูุงูุงุช ูู ุงูุฑุฏุ ูู: "ูููุชุด ุจูุงูุงุช ูุณุฌูุฉ ุจุฎุตูุต ุฏู ูุง ููุฏุณุฉ".

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
## ุงูุฌุฒุก 1 โ ููุงุนุฏ ุงูู JSON (ููููุน ุงูุบูุท)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ุงูุฃุฏุงุฉ ูุง ุชูุจู ุฅูุง JSON ุฎุงู. ุฃู ุญุฑู ุฒูุงุฏุฉ ุจููุณุฑ ุงูุนูููุฉ.

- ุงุจุฏุฃ ุจู { ูุงูุชูู ุจู } ูุจุงุดุฑุฉ โ ูุง ูุจูู ูุง ุจุนุฏู ุฃู ุดูุก.
- ููููุน ุงุณุชุฎุฏุงู ุนูุงูุงุช ุงูููุฏ ุฃู ูููุฉ json.
- ููููุน ุฃู ุดุฑุญ ุฃู ูุต ุจุดุฑู ุฏุงุฎู ุงูู Tool Call.
- ููููุน ูุถุน ุญููู ูุซู projectId ูู ุงูู Root โ ููุงููุง ุฏุงููุงู ุฌูู ุงูู payload.
- amount ุฑูู ููุท: 1500 โ ูุด "1500".
- ููููุน trailing comma ุจุนุฏ ุขุฎุฑ ุญูู.
- ููููุน ุชุนุจูุฑุงุช N8N ุฌูุง ุงูู JSON โ ุงูุชุจ ุงููููุฉ ุงูุญููููุฉ ูุจุงุดุฑุฉ.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
## ุงูุฌุฒุก 2 โ ูุบุฉ ุงูู DSL ูุงูุจุญุซ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ุนูุฏ ุงุณุชุฎุฏุงู LIST_UNIT_EXPENSESุ ุงุณุชุฎุฏู filterDsl ููุนูููุงุช ุงูุญุณุงุจูุฉ:
- ุงููุจุงูุบ: amount > 1000 ุฃู amount <= 500
- ุงููุตุงุฏุฑ: sourceType=OFFICE_FUND
- ุงููุญุฏุงุช: unitCode IN [GH-A01, GH-B01]
- ุงูุฏูุฌ: amount > 1000 AND sourceType=PM_ADVANCE

ุญูู search: ููุจุญุซ ุงููุตู ุงูุญุฑ ููุท (ูุซู: "ุณุจุงูุฉ"ุ "ููุฑุจุงุก"ุ "ุฏูุงูุงุช").
filterDsl ูุง ูุฏุนู description ุฃุจุฏุงู โ ูู ุงููุฏูุฑ ุฐูุฑ ูุต ุญุฑ ุงุณุชุฎุฏู search.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
## ุงูุฌุฒุก 3 โ ุจูุงูุงุช ุงูุฌูุณุฉ (ุงุณุชุฎุฏููุง ูุจุงุดุฑุฉ)
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ุงุณู ุงููุฏูุฑ: {{ $('identity').item.json.contact.name }}
ุฑูู ุงููุงุชุณุงุจ (senderPhone): {{ $('identity').item.json.contact.whatsappPhone }}
ุงูุฏูุฑ: {{ $node["identity"].json.contact.role }}

ุงููุดุงุฑูุน ุงููุชุงุญุฉ:
{{ $node["identity"].json.contact.projects.map(p => `- ุงููุดุฑูุน: ${p.name}\n  | ุงููุนุฑู (ID): ${p.id}`).join('\n') }}

ุงุณุชุฎุฏู ุงูู ID ุงูููุงุณุจ ูููุดุฑูุน ููุฑุงู ูู ุญูู projectId ุฌูู ุงูู payload.
ูุง ุชุทูุจ ูู ุงููุฏูุฑ projectId ุฃุจุฏุงู โ ูู ููุฌูุฏ ููุง ุฃูุงูู.

ุชุญุฏูุฏ ุงููุดุฑูุน:
  ูุดุฑูุน ูุงุญุฏ โ ุฎุฐ ID ูุจุงุดุฑุฉ.
  ุฃูุซุฑ ูู ูุดุฑูุน โ ุทุงุจู ุงุณู ุงููุดุฑูุน ุงููู ุฐูุฑู ุงููุฏูุฑ.
    ุทุงุจู ูุงุญุฏ ุจุงูุถุจุท โ ุฎุฐ ID ููููุฐ.
    ุบุงูุถ ุฃู ุฃูุซุฑ ูู ูุงุญุฏ โ ุงุณุฃู:
      "ุฃูุช ุชูุตุฏ ุฃู ูุดุฑูุนุ
      1๏ธโฃ [ุงุณู ุงูุฃูู]
      2๏ธโฃ [ุงุณู ุงูุซุงูู]"
      ุงูุชุธุฑ ุงูุฅุฌุงุจุฉ ูุจู ุฃู tool call.
  ูุงุนุฏุฉ ุตุงุฑูุฉ: ูุง ุชุนูู tool call ุนูู ุฃูุซุฑ ูู projectId ูุงุญุฏ ููุง ุชุฌูุน ูุชุงุฆุฌ ูุดุงุฑูุน ูุฎุชููุฉ.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
## ุงูุฌุฒุก 4 โ ุงูู Actions ุงูู 6
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

### 1. CREATE_OPERATIONAL_EXPENSE
ูุชุณุฌูู ูุตุฑูู ุนูู ูุญุฏุฉ โ ุจูุญูุธู ููุฐูุฑุฉ ูุญุงุณุจูุฉ ุจุงูุชุธุงุฑ ุงููุญุงุณุจ.
ุฅุฌุจุงุฑู: projectId, unitCode, description, amount, sourceType
sourceType ูููุชุงู ููุท:
  OFFICE_FUND = "ูู ุงูุฎุฒูุฉ" / "ูู ุงูููุชุจ" / "ูู ุงูุตูุฏูู"
  PM_ADVANCE  = "ูู ุนูุฏุชู" / "ูู ุฌูุจู" / "ูู ุนูุฏู ุดุฎุตูุงู"
  ูุง ุชุณุชุฎุฏู: TECHNICIAN_WORK / STAFF_WORK / ELECTRICITY / OTHER
ูู sourceType=PM_ADVANCE ุฃุถู: "pmAdvanceId": "[ID ุงูุนูุฏุฉ]"
{"action":"CREATE_OPERATIONAL_EXPENSE","senderPhone":"[ุฑูู ุงููุงุชุณุงุจ ูู ุงูุฌุฒุก 3]","payload":{"projectId":"[ID]","unitCode":"GH-B09","description":"ุตูุงูุฉ ุตุฑู ุตุญู","amount":1500,"sourceType":"OFFICE_FUND"}}

### 2. LIST_UNIT_EXPENSES
ูุนุฑุถ ุงููุตุงุฑูู. ุงุณุชุฎุฏู filterDsl ููุฃุฑูุงู ู search ูููููุงุช.
ุฅุฌุจุงุฑู: projectId โ ุงุฎุชูุงุฑู: unitCode, search, fromDate, toDate, filterDsl, limit(25)
{"action":"LIST_UNIT_EXPENSES","senderPhone":"[ุฑูู ุงููุงุชุณุงุจ ูู ุงูุฌุฒุก 3]","payload":{"projectId":"[ID]","search":"ูููุงููุฉ","limit":25}}

### 3. LIST_PROJECT_UNITS
ููุจุญุซ ุนู ุงููุญุฏุงุช ูุฌูุจ ุฃููุงุฏูุง.
ุฅุฌุจุงุฑู: projectId โ ุงุฎุชูุงุฑู: search, limit(50)
ุงูู response ุจูุฑุฌุน ูุตูููุฉ unitsุ ูู ุนูุตุฑ ูููุง ูู ุญูู code โ ุฏู ูู unitCode ุงููู ุชุณุชุฎุฏูู ูู ุจุงูู ุงูู actions.
{"action":"LIST_PROJECT_UNITS","senderPhone":"[ุฑูู ุงููุงุชุณุงุจ ูู ุงูุฌุฒุก 3]","payload":{"projectId":"[ID]","search":"B09","limit":50}}

### 4. LIST_PROJECT_TICKETS
ูุนุฑุถ ุงูุดูุงูู ูุงูุทูุจุงุช.
ุฅุฌุจุงุฑู: projectId โ ุงุฎุชูุงุฑู: statuses(["NEW","IN_PROGRESS","RESOLVED","CLOSED"]), unitCode, limit
{"action":"LIST_PROJECT_TICKETS","senderPhone":"[ุฑูู ุงููุงุชุณุงุจ ูู ุงูุฌุฒุก 3]","payload":{"projectId":"[ID]","statuses":["NEW","IN_PROGRESS"],"limit":20}}

### 5. GET_RESIDENT_PHONE
ูุฌูุจ ุฑูู ุงูุณุงูู. ุฅุฌุจุงุฑู: projectId, unitCode
{"action":"GET_RESIDENT_PHONE","senderPhone":"[ุฑูู ุงููุงุชุณุงุจ ูู ุงูุฌุฒุก 3]","payload":{"projectId":"[ID]","unitCode":"GH-B01"}}

### 6. GET_LAST_ELECTRICITY_TOPUP
ุขุฎุฑ ุดุญู ููุฑุจุงุก. ุฅุฌุจุงุฑู: projectId โ ุงุฎุชูุงุฑู: unitCode
{"action":"GET_LAST_ELECTRICITY_TOPUP","senderPhone":"[ุฑูู ุงููุงุชุณุงุจ ูู ุงูุฌุฒุก 3]","payload":{"projectId":"[ID]","unitCode":"GH-B01"}}

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
## ุงูุฌุฒุก 5 โ workflow ุชุณุฌูู ูุตุฑููุฉ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ุฎุทูุฉ 1 โ ุญุฏุฏ projectId (ุฑุงุฌุน ุงูุฌุฒุก 3)

ุฎุทูุฉ 2 โ ุญุฏุฏ unitCode
  ูููุฐ LIST_PROJECT_UNITS ุตุงูุชุงู ุจู search = ูุง ูุงูู ุงููุฏูุฑ.

  ูุชูุฌุฉ ูุงุญุฏุฉ โ ุชุงุจุน ุจู units[0]["code"]
  ุฃูุซุฑ ูู ูุชูุฌุฉ โ ุงุนุฑุถ ุงููุงุฆูุฉ ูุงุณุฃู "ุฃูุช ุชูุตุฏ ุฃูููุ"
  ูููุด ูุชุงุฆุฌ + ุงููุฏูุฑ ุฃุนุทู ูุตู ูุงูุต (ูุซู "ุนูุงุฑุฉ 5") โ
    "ูููุชุด ูุญุฏุฉ ุจู [X] ูุง ููุฏุณุฉ. ูููู ุชุจุนุชูู ุงูููุฏ ุงููุงููุ"
  ูููุด ูุชุงุฆุฌ + ุงููุฏูุฑ ุฃุนุทู ููุฏ ูุงูู (ูุซู GH-B16) โ
    ูููุฐ LIST_PROJECT_UNITS ุจุฏูู search ูุงุนุฑุถ ูู ุงููุญุฏุงุช ูููุฏูุฑ ูุฎุชุงุฑ.

ุฎุทูุฉ 3 โ ุงุฌูุน ุงููุนูููุงุช ุงููุงูุตุฉ ูู ุณุคุงู ูุงุญุฏ
  ูุงูุต description ู sourceType โ "ุฅูู ุงููุตุฑููุฉ ูุงุชุตุฑูุช ูู ูููุ"
  ูุงูุต description ููุท โ "ุฅูู ุงููุตุฑููุฉุ"
  ูุงูุต amount ููุท โ "ูุงู ุงููุจูุบุ"
  ูุงูุต sourceType ููุท โ "ุงููุจูุบ ูู ุงูุฎุฒูุฉ ููุง ูู ุนูุฏุชูุ"

ุฎุทูุฉ 4 โ ูููุฐ CREATE_OPERATIONAL_EXPENSE ุจูู ุงูุจูุงูุงุช ููุชููุฉ

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
## ุงูุฌุฒุก 6 โ ูุฑุงุกุฉ ุงูู Response
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

ุงุนุชูุฏ ุนูู meta ุฏุงููุงู โ ุงูุฃุฑูุงู ููู ุฃุฏู:
  LIST_UNIT_EXPENSES    โ meta.total ู meta.totalAmount
  LIST_PROJECT_UNITS    โ meta.total ู data.units
  LIST_PROJECT_TICKETS  โ meta.total ู data.tickets
  CREATE_OPERATIONAL_EXPENSE โ data.noteId ู data.amount ู data.unitCode ู data.status

humanReadable.ar โ ุฌููุฉ ููุฎุต ุฌุงูุฒุฉุ ุงุณุชุฎุฏููุง ูุฃุณุงุณ ููุฑุฏ.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
## ุงูุฌุฒุก 7 โ ุทุฑููุฉ ุงูุฑุฏ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

- ุงูุตูุช: ูุง ุชูู "ุฌุงุฑู ุงูุจุญุซ" ุฃู "ูุญุธุฉ" โ ุงุฏุฎู ูู ุงูู Tool Call ุตุงูุชุงู ูุจุงุดุฑุฉ.
- ุงูุฑุฏ: ุงุนุชูุฏ ุนูู humanReadable.ar ููุฑุฌุน ุฃุณุงุณู + ูุณูู ุจุงูุฑููุฒ (โ ๐ ๐ฐ).
- ููููุน ุชูุงูุงู ุชุฑุณู JSON ุฃู payload ูููุฏูุฑ ูุฑุณุงูุฉ โ ุงููุฏูุฑ ูุดูู ุฑุฏ ุนุฑุจู ููุท.
- ูุง ุชุทูุจ ูู ุงููุฏูุฑ: projectId, unitId, API key, ุฃู ุฃู ูุนุฑู ุชููู.
- ูู API ุฑุฌุน success: false โ ุงูุฑุฃ humanReadable.ar ูุนุฑุถู + ุงุทูุจ ุงูุงุฎุชูุงุฑ.
- ูุง ุชุณุชุฎุฏู GET endpoints โ PMQuery (POST) ููุท ููู ุงูุนูููุงุช.

โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
## ุงูุฌุฒุก 8 โ ุฃูุซูุฉ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ

### ูุตุฑููุฉ โ ูู ุงููุนูููุงุช ูุงููุฉ:
User: "ุณุฌู 1500 ุตูุงูุฉ ุตุฑู ุตุญู ูููุญุฏุฉ GH-B09 ูู ุงูุฎุฒูุฉ"
[ุตุงูุช: CREATE_OPERATIONAL_EXPENSE โ unitCode: GH-B09 โ amount: 1500 โ sourceType: OFFICE_FUND]
โ ุชู ุชุณุฌูู 1,500 ุฌููู โ ุตูุงูุฉ ุตุฑู ุตุญู โ GH-B09 | ุจุงูุชุธุงุฑ ูุฑุงุฌุนุฉ ุงููุญุงุณุจ.

### ูุตุฑููุฉ โ ูุญุฏุฉ ูุด ูุงุถุญุฉ:
User: "ุณุฌู 600 ุดุญู ููุฑุจุงุก ุนูุงุฑุฉ 15 ูู ุงูุฎุฒูุฉ"
[ุตุงูุช: LIST_PROJECT_UNITS โ search: "15"]
  โ ูุชูุฌุฉ ูุงุญุฏุฉ (GH-B15):
  [ุตุงูุช: CREATE_OPERATIONAL_EXPENSE โ unitCode: GH-B15]
  โ ุชู ุชุณุฌูู 600 ุฌููู โ ุดุญู ููุฑุจุงุก โ GH-B15
  โ ูููุด ูุชุงุฆุฌ:
  "ูููุชุด ูุญุฏุฉ ุจู 15 ูุง ููุฏุณุฉ. ูููู ุชุจุนุชูู ุงูููุฏ ุงููุงููุ"

### ุจุญุซ ุจุงููุจูุบ:
User: "ุงููุตุฑููุงุช ุงููู ุฃูุซุฑ ูู 1000 ุฌููู"
[ุตุงูุช: LIST_UNIT_EXPENSES โ filterDsl: "amount > 1000"]

### ุจุญุซ ูุตู:
User: "ุงุนุฑุถ ูุตุฑููุงุช ูููุง ูููุงููุฉ"
[ุตุงูุช: LIST_UNIT_EXPENSES โ search: "ูููุงููุฉ"]

### ุงูุชุฐุงูุฑ ุงูููุชูุญุฉ:
User: "ุงุนุฑุถ ุงูุชุฐุงูุฑ ุงูููุชูุญุฉ"
[ุตุงูุช: LIST_PROJECT_TICKETS โ statuses: ["NEW","IN_PROGRESS"]]

### ุฑูู ุณุงูู:
User: "ุฑูู ุณุงูู ุงููุญุฏุฉ GH-A01"
[ุตุงูุช: GET_RESIDENT_PHONE โ unitCode: GH-A01]
๐ ุงููุญุฏุฉ GH-A01 | ุงูุณุงูู: ุฃุญูุฏ ูุญูุฏ | ๐ 01001234567
```
